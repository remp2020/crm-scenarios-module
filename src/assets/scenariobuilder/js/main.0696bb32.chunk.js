(this["webpackJsonpremp-scenario-builder"]=this["webpackJsonpremp-scenario-builder"]||[]).push([[0],{194:function(e,t,a){e.exports=a(331)},243:function(e,t,a){},331:function(e,t,a){"use strict";a.r(t);var n={};a.r(n),a.d(n,"NodeModel",(function(){return ct})),a.d(n,"NodeFactory",(function(){return Dt})),a.d(n,"PortModel",(function(){return lt}));var i={};a.r(i),a.d(i,"NodeModel",(function(){return At})),a.d(i,"NodeFactory",(function(){return jt})),a.d(i,"PortModel",(function(){return It}));var s={};a.r(s),a.d(s,"NodeModel",(function(){return Vt})),a.d(s,"NodeFactory",(function(){return ba})),a.d(s,"PortModel",(function(){return Gt}));var o={};a.r(o),a.d(o,"NodeModel",(function(){return fa})),a.d(o,"NodeFactory",(function(){return La})),a.d(o,"PortModel",(function(){return ya}));var r={};a.r(r),a.d(r,"NodeModel",(function(){return Wa})),a.d(r,"NodeFactory",(function(){return Ga})),a.d(r,"PortModel",(function(){return za}));var l={};a.r(l),a.d(l,"NodeModel",(function(){return Ha})),a.d(l,"NodeFactory",(function(){return Za})),a.d(l,"PortModel",(function(){return Va}));var c={};a.r(c),a.d(c,"NodeModel",(function(){return Ja})),a.d(c,"NodeFactory",(function(){return $a})),a.d(c,"PortModel",(function(){return Ya}));var d={};a.r(d),a.d(d,"NodeModel",(function(){return tn})),a.d(d,"NodeFactory",(function(){return rn})),a.d(d,"PortModel",(function(){return en}));var m={};a.r(m),a.d(m,"NodeModel",(function(){return cn})),a.d(m,"NodeFactory",(function(){return Pn})),a.d(m,"PortModel",(function(){return ln}));var p={};a.r(p),a.d(p,"NodeModel",(function(){return In})),a.d(p,"NodeFactory",(function(){return Un})),a.d(p,"PortModel",(function(){return Dn}));var h={};a.r(h),a.d(h,"NodeModel",(function(){return zn})),a.d(h,"NodeFactory",(function(){return Xn})),a.d(h,"PortModel",(function(){return Ln}));var u=a(0),g=a.n(u),E=a(13),v=a(11),b=a(73),y=a(172),f=a(15),N=a.n(f);const T={avalaibleSegments:[]};const C={criteria:[]};const S={avalaibleTriggers:[]};const _={availableBeforeTriggers:[]};const w={pannable:!0,zoomable:!0,notification:{open:!1,variant:"success",text:""}};const k={id:null,name:"",loading:0,payload:null};const x={availableMails:[]};const M={generics:[]};const F={availableGoals:[]};const O={availableBanners:[]};const P={availableTemplates:[],availableApplications:[]};const D={statistics:[]};var I=Object(b.b)({segments:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"segments_changed":return{...e,avalaibleSegments:t.payload};default:return e}},triggers:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"triggers_changed":return{...e,avalaibleTriggers:t.payload};default:return e}},beforeTriggers:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"before_triggers_changed":return{...e,availableBeforeTriggers:t.payload};default:return e}},canvas:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"canvas_pannable":return{...e,pannable:t.payload};case"canvas_zoomable":return{...e,zoomable:t.payload};case"canvas_zoomable_pannable":return{...e,zoomable:t.payload,pannable:t.payload};case"canvas_notification":return{...e,notification:{...e.notification,...t.payload}};default:return e}},criteria:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"criteria_changed":return{...e,criteria:t.payload};default:return e}},scenario:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"set_scenario_id":return{...e,id:t.payload};case"set_scenario_name":return{...e,name:t.payload};case"set_scenario_loading":let a=e.loading;return t.payload?++a:--a,{...e,loading:a};case"set_scenario_payload":return{...e,payload:t.payload};default:return e}},mails:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"mails_changed":return{...e,availableMails:t.payload};default:return e}},generics:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"generics_changed":return{...e,generics:t.payload};default:return e}},goals:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"goals_changed":return{...e,availableGoals:t.payload};default:return e}},banners:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"banners_changed":return{...e,availableBanners:t.payload};default:return e}},pushNotifications:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"push_notifications_changed":return{...e,availableTemplates:t.payload.templates,availableApplications:t.payload.applications};default:return e}},statistics:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"statistics_changed":return{...e,statistics:t.payload.statistics};default:return e}}}),A=a(159),B=a.n(A),U=a(7),L=a(334),z=a(411),W=a(402),R=a(401),j=a(403),G=a(389),V=a(390),H=a(54),K=a(384),q=a(4),Z=a(376),Y=a(82),J=a.n(Y),X=a(98),Q=a.n(X),$=a(97),ee=a.n($),te=a(101),ae=a.n(te),ne=a(103),ie=a.n(ne),se=a(99),oe=a.n(se),re=a(106),le=a.n(re),ce=a(104),de=a.n(ce),me=a(102),pe=a.n(me),he=a(107),ue=a.n(he),ge=a(108),Ee=a.n(ge);const{AUTH_TOKEN:ve,CRM_HOST:be,SCENARIO_ID:ye,BANNER_ENABLED:fe,PUSH_NOTIFICATION_ENABLED:Ne}=window.Scenario.config,Te="".concat(be,"/api/v1/scenarios/info?id="),Ce="".concat(be,"/api/v1/scenarios/create"),Se="".concat(be,"/api/v1/scenarios/criteria"),_e="".concat(be,"/api/v1/segments/list"),we="".concat(be,"/api/v1/events/list"),ke="".concat(be,"/api/v1/event-generators/list"),xe="".concat(be,"/api/v1/mail-template/list"),Me="".concat(be,"/api/v1/scenarios/generics"),Fe="".concat(be,"/api/v1/onboarding-goals/list"),Oe="".concat(be,"/api/v1/remp/list-banners"),Pe="".concat(be,"/api/v1/onesignal-templates/list"),De="".concat(be,"/api/v1/onesignal-applications/list"),Ie="".concat(be,"/api/v1/scenarios/stats?id="),Ae="".concat(be,"/segment/stored-segments/new"),Be="".concat(be,"/segment/stored-segments/show/");var Ue=a(332),Le=a(373),ze=a(374);class We extends u.Component{constructor(e){super(e),this.state={}}render(){return u.createElement(Ue.a,{key:this.props.name,draggable:!0,onDragStart:e=>{e.dataTransfer.setData("storm-diagram-node",JSON.stringify(this.props.model))},className:"tray-item"},u.createElement(Le.a,null,this.props.icon),u.createElement(ze.a,{primary:this.props.name}))}}function Re(e,t){switch(t){case"minutes":return parseInt(e);case"hours":return 60*e;case"days":return 60*e*24;default:return parseInt(e)}}class je{constructor(e){this.formatDescendant=function(e,t){let a={uuid:e.id};return"segment"===t.type||"goal"===t.type||"condition"===t.type?a.direction="right"===e.portName?"positive":"negative":"ab_test"===t.type&&(a.direction="positive",a.position=e.portName.split(".")[1]),a},this.model=e}exportPayload(){const e={},t=this.model.serializeDiagram(),a=["trigger","before_trigger"];return e.triggers={},e.elements={},e.visual={},t.nodes.filter(e=>a.includes(e.type)).map(t=>e.triggers[t.id]=this.formatNode(t)),Object.entries(this.model.getNodes()).forEach(t=>{e.visual[t[0]]={x:t[1].x,y:t[1].y}}),Object.entries(this.model.getNodes()).forEach(t=>{a.includes(t[1].type)||(e.elements[t[0]]=this.formatNode(t[1].serialize()))}),e}getAllChildrenNodes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right";return e.ports.find(e=>e.name===t).links.map(a=>{let n=null;return n=this.model.links[a].targetPort.parent.id!==e.id?this.model.links[a].targetPort.parent:this.model.links[a].sourcePort.parent,{...n.serialize(),portName:t}})}getPositiveAndNegativeDescendants(e){return[...this.getAllChildrenNodes(e,"right").map(t=>this.formatDescendant(t,e)),...this.getAllChildrenNodes(e,"bottom").map(t=>this.formatDescendant(t,e))]}formatNode(e){if("email"===e.type)return{id:e.id,name:e.name?e.name:"",type:"email",email:{code:e.selectedMail,descendants:this.getAllChildrenNodes(e).map(t=>this.formatDescendant(t,e))}};if("banner"===e.type)return{id:e.id,name:e.name?e.name:"",type:"banner",banner:{id:e.selectedBanner,expiresInMinutes:Re(e.expiresInTime,e.expiresInUnit),descendants:this.getAllChildrenNodes(e).map(t=>this.formatDescendant(t,e))}};if("generic"===e.type)return{id:e.id,name:e.name?e.name:"",type:"generic",generic:{code:e.selectedGeneric,options:e.options,descendants:this.getAllChildrenNodes(e).map(t=>this.formatDescendant(t,e))}};if("condition"===e.type)return{id:e.id,name:e.name?e.name:"",type:"condition",condition:{conditions:e.conditions,descendants:this.getPositiveAndNegativeDescendants(e)}};var t,a,n;if("segment"===e.type)return{id:e.id,name:e.name?e.name:"",type:"segment",segment:{code:null!==(t=e.selectedSegment)&&void 0!==t?t:null,descendants:this.getPositiveAndNegativeDescendants(e)}};if("trigger"===e.type)return{id:e.id,name:e.name?e.name:"",type:"event",event:{code:null!==(a=e.selectedTrigger)&&void 0!==a?a:null},elements:this.getAllChildrenNodes(e).map(e=>e.id)};if("before_trigger"===e.type)return{id:e.id,name:e.name?e.name:"",type:"before_event",event:{code:null!==(n=e.selectedTrigger)&&void 0!==n?n:null},elements:this.getAllChildrenNodes(e).map(e=>e.id),options:{minutes:Re(e.time,e.timeUnit)}};if("wait"===e.type)return{id:e.id,name:e.name?e.name:"",type:"wait",wait:{minutes:Re(e.waitingTime,e.waitingUnit),descendants:this.getAllChildrenNodes(e).map(t=>this.formatDescendant(t,e))}};if("goal"===e.type){let t={codes:e.selectedGoals?e.selectedGoals:[],descendants:this.getPositiveAndNegativeDescendants(e),recheckPeriodMinutes:Re(e.recheckPeriodTime,e.recheckPeriodUnit)};return e.timeoutTime&&e.timeoutUnit&&(t.timeoutMinutes=Re(e.timeoutTime,e.timeoutUnit)),{id:e.id,name:e.name?e.name:"",type:"goal",goal:t}}if("push_notification"===e.type)return{id:e.id,name:e.name?e.name:"",type:"push_notification",push_notification:{template:e.selectedTemplate,application:e.selectedApplication,descendants:this.getAllChildrenNodes(e).map(t=>this.formatDescendant(t,e))}};if("ab_test"===e.type){let t=e.ports.filter(e=>e.name.startsWith("right.")).flatMap(t=>this.getAllChildrenNodes(e,t.name).map(t=>this.formatDescendant(t,e)));return{id:e.id,name:e.name?e.name:"",type:"ab_test",ab_test:{variants:e.variants,descendants:t}}}}}var Ge=a(412),Ve=a(375),He=a(164),Ke=a.n(He),qe=a(166),Ze=a.n(qe),Ye=a(167),Je=a.n(Ye),Xe=a(165),Qe=a.n(Xe);const $e={success:Ke.a,warning:Qe.a,error:Ze.a,info:Je.a};class et extends g.a.Component{render(){const e=$e[this.props.variant];return g.a.createElement(Ge.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:this.props.open,autoHideDuration:3e3,onClose:this.props.handleClose},g.a.createElement(Ve.a,{className:"toast-"+this.props.variant,message:g.a.createElement("span",{id:"client-snackbar",className:"toast__message"},g.a.createElement(e,{className:"toast__icon toast__icon-variant"}),this.props.text)}))}}var tt=et;class at extends U.AbstractPortFactory{constructor(e,t){super(e),this.cb=t}getNewInstance(e){return this.cb(e)}}var nt=a(14);class it extends U.DefaultLinkModel{constructor(){super("custom"),this.width=2,this.curvyness=50,this.color="rgba(0,0,0,0.3)"}}class st extends U.DefaultLinkFactory{constructor(){super(),this.type="custom"}getNewInstance(e){return new it}generateLinkSegment(e,t,a,n){return u.createElement("path",{className:a?t.bem("--path-selected"):"",strokeWidth:e.width,stroke:e.color,d:n})}}class ot extends U.PortModel{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";super(e,arguments.length>1?arguments[1]:void 0),this.position=e,this.in="left"===this.position}link(e){let t=this.createLinkModel();return t.setSourcePort(this),t.setTargetPort(e),t}canLinkToPort(e){return this.in!==e.in}serialize(){return nt.merge(super.serialize(),{position:this.position})}deSerialize(e,t){super.deSerialize(e,t),this.position=e.position}createLinkModel(){return new it}}class rt extends U.PortModel{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";super(e,arguments.length>1?arguments[1]:void 0),this.position=e,this.in="left"===this.position}link(e){let t=this.createLinkModel();return t.setSourcePort(this),t.setTargetPort(e),t}serialize(){return nt.merge(super.serialize(),{position:this.position})}canLinkToPort(e){return this.in!==e.in}deSerialize(e,t){super.deSerialize(e,t),this.position=e.position}createLinkModel(){return new it}}class lt extends ot{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left","email")}}class ct extends U.NodeModel{constructor(e){super("email",e.id),this.name=e.name,this.selectedMail=e.selectedMail,this.addPort(new lt("left")),this.addPort(new lt("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.selectedMail=e.selectedMail}serialize(){return nt.merge(super.serialize(),{name:this.name,selectedMail:this.selectedMail})}}var dt=a(414),mt=a(380),pt=a(392),ht=a(382),ut=a(383),gt=a(381),Et=a(410);class vt extends U.PortWidget{constructor(e){super(e),this.state={selected:!1}}getClassName(){return"port "+super.getClassName()+(this.state.selected?this.bem("--selected"):"")}render(){return u.createElement("div",Object.assign({},this.getProps(),{onMouseEnter:()=>{this.setState({selected:!0})},onMouseLeave:()=>{this.setState({selected:!1})},"data-name":this.props.name,"data-nodeid":this.props.node.getID()}),this.props.children)}}function bt(e){return{type:"canvas_zoomable_pannable",payload:e}}function yt(e){return{type:"canvas_notification",payload:e}}function ft(e){return{type:"set_scenario_id",payload:e}}function Nt(e){return{type:"set_scenario_name",payload:e}}function Tt(e){return{type:"set_scenario_loading",payload:e}}var Ct=a(413);var St=function(e){var t;const a=Object(v.c)(e=>e.statistics.statistics),n=null!==(t=a[e.elementId])&&void 0!==t?t:null;let i=null;if(0===a.length)i=g.a.createElement("div",{sx:{color:"white"}},g.a.createElement(Z.a,{size:8,color:"inherit"}));else{if(n&&(n.hasOwnProperty("finished")&&(i=n.finished["24h"]),"right"===e.position&&n.hasOwnProperty("matched")&&(i=n.matched["24h"]),"right"===e.position&&n.hasOwnProperty("completed")&&(i=n.completed["24h"]),"bottom"===e.position&&n.hasOwnProperty("notMatched")&&(i=n.notMatched["24h"]),"bottom"===e.position&&n.hasOwnProperty("timeout")&&(i=n.timeout["24h"]),e.hasOwnProperty("index")&&(i=n[e.index]?n[e.index]["24h"]:0)),null===i)return null;i=(s=i)<1e3?s:s<1e6?Number(s/1e3).toFixed(s>1e5?0:1)+"K":Number(s/1e6).toFixed(1)+"M"}var s;return g.a.createElement("div",{className:"statistic-badge-container-"+e.position},g.a.createElement(Ct.a,{label:i,color:"primary",size:"small",style:{backgroundColor:e.color,height:"16px",borderRadius:"4px",fontSize:"0.7rem"},className:"statistic-badge statistic-badge-"+e.position}))},_t=a(377);class wt extends g.a.Component{render(){var e,t;const{anchorElement:a}=this.props,n=null!==(e=this.props.statistics[this.props.id])&&void 0!==e?e:null,i=null!==(t=this.props.variants)&&void 0!==t?t:[];return null===n?null:g.a.createElement(_t.a,{open:Boolean(a),anchorEl:a,style:{pointerEvents:"none"},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},g.a.createElement("div",{className:"node-tooltip-wrapper"},n?g.a.createElement("div",{className:"scenario-tooltip",style:{padding:"10px"}},g.a.createElement("strong",{style:{color:"red"}},"Statistics"),g.a.createElement("hr",null),n.hasOwnProperty("waiting")?g.a.createElement("div",{style:{marginBottom:"10px"}},"Waiting: ",n.waiting):null,n.hasOwnProperty("recheck")?g.a.createElement("div",{style:{marginBottom:"10px"}},"Waiting to re-check: ",n.recheck):null,g.a.createElement("strong",null,"Last 24 hours"),g.a.createElement("br",null),g.a.createElement("table",null,g.a.createElement("tbody",null,n.hasOwnProperty("finished")?g.a.createElement("tr",null,g.a.createElement("td",null,"Finished:"),g.a.createElement("td",null,n.finished["24h"])):null,n.hasOwnProperty("matched")?g.a.createElement("tr",null,g.a.createElement("td",null,"Matched:"),g.a.createElement("td",null,n.matched["24h"])):null,n.hasOwnProperty("notMatched")?g.a.createElement("tr",null,g.a.createElement("td",null,"Not matched:"),g.a.createElement("td",null,n.notMatched["24h"])):null,n.hasOwnProperty("completed")?g.a.createElement("tr",null,g.a.createElement("td",null,"Completed:"),g.a.createElement("td",null,n.completed["24h"])):null,n.hasOwnProperty("timeout")?g.a.createElement("tr",null,g.a.createElement("td",null,"Timed out:"),g.a.createElement("td",null,n.timeout["24h"])):null,i.flatMap(e=>g.a.createElement("tr",{key:e.code},g.a.createElement("td",null,e.name,":"),g.a.createElement("td",null,n[e.code]?n[e.code]["24h"]:0))))),g.a.createElement("strong",null,"Last 30 days"),g.a.createElement("br",null),g.a.createElement("table",null,g.a.createElement("tbody",null,n.hasOwnProperty("finished")?g.a.createElement("tr",null,g.a.createElement("td",null,"Finished:"),g.a.createElement("td",null,n.finished["30d"])):null,n.hasOwnProperty("matched")?g.a.createElement("tr",null,g.a.createElement("td",null,"Matched:"),g.a.createElement("td",null,n.matched["30d"])):null,n.hasOwnProperty("notMatched")?g.a.createElement("tr",null,g.a.createElement("td",null,"Not matched:"),g.a.createElement("td",null,n.notMatched["30d"])):null,n.hasOwnProperty("completed")?g.a.createElement("tr",null,g.a.createElement("td",null,"Completed:"),g.a.createElement("td",null,n.completed["30d"])):null,n.hasOwnProperty("timeout")?g.a.createElement("tr",null,g.a.createElement("td",null,"Timed out:"),g.a.createElement("td",null,n.timeout["30d"])):null,i.flatMap(e=>g.a.createElement("tr",{key:e.code},g.a.createElement("td",null,e.name,":"),g.a.createElement("td",null,n[e.code]?n[e.code]["30d"]:0)))))):""))}}var kt=Object(v.b)((function(e){return{statistics:e.statistics.statistics}}))(wt),xt=a(409),Mt=a(379);const Ft=Object(Et.a)(L.a)({marginRight:"auto"});class Ot extends u.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,selectedMail:this.props.node.selectedMail,anchorElementForTooltip:null}),this.props.dispatch(bt(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(bt(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.getSelectedMail=()=>{const e=this.props.mails.find(e=>e.code===this.state.selectedMail);return e||null},this.getSelectedMailValue=()=>{const e=this.props.mails.find(e=>e.code===this.props.node.selectedMail);return e?" - ".concat(e.name):""},this.filterOptions=()=>Object(Mt.a)({matchFrom:"any",trim:!0,ignoreAccents:!0,ignoreCase:!0,stringify:e=>e.name+" "+e.code}),this.state={nodeFormName:this.props.node.name,selectedMail:this.props.node.selectedMail,dialogOpened:!1,anchorElementForTooltip:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){const{classes:e}=this.props;return u.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},u.createElement("div",{className:"node-container"},u.createElement("div",{className:this.bem("__icon")},u.createElement(J.a,null)),u.createElement("div",{className:this.bem("__ports")},u.createElement("div",{className:this.bem("__left")},u.createElement(vt,{name:"left",node:this.props.node})),u.createElement("div",{className:this.bem("__right")},u.createElement(vt,{name:"right",node:this.props.node}),u.createElement(St,{elementId:this.props.node.id,color:"#a291fb",position:"right"})))),u.createElement("div",{className:this.bem("__title")},u.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Mail ".concat(this.getSelectedMailValue()))),u.createElement(kt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),u.createElement(mt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},u.createElement(gt.a,{id:"form-dialog-title"},"Email node"),u.createElement(ht.a,null,u.createElement(ut.a,null,"Sends an email to user."),u.createElement(K.a,{container:!0},u.createElement(K.a,{item:!0,xs:6},u.createElement(dt.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),u.createElement(K.a,{container:!0,alignItems:"center",alignContent:"space-between"},u.createElement(K.a,{item:!0,xs:12},u.createElement(xt.a,{value:this.getSelectedMail(),options:this.props.mails,getOptionLabel:e=>e.name,disableClearable:!0,filterOptions:this.filterOptions(),groupBy:e=>e.mail_type.code,onChange:(e,t)=>{null!==t&&this.setState({selectedMail:t.code})},renderInput:e=>u.createElement(dt.a,Object.assign({},e,{variant:"standard",label:"Selected Mail",fullWidth:!0})),renderOption:(t,a)=>{let{selected:n}=a;return u.createElement("div",null,u.createElement("span",{className:e.title},t.name),u.createElement("small",{className:e.subtitle},"(",t.code,")"))}})))),u.createElement(pt.a,null,this.props.mails.filter(e=>e.link&&e.code===this.state.selectedMail).map(e=>u.createElement(Ft,{color:"primary",href:e.link,target:"_blank"},u.createElement(J.a,{style:{marginRight:"5px"}}),"Preview")),u.createElement(L.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),u.createElement(L.a,{color:"primary",onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.selectedMail=this.state.selectedMail,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var Pt=Object(v.b)((function(e){return{mails:e.mails.availableMails}}))(Object(q.a)(e=>({autocomplete:{margin:e.spacing(1)},subtitle:{paddingLeft:"6px",color:e.palette.grey[600]}}))(Ot));class Dt extends U.AbstractNodeFactory{constructor(){super("email")}generateReactWidget(e,t){return u.createElement(Pt,{diagramEngine:e,node:t,classBaseName:"square-node",className:"email-node"})}getNewInstance(){return new ct}}class It extends ot{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left","banner")}}class At extends U.NodeModel{constructor(e){super("banner",e.id),this.name=e.name,this.selectedBanner=e.selectedBanner,this.expiresInTime=e.expiresInTime,this.expiresInUnit=e.expiresInUnit,this.addPort(new It("left")),this.addPort(new It("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.selectedBanner=e.selectedBanner,this.expiresInTime=e.expiresInTime||"1",this.expiresInUnit=e.expiresInUnit||"days"}serialize(){return nt.merge(super.serialize(),{name:this.name,selectedBanner:this.selectedBanner,expiresInTime:this.expiresInTime,expiresInUnit:this.expiresInUnit})}}var Bt=a(387),Ut=a(388),Lt=a(408),zt=a(393);class Wt extends u.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,anchorElementForTooltip:null}),this.props.dispatch(bt(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(bt(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.getSelectedBanner=()=>{const e=this.props.banners.find(e=>e.id===this.state.selectedBanner);return e||null},this.getSelectedBannerValue=()=>{const e=this.props.banners.find(e=>e.id===this.props.node.selectedBanner);return e?" - ".concat(e.name):""},this.state={nodeFormName:this.props.node.name,selectedBanner:this.props.node.selectedBanner,dialogOpened:!1,anchorElementForTooltip:null,expiresInTime:this.props.node.expiresInTime,expiresInUnit:this.props.node.expiresInUnit}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){return u.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},u.createElement("div",{className:"node-container"},u.createElement("div",{className:this.bem("__icon")},u.createElement(ee.a,null)),u.createElement("div",{className:this.bem("__ports")},u.createElement("div",{className:this.bem("__left")},u.createElement(vt,{name:"left",node:this.props.node})),u.createElement("div",{className:this.bem("__right")},u.createElement(vt,{name:"right",node:this.props.node}),u.createElement(St,{elementId:this.props.node.id,color:"#6435c9",position:"right"})))),u.createElement("div",{className:this.bem("__title")},u.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Banner ".concat(this.getSelectedBannerValue()))),u.createElement(kt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),u.createElement(mt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},u.createElement(gt.a,{id:"form-dialog-title"},"Banner node"),u.createElement(ht.a,null,u.createElement(ut.a,null,"Shows a one-time banner to user."),u.createElement(K.a,{container:!0},u.createElement(K.a,{item:!0,xs:6},u.createElement(dt.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),u.createElement(K.a,{container:!0,style:{marginBottom:"10px"}},u.createElement(K.a,{item:!0,xs:12},u.createElement(xt.a,{value:this.getSelectedBanner(),options:this.props.banners,getOptionLabel:e=>e.name,disableClearable:!0,onChange:(e,t)=>{null!==t&&this.setState({selectedBanner:t.id})},renderInput:e=>u.createElement(dt.a,Object.assign({},e,{variant:"standard",label:"Selected Banner",fullWidth:!0}))}))),u.createElement(K.a,{container:!0,spacing:1},u.createElement(K.a,{item:!0,xs:6},u.createElement(dt.a,{id:"expires-in-time",label:"Expires in",type:"number",helperText:"Banner is not shown after given period",fullWidth:!0,value:this.state.expiresInTime,onChange:e=>{this.setState({expiresInTime:e.target.value})}})),u.createElement(K.a,{item:!0,xs:6},u.createElement(Bt.a,{fullWidth:!0},u.createElement(Ut.a,{htmlFor:"time-unit"},"Time unit"),u.createElement(Lt.a,{value:this.state.expiresInUnit,onChange:e=>{this.setState({expiresInUnit:e.target.value})},inputProps:{name:"expires-in-unit",id:"expires-in-unit"}},u.createElement(zt.a,{value:"minutes"},"Minutes"),u.createElement(zt.a,{value:"hours"},"Hours"),u.createElement(zt.a,{value:"days"},"Days")))))),u.createElement(pt.a,null,u.createElement(L.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),u.createElement(L.a,{color:"primary",onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.selectedBanner=this.state.selectedBanner,this.props.node.expiresInTime=this.state.expiresInTime,this.props.node.expiresInUnit=this.state.expiresInUnit,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var Rt=Object(v.b)((function(e){return{banners:e.banners.availableBanners}}))(Wt);class jt extends U.AbstractNodeFactory{constructor(){super("banner")}generateReactWidget(e,t){return u.createElement(Rt,{diagramEngine:e,node:t,classBaseName:"square-node",className:"banner-node"})}getNewInstance(){return new At}}class Gt extends ot{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left","generic")}}class Vt extends U.NodeModel{constructor(e){super("generic",e.id),this.name=e.name,this.selectedGeneric=e.selectedGeneric,this.options=e.options,this.addPort(new Gt("left")),this.addPort(new Gt("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.selectedGeneric=e.selectedGeneric,this.options=e.options}serialize(){return nt.merge(super.serialize(),{name:this.name,selectedGeneric:this.selectedGeneric,options:this.options})}}function Ht(e,t){switch(t.type){case"CREATE_OPTION":return{...e,options:[...e.options,{key:t.payload.optionKey,values:{selection:t.payload.values}}]};case"DELETE_OPTION":return{...e,options:e.options.filter(e=>e.key!==t.payload.optionKey)};case"SET_PARAM_VALUES":return{...e,options:e.options.map(e=>e.key===t.payload.name?{...e,values:t.payload.values}:e)};case"UPDATE_PARAM_VALUES":return{...e,options:e.options.map(e=>e.key===t.payload.name?{...e,values:Object.assign(e.values,t.payload.values)}:e)};default:throw new Error("unsupported action type "+t.type)}}var Kt=a(396),qt=a(397),Zt=a(394),Yt=a(416),Jt=a(395);function Xt(e,t){return{type:"SET_PARAM_VALUES",payload:{name:e,values:t}}}function Qt(e,t){return{type:"UPDATE_PARAM_VALUES",payload:{name:e,values:t}}}const $t=Object(Zt.a)(e=>({formControl:{marginBottom:e.spacing(1)}}));function ea(e){const t=$t();void 0===e.values.selection&&e.dispatch(Xt(e.name,{selection:!0}));return g.a.createElement(Jt.a,{onChange:t=>{e.dispatch(Xt(e.name,{selection:t.target.checked}))},control:g.a.createElement(Yt.a,null),checked:void 0!==e.values.selection&&e.values.selection,label:e.blueprint.label,className:t.formControl})}var ta=a(336);const aa=Object(Zt.a)(e=>({formControl:{marginRight:e.spacing(1),marginBottom:e.spacing(1),minWidth:100},formLabel:{display:"block",marginBottom:e.spacing(1)},numberInput:{marginRight:e.spacing(1),marginBottom:e.spacing(1)}}));function na(e){var t,a,n;const i=aa();void 0===e.values.operator&&e.blueprint.operators&&1===e.blueprint.operators.length&&e.dispatch(Xt(e.name,{operator:e.blueprint.operators[0]}));return g.a.createElement(g.a.Fragment,null,!e.hideLabel&&g.a.createElement(ta.a,{className:i.formLabel},e.blueprint.label),e.blueprint.operators&&e.blueprint.operators.length&&g.a.createElement(Bt.a,{className:i.formControl,disabled:1===e.blueprint.operators.length},g.a.createElement(Ut.a,null,"Operator"),g.a.createElement(Lt.a,{autoWidth:!0,value:null!==(t=e.values.operator)&&void 0!==t?t:"",onChange:t=>{e.dispatch(Qt(e.name,{operator:t.target.value}))}},e.blueprint.operators.map(e=>g.a.createElement(zt.a,{key:e,value:e},e)))),g.a.createElement(dt.a,{className:i.numberInput,label:e.blueprint.unit,type:"number",onChange:t=>{e.dispatch(Qt(e.name,{selection:t.target.value}))},value:null!==(a=e.values.selection)&&void 0!==a?a:"",inputProps:null!==(n=e.blueprint.numberInputAttributes)&&void 0!==n?n:{}}))}const ia=Object(Zt.a)(e=>({chipRoot:e=>({"&:not(:first-child)":{"&::before":{content:"'"+e.operator+"'",textTransform:"uppercase",position:"absolute",left:"-20px"},marginLeft:"20px"},position:"relative"}),subtitle:{paddingLeft:"6px",color:e.palette.grey[600]},autocomplete:{marginBottom:e.spacing(1)}}));function sa(e,t){const a=new Set(e);return t.filter(e=>{let t=a.has(e.value);return t&&a.delete(e.value),t}).concat([...a])}function oa(e){return"string"===typeof e?e:e.label}function ra(e){return"string"===typeof e?"":void 0!==e.subtitle?e.subtitle:""}function la(e){return"string"===typeof e?"":e.hasOwnProperty("group")?e.group:""}const ca=Object(Mt.a)({matchFrom:"any",trim:!0,ignoreAccents:!0,ignoreCase:!0,stringify:e=>oa(e)+" "+ra(e)});function da(e){const t=ia({operator:e.blueprint.operator});return g.a.createElement(xt.a,{multiple:!0,disableCloseOnSelect:!0,ChipProps:{classes:{root:t.chipRoot}},options:e.blueprint.options,getOptionLabel:oa,onChange:(t,a)=>{e.dispatch(Xt(e.name,{operator:e.blueprint.operator,selection:a.map(e=>"string"===typeof e?e:e.value)}))},value:sa(e.values.selection,e.blueprint.options),freeSolo:e.blueprint.freeSolo,groupBy:la,filterOptions:ca,renderInput:a=>g.a.createElement(dt.a,Object.assign({},a,{variant:"standard",label:e.blueprint.label,placeholder:"",className:t.autocomplete,fullWidth:!0})),renderOption:(e,a)=>{let{selected:n}=a;return g.a.createElement(g.a.Fragment,null,oa(e),g.a.createElement("small",{className:t.subtitle},ra(e)))}})}const ma=g.a.createContext(null);function pa(e){const t=Object(u.useContext)(ma);switch(e.blueprint.type){case"boolean":return g.a.createElement(ea,{name:e.blueprint.key,values:e.option.values,blueprint:e.blueprint,dispatch:t});case"number":return g.a.createElement(na,{name:e.blueprint.key,values:e.option.values,blueprint:e.blueprint,dispatch:t});case"string_labeled_array":return g.a.createElement(da,{name:e.blueprint.key,values:e.option.values,blueprint:e.blueprint,dispatch:t});default:throw new Error("unsupported option type "+e.blueprint.type)}}const ha=Object(Zt.a)(e=>({option:{flex:"0 0 100%",borderBottom:"1px solid #dfdfdf",marginBottom:e.spacing(2),paddingBottom:e.spacing(1),"&:last-child":{borderBottom:"none",marginBottom:0,paddingBottom:0}}}));var ua=Object(u.forwardRef)((function(e,t){var a;const n=ha(),[i,s]=Object(u.useReducer)(Ht,{version:1,options:null!==(a=e.options)&&void 0!==a?a:[]});return Object(u.useImperativeHandle)(t,()=>({state:i})),i.options.forEach(t=>{void 0===e.blueprints.find(e=>e.key===t.key)&&s({type:"DELETE_OPTION",payload:{optionKey:t.key}})}),e.blueprints.forEach(e=>{var t,a;void 0===i.options.find(t=>e.key===t.key)&&s((t=e.key,{type:"CREATE_OPTION",payload:{values:a,optionKey:t}}))}),g.a.createElement(ma.Provider,{value:s},g.a.createElement(Kt.a,null,g.a.createElement(qt.a,{className:n.cardContent},e.blueprints.map(e=>{var t;let a=null!==(t=i.options.find(t=>t.key===e.key))&&void 0!==t?t:{key:e.key,values:{selection:null}};return g.a.createElement("div",{className:n.option},g.a.createElement(pa,{key:e.key,option:a,blueprint:e.blueprint}))}))))}));const ga=Object(Mt.a)({matchFrom:"any",trim:!0,ignoreAccents:!0,ignoreCase:!0,stringify:e=>e.label+" "+e.value});class Ea extends u.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,anchorElementForTooltip:null}),this.props.dispatch(bt(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(bt(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.getSelectedGeneric=()=>{const e=this.props.generics.find(e=>e.code===this.state.selectedGeneric);return e||null},this.getSelectedGenericOptionBlueprints=()=>{const e=this.getSelectedGeneric();let t=[];return null!==e&&null!==e.options&&nt.forOwn(e.options,(function(e,a){t.push({key:a,blueprint:e})})),t},this.transformOptionsForSelect=()=>{const e=[];return Object.keys(this.props.generics).forEach(t=>{e.push({value:this.props.generics[t].code,label:this.props.generics[t].label})}),e},this.getSelectedGenericDefaultLabel=()=>{const e=this.getSelectedGeneric();return e?" - ".concat(e.label):""},this.optionsFormRef=u.createRef(),this.state={nodeFormName:this.props.node.name,selectedGeneric:this.props.node.selectedGeneric,dialogOpened:!1,anchorElementForTooltip:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){const{classes:e}=this.props;return u.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},u.createElement("div",{className:"node-container"},u.createElement("div",{className:this.bem("__icon")},u.createElement(Q.a,null)),u.createElement("div",{className:this.bem("__ports")},u.createElement("div",{className:this.bem("__left")},u.createElement(vt,{name:"left",node:this.props.node})),u.createElement("div",{className:this.bem("__right")},u.createElement(vt,{name:"right",node:this.props.node}),u.createElement(St,{elementId:this.props.node.id,color:"#a291fb",position:"right"})))),u.createElement("div",{className:this.bem("__title")},u.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Generic ".concat(this.getSelectedGenericDefaultLabel()))),u.createElement(kt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),u.createElement(mt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},u.createElement(gt.a,{id:"form-dialog-title"},"Generic action node"),u.createElement(ht.a,null,u.createElement(ut.a,null,"Runs defined generic action."),u.createElement(K.a,{container:!0},u.createElement(K.a,{item:!0,xs:6},u.createElement(dt.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),u.createElement(K.a,{container:!0,alignItems:"center",alignContent:"space-between"},u.createElement(K.a,{item:!0,xs:12},u.createElement(xt.a,{value:this.getSelectedGeneric(),options:this.transformOptionsForSelect(),getOptionLabel:e=>e.label,getOptionSelected:(e,t)=>e.key===t.key,disableClearable:!0,filterOptions:ga,onChange:(e,t)=>{null!==t&&this.setState({selectedGeneric:t.value})},renderInput:e=>u.createElement(dt.a,Object.assign({},e,{variant:"standard",label:"Action",fullWidth:!0})),renderOption:(t,a)=>{let{selected:n}=a;return u.createElement("div",null,u.createElement("span",{className:e.title},t.label),u.createElement("small",{className:e.subtitle},"(",t.value,")"))}}))),this.state.selectedGeneric&&this.getSelectedGenericOptionBlueprints().length>0&&u.createElement(K.a,{container:!0,alignItems:"center",alignContent:"space-between"},u.createElement(K.a,{item:!0,xs:12},u.createElement("p",null,"Options"),u.createElement(ua,{options:this.props.node.options,blueprints:this.getSelectedGenericOptionBlueprints(),ref:this.optionsFormRef})))),u.createElement(pt.a,null,u.createElement(L.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),u.createElement(L.a,{color:"primary",onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.selectedGeneric=this.state.selectedGeneric,this.props.node.options=this.optionsFormRef.current?this.optionsFormRef.current.state.options:[],this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var va=Object(v.b)((function(e){return{generics:e.generics.generics}}))(Object(q.a)(e=>({autocomplete:{margin:e.spacing(1)},subtitle:{paddingLeft:"6px",color:e.palette.grey[600]}}))(Ea));class ba extends U.AbstractNodeFactory{constructor(){super("generic")}generateReactWidget(e,t){return u.createElement(va,{diagramEngine:e,node:t,classBaseName:"square-node",className:"generic-node"})}getNewInstance(){return new Vt}}class ya extends rt{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top","segment")}}class fa extends U.NodeModel{constructor(e){super("segment",e.id),this.name=e.name,this.selectedSegment=e.selectedSegment,this.addPort(new ya("left")),this.addPort(new ya("bottom")),this.addPort(new ya("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.selectedSegment=e.selectedSegment}serialize(){return nt.merge(super.serialize(),{name:this.name,selectedSegment:this.selectedSegment})}}var Na=a(399),Ta=a(398);const Ca=Object(Zt.a)(e=>({autocomplete:{margin:e.spacing(1)},subtitle:{paddingLeft:"6px",color:e.palette.grey[600]}}));function Sa(e){return"string"===typeof e?e:e.name}function _a(e,t){return!(!t||!t.hasOwnProperty("code"))&&e.code===t.code}function wa(e,t){const a=t.filter(t=>t.code===e)[0];return a||null}const ka=Object(Mt.a)({matchFrom:"any",trim:!0,ignoreAccents:!0,ignoreCase:!0,stringify:e=>e.name+" "+e.code});function xa(e){const t=Ca(),a=Object(v.c)(t=>t.segments.avalaibleSegments.filter(t=>t.table===e.selectedSegmentSourceTable))[0].segments.sort((e,t)=>e.group.sorting-t.group.sorting===0?e.group.id-t.group.id:e.group.sorting-t.group.sorting);return g.a.createElement(xt.a,{fullWidth:!0,className:t.autocomplete,value:wa(e.selectedSegment,a),options:a,getOptionSelected:_a,getOptionLabel:Sa,groupBy:e=>e.group.name,filterOptions:ka,onChange:(t,a)=>{e.onSegmentSelectedChange(a)},renderInput:e=>g.a.createElement(dt.a,Object.assign({},e,{variant:"standard",label:"Segment",fullWidth:!0})),renderOption:(e,a)=>{let{selected:n}=a;return g.a.createElement("div",null,g.a.createElement("span",{className:t.title},Sa(e)),g.a.createElement("small",{className:t.subtitle},"(",e.code,")"))}})}const Ma=Object(Zt.a)({selectedButton:{backgroundColor:"#E4E4E4"},deselectedButton:{color:"#A6A6A6"}});function Fa(e){const t=Ma(),a=Object(v.c)(e=>e.segments.avalaibleSegments),n=function(e,t,a){if(e)return e;if(t){const e=a.filter(e=>e.segments.filter(e=>e.code===t).length>0);return e[0]&&e[0].hasOwnProperty("table")?e[0].table:"users"}return"users"}(e.selectedSegmentSourceTable,e.selectedSegment,a);return g.a.createElement(K.a,{container:!0,item:!0,xs:12,spacing:2},g.a.createElement(K.a,{item:!0,xs:12},g.a.createElement(Ta.a,{"aria-label":"outlined button group"},a.map(a=>g.a.createElement(L.a,{onClick:()=>e.onSegmentTypeButtonClick(a.table),className:n===a.table?t.selectedButton:t.deselectedButton,key:a.table},a.table)))),g.a.createElement(xa,{selectedSegment:e.selectedSegment,selectedSegmentSourceTable:n,onSegmentSelectedChange:e.onSegmentSelectedChange}))}var Oa=a(69),Pa=a.n(Oa),Da=a(100),Ia=a.n(Da);const Aa=Object(Et.a)(L.a)({marginRight:"auto"});class Ba extends u.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,selectedSegment:this.props.node.selectedSegment,anchorElementForTooltip:null}),this.props.dispatch(bt(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(bt(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.actionSetTable=e=>{this.state.selectedSegmentSourceTable!==e&&(this.setState({selectedSegment:null}),this.setState({selectedSegmentSourceTable:e}))},this.segmentSelectedChange=e=>{let t=null;e&&e.hasOwnProperty("code")&&(t=e.code),this.setState({selectedSegment:t})},this.getSelectedSegmentValue=()=>{const e=this.props.segments.flatMap(e=>e.segments).find(e=>e.code===this.props.node.selectedSegment);return e?" - ".concat(e.name):""},this.handleNewSegmentClick=()=>{window.open(Ae)},this.state={nodeFormName:this.props.node.name,selectedSegment:this.props.node.selectedSegment,dialogOpened:!1,anchorElementForTooltip:null,creatingNewSegment:!1,selectedSegmentSourceTable:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){let e=!1;return(0===this.props.statistics.length||this.props.statistics[this.props.node.id])&&(e=!0),u.createElement("div",{className:this.getClassName(),onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},u.createElement("div",{className:this.bem("__title")},u.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Segment ".concat(this.getSelectedSegmentValue()))),u.createElement("div",{className:"node-container"},u.createElement("div",{className:this.bem("__icon")},u.createElement(oe.a,null)),u.createElement("div",{className:this.bem("__ports")},u.createElement("div",{className:this.bem("__left")},u.createElement(vt,{name:"left",node:this.props.node})),u.createElement("div",{className:this.bem("__right")},u.createElement(vt,{name:"right",node:this.props.node}),e?u.createElement(St,{elementId:this.props.node.id,color:"#21ba45",position:"right"}):u.createElement(Pa.a,{style:{position:"absolute",top:"-5px",right:"-30px",color:"#2ECC40"}})),u.createElement("div",{className:this.bem("__bottom")},u.createElement(vt,{name:"bottom",node:this.props.node}),e?u.createElement(St,{elementId:this.props.node.id,color:"#db2828",position:"bottom"}):u.createElement(Ia.a,{style:{position:"absolute",top:"15px",right:"-5px",color:"#FF695E"}})))),u.createElement(kt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),u.createElement(mt.a,{fullWidth:!0,maxWidth:"md",open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},u.createElement(gt.a,{id:"form-dialog-title"},"Segment node"),u.createElement(ht.a,null,u.createElement(ut.a,null,"Segments evaluate user's presence in a group of users defined by system-provided conditions. Execution flow can be directed based on presence/absence of user within the selected segment. You can either pick one of the existing segments or create a new one."),u.createElement(K.a,{container:!0,spacing:3},u.createElement(K.a,{item:!0,xs:6},u.createElement(dt.a,{margin:"normal",id:"segment-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),u.createElement(K.a,{container:!0,spacing:3,alignItems:"flex-end"},u.createElement(K.a,{item:!0,xs:12},u.createElement(Fa,{selectedSegment:this.state.selectedSegment,selectedSegmentSourceTable:this.state.selectedSegmentSourceTable,onSegmentTypeButtonClick:this.actionSetTable,onSegmentSelectedChange:this.segmentSelectedChange})))),u.createElement(pt.a,null,u.createElement(Aa,{color:"primary",onClick:this.handleNewSegmentClick},u.createElement(Na.a,{style:{marginRight:"5px"}},"add_circle"),"New segment"),u.createElement(L.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),u.createElement(L.a,{color:"primary",onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.selectedSegment=this.state.selectedSegment,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var Ua=Object(v.b)((function(e){const{segments:t,dispatch:a}=e;return{segments:t.avalaibleSegments,statistics:e.statistics.statistics,dispatch:a}}))(Ba);class La extends U.AbstractNodeFactory{constructor(){super("segment")}generateReactWidget(e,t){return u.createElement(Ua,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"segment-node"})}getNewInstance(){return new fa}}class za extends ot{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left","trigger")}}class Wa extends U.NodeModel{constructor(e){super("trigger",e.id),this.name=e.name,this.selectedTrigger=e.selectedTrigger,this.addPort(new za("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.selectedTrigger=e.selectedTrigger}serialize(){return nt.merge(super.serialize(),{name:this.name,selectedTrigger:this.selectedTrigger})}}class Ra extends u.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,anchorElementForTooltip:null}),this.props.dispatch(bt(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(bt(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.getTriggersInSelectableFormat=()=>this.props.triggers.map(e=>({value:e.code,label:e.name})),this.getSelectedTriggerValue=()=>{const e=this.getTriggersInSelectableFormat().find(e=>e.value===this.props.node.selectedTrigger);return e?" - ".concat(e.label):""},this.state={nodeFormName:this.props.node.name,selectedTrigger:this.props.node.selectedTrigger,dialogOpened:!1,anchorElementForTooltip:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){return u.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color}},u.createElement("div",{className:"node-container",onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},u.createElement("div",{className:this.bem("__icon")},u.createElement(ae.a,null)),u.createElement("div",{className:this.bem("__ports")},u.createElement("div",{className:this.bem("__right")},u.createElement(vt,{name:"right",node:this.props.node}),u.createElement(St,{elementId:this.props.node.id,color:"#21ba45",position:"right"})))),u.createElement("div",{className:this.bem("__title")},u.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Event ".concat(this.getSelectedTriggerValue()))),u.createElement(kt,{id:this.props.node.id,isTrigger:!0,anchorElement:this.state.anchorElementForTooltip}),u.createElement(mt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},u.createElement(gt.a,{id:"form-dialog-title"},"Event node"),u.createElement(ht.a,null,u.createElement(ut.a,null,'Events are emitted on any change related to user. We recommend to combine "before" events with "Wait" operations to achieve execution at any desired time.'),u.createElement(K.a,{container:!0},u.createElement(K.a,{item:!0,xs:6},u.createElement(dt.a,{margin:"normal",id:"trigger-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),u.createElement(K.a,{container:!0},u.createElement(K.a,{item:!0,xs:12},u.createElement(xt.a,{value:this.getTriggersInSelectableFormat().find(e=>e.value===this.state.selectedTrigger),options:this.getTriggersInSelectableFormat(),getOptionLabel:e=>e.label,style:{marginTop:16},onChange:(e,t)=>{null!==t&&this.setState({selectedTrigger:t.value})},renderInput:e=>u.createElement(dt.a,Object.assign({},e,{variant:"standard",label:"Trigger",fullWidth:!0}))})))),u.createElement(pt.a,null,u.createElement(L.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),u.createElement(L.a,{color:"primary",onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.selectedTrigger=this.state.selectedTrigger,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var ja=Object(v.b)((function(e){const{triggers:t}=e;return{triggers:t.avalaibleTriggers}}))(Ra);class Ga extends U.AbstractNodeFactory{constructor(){super("trigger")}generateReactWidget(e,t){return u.createElement(ja,{diagramEngine:e,node:t,classBaseName:"square-node",className:"trigger-node"})}getNewInstance(){return new Wa}}class Va extends ot{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left","trigger_before")}}class Ha extends U.NodeModel{constructor(e){super("before_trigger",e.id),this.name=e.name,this.selectedTrigger=e.selectedTrigger,this.time=void 0!==e.time?e.time:10,this.timeUnit=void 0!==e.timeUnit?e.timeUnit:"hours",this.addPort(new Va("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.selectedTrigger=e.selectedTrigger,this.time=e.time,this.timeUnit=e.timeUnit}serialize(){return nt.merge(super.serialize(),{name:this.name,selectedTrigger:this.selectedTrigger,time:this.time,timeUnit:this.timeUnit})}}class Ka extends u.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,nodeFormBeforeTime:this.props.node.time,timeUnit:this.props.node.timeUnit,anchorElementForTooltip:null}),this.props.dispatch(bt(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(bt(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.getTriggersInSelectableFormat=()=>this.props.beforeTriggers.map(e=>({value:e.code,label:e.name})),this.getSelectedTriggerValue=()=>{const e=this.getTriggersInSelectableFormat().find(e=>e.value===this.props.node.selectedTrigger);return e?"".concat(this.props.node.time," ").concat(this.props.node.timeUnit," before - ").concat(e.label," event"):"Before Event"},this.state={nodeFormName:this.props.node.name,selectedTrigger:this.props.node.selectedTrigger,nodeFormBeforeTime:this.props.node.time,timeUnit:this.props.node.timeUnit,dialogOpened:!1,anchorElementForTooltip:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){return u.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},u.createElement("div",{className:"node-container"},u.createElement("div",{className:this.bem("__icon")},u.createElement(pe.a,null)),u.createElement("div",{className:this.bem("__ports")},u.createElement("div",{className:this.bem("__right")},u.createElement(vt,{name:"right",node:this.props.node}),u.createElement(St,{elementId:this.props.node.id,color:"#00b5ad",position:"right"})))),u.createElement("div",{className:this.bem("__title")},u.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:this.getSelectedTriggerValue())),u.createElement(kt,{id:this.props.node.id,isTrigger:!0,anchorElement:this.state.anchorElementForTooltip}),u.createElement(mt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},u.createElement(gt.a,{id:"form-dialog-title"},"Before event node"),u.createElement(ht.a,null,u.createElement(ut.a,null,"Events are emitted in advanced of trigger according to selected time period."),u.createElement(K.a,{container:!0},u.createElement(K.a,{item:!0,xs:6},u.createElement(dt.a,{margin:"normal",id:"trigger-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),u.createElement(K.a,{container:!0},u.createElement(K.a,{item:!0,xs:12},u.createElement(xt.a,{value:this.getTriggersInSelectableFormat().find(e=>e.value===this.state.selectedTrigger),options:this.getTriggersInSelectableFormat(),getOptionLabel:e=>e.label,style:{marginBottom:16},onChange:(e,t)=>{null!==t&&this.setState({selectedTrigger:t.value})},renderInput:e=>u.createElement(dt.a,Object.assign({},e,{variant:"standard",label:"Trigger",fullWidth:!0}))}))),u.createElement(K.a,{container:!0},u.createElement(K.a,{item:!0,xs:6},u.createElement(dt.a,{id:"waiting-time",label:"Before time",type:"number",fullWidth:!0,value:this.state.nodeFormBeforeTime,onChange:e=>{this.setState({nodeFormBeforeTime:e.target.value})}})),u.createElement(K.a,{item:!0,xs:6},u.createElement(Bt.a,{fullWidth:!0},u.createElement(Ut.a,{htmlFor:"time-unit"},"Time unit"),u.createElement(Lt.a,{value:this.state.timeUnit,onChange:e=>{this.setState({timeUnit:e.target.value})},inputProps:{name:"time-unit",id:"time-unit"}},u.createElement(zt.a,{value:"minutes"},"Minutes"),u.createElement(zt.a,{value:"hours"},"Hours"),u.createElement(zt.a,{value:"days"},"Days")))))),u.createElement(pt.a,null,u.createElement(L.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),u.createElement(L.a,{color:"primary",onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.selectedTrigger=this.state.selectedTrigger,this.props.node.time=this.state.nodeFormBeforeTime,this.props.node.timeUnit=this.state.timeUnit,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var qa=Object(v.b)((function(e){const{beforeTriggers:t}=e;return{beforeTriggers:t.availableBeforeTriggers}}))(Ka);class Za extends U.AbstractNodeFactory{constructor(){super("before_trigger")}generateReactWidget(e,t){return u.createElement(qa,{diagramEngine:e,node:t,classBaseName:"square-node",className:"before-trigger-node"})}getNewInstance(){return new Ha}}class Ya extends ot{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left","wait")}}class Ja extends U.NodeModel{constructor(e){super("wait",e.id),this.name=e.name,this.waitingTime=void 0!==e.waitingTime?e.waitingTime:10,this.waitingUnit=void 0!==e.waitingUnit?e.waitingUnit:"minutes",this.addPort(new Ya("left")),this.addPort(new Ya("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.waitingTime=e.waitingTime,this.waitingUnit=e.waitingUnit}serialize(){return nt.merge(super.serialize(),{name:this.name,waitingTime:this.waitingTime,waitingUnit:this.waitingUnit})}}class Xa extends u.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormWaitingTime:this.props.node.waitingTime,nodeFormName:this.props.node.name,timeUnit:this.props.node.waitingUnit,anchorElementForTooltip:null}),this.props.dispatch(bt(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(bt(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.state={nodeFormWaitingTime:this.props.node.waitingTime,nodeFormName:this.props.node.name,timeUnit:this.props.node.waitingUnit,dialogOpened:!1,anchorElementForTooltip:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){return u.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},u.createElement("div",{className:"node-container"},u.createElement("div",{className:this.bem("__icon")},u.createElement(ie.a,null)),u.createElement("div",{className:this.bem("__ports")},u.createElement("div",{className:this.bem("__left")},u.createElement(vt,{name:"left",node:this.props.node})),u.createElement("div",{className:this.bem("__right")},u.createElement(vt,{name:"right",node:this.props.node}),u.createElement(St,{elementId:this.props.node.id,color:"#ff851b",position:"right"})))),u.createElement("div",{className:this.bem("__title")},u.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Wait - ".concat(this.props.node.waitingTime," ").concat(this.props.node.waitingUnit))),u.createElement(kt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),u.createElement(mt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},u.createElement(gt.a,{id:"form-dialog-title"},"Wait node"),u.createElement(ht.a,null,u.createElement(ut.a,null,"Postpones the execution of next node in flow by selected amount of time."),u.createElement(K.a,{container:!0},u.createElement(K.a,{item:!0,xs:6},u.createElement(dt.a,{margin:"normal",id:"waiting-time",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),u.createElement(K.a,{container:!0},u.createElement(K.a,{item:!0,xs:6},u.createElement(dt.a,{id:"waiting-time",label:"Waiting time",type:"number",fullWidth:!0,value:this.state.nodeFormWaitingTime,onChange:e=>{this.setState({nodeFormWaitingTime:e.target.value})}})),u.createElement(K.a,{item:!0,xs:6},u.createElement(Bt.a,{fullWidth:!0},u.createElement(Ut.a,{htmlFor:"time-unit"},"Time unit"),u.createElement(Lt.a,{value:this.state.timeUnit,onChange:e=>{this.setState({timeUnit:e.target.value})},inputProps:{name:"time-unit",id:"time-unit"}},u.createElement(zt.a,{value:"minutes"},"Minutes"),u.createElement(zt.a,{value:"hours"},"Hours"),u.createElement(zt.a,{value:"days"},"Days")))))),u.createElement(pt.a,null,u.createElement(L.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),u.createElement(L.a,{color:"primary",onClick:()=>{this.props.node.waitingTime=this.state.nodeFormWaitingTime,this.props.node.name=this.state.nodeFormName,this.props.node.waitingUnit=this.state.timeUnit,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var Qa=Object(v.b)((function(e){const{segments:t}=e;return{segments:t.avalaibleSegments}}))(Xa);class $a extends U.AbstractNodeFactory{constructor(){super("wait")}generateReactWidget(e,t){return u.createElement(Qa,{diagramEngine:e,node:t,classBaseName:"round-node",className:"wait-node"})}getNewInstance(){return new Ja}}class en extends rt{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top","goal")}}class tn extends U.NodeModel{constructor(e){super("goal",e.id),this.name=e.name,this.selectedGoals=e.selectedGoals,this.timeoutTime=e.timeoutTime,this.timeoutUnit=e.timeoutUnit,this.recheckPeriodTime=e.recheckPeriodTime,this.recheckPeriodUnit=e.recheckPeriodUnit,this.addPort(new en("left")),this.addPort(new en("bottom")),this.addPort(new en("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.selectedGoals=e.selectedGoals,this.timeoutTime=null!==e.timeoutTime&&void 0!==e.timeoutTime?e.timeoutTime:"",this.timeoutUnit=null!==e.timeoutUnit&&void 0!==e.timeoutUnit?e.timeoutUnit:"days",this.recheckPeriodTime=null!==e.recheckPeriodTime&&void 0!==e.recheckPeriodTime?e.recheckPeriodTime:"1",this.recheckPeriodUnit=null!==e.recheckPeriodUnit&&void 0!==e.recheckPeriodUnit?e.recheckPeriodUnit:"hours"}serialize(){return nt.merge(super.serialize(),{name:this.name,selectedGoals:this.selectedGoals,timeoutTime:this.timeoutTime,timeoutUnit:this.timeoutUnit,recheckPeriodTime:this.recheckPeriodTime,recheckPeriodUnit:this.recheckPeriodUnit})}}var an=a(169),nn=a.n(an);class sn extends u.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,selectedGoals:this.props.node.selectedGoals,timeoutTime:this.props.node.timeoutTime,timeoutUnit:this.props.node.timeoutUnit,recheckPeriodTime:this.props.node.recheckPeriodTime,recheckPeriodUnit:this.props.node.recheckPeriodUnit,anchorElementForTooltip:null}),this.props.dispatch(bt(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(bt(!0))},this.transformOptionsForSelect=()=>this.props.goals.map(e=>({value:e.code,label:e.name})),this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.getSelectedGoals=()=>void 0===this.state.selectedGoals?[]:this.props.goals.filter(e=>this.state.selectedGoals.includes(e.code),this.state.selectedGoals),this.state={nodeFormName:this.props.node.name,selectedGoals:this.props.node.selectedGoals,timeoutTime:this.props.node.timeoutTime,timeoutUnit:this.props.node.timeoutUnit,recheckPeriodTime:this.props.node.recheckPeriodTime,recheckPeriodUnit:this.props.node.recheckPeriodUnit,dialogOpened:!1,anchorElementForTooltip:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){return u.createElement("div",{className:this.getClassName(),onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},u.createElement("div",{className:this.bem("__title")},u.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Goal")),u.createElement("div",{className:"node-container"},u.createElement("div",{className:this.bem("__icon")},u.createElement(de.a,null)),u.createElement("div",{className:this.bem("__ports")},u.createElement("div",{className:this.bem("__left")},u.createElement(vt,{name:"left",node:this.props.node})),u.createElement("div",{className:this.bem("__right")},u.createElement(vt,{name:"right",node:this.props.node}),this.props.statistics[this.props.node.id]?u.createElement(St,{elementId:this.props.node.id,color:"#21ba45",position:"right"}):u.createElement(Pa.a,{style:{position:"absolute",top:"-5px",right:"-30px",color:"#2ECC40"}})),u.createElement("div",{className:this.bem("__bottom")},u.createElement(vt,{name:"bottom",node:this.props.node}),this.props.statistics[this.props.node.id]?u.createElement(St,{elementId:this.props.node.id,color:"#db2828",position:"bottom"}):u.createElement(nn.a,{style:{position:"absolute",top:"15px",right:"-5px",color:"#FF695E"}})))),u.createElement(kt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),u.createElement(mt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},u.createElement(gt.a,{id:"form-dialog-title"},"Goal node"),u.createElement(ht.a,null,u.createElement(ut.a,null,"Goal node evaluates whether user has completed selected onboarding goals. Timeout value can be optionally specified, defining a point in time when evalution of completed goals is stopped. Execution flow can be directed two ways from the node - a positive direction, when all goals are completed, or a negative one, when timeout threshold is reached."),u.createElement(K.a,{container:!0},u.createElement(K.a,{item:!0,xs:6},u.createElement(dt.a,{margin:"normal",id:"goal-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),u.createElement(K.a,{container:!0,style:{marginBottom:"10px"}},u.createElement(K.a,{item:!0,xs:12},u.createElement(xt.a,{multiple:!0,value:this.getSelectedGoals(),options:this.props.goals,getOptionLabel:e=>e.name,disableClearable:!0,onChange:(e,t)=>{null!==t&&this.setState({selectedGoals:t.map(e=>e.code)})},renderInput:e=>u.createElement(dt.a,Object.assign({},e,{variant:"standard",label:"Selected Goal(s)",fullWidth:!0}))}))),u.createElement(K.a,{container:!0,spacing:1},u.createElement(K.a,{item:!0,xs:6},u.createElement(dt.a,{id:"recheck-period-time",label:"Recheck period time",type:"number",helperText:"How often goals completition should be checked",fullWidth:!0,value:this.state.recheckPeriodTime,onChange:e=>{this.setState({recheckPeriodTime:e.target.value})}})),u.createElement(K.a,{item:!0,xs:6},u.createElement(Bt.a,{fullWidth:!0},u.createElement(Ut.a,{htmlFor:"time-unit"},"Time unit"),u.createElement(Lt.a,{value:this.state.recheckPeriodUnit,onChange:e=>{this.setState({recheckPeriodUnit:e.target.value})},inputProps:{name:"recheck-period-unit",id:"recheck-period-unit"}},u.createElement(zt.a,{value:"minutes"},"Minutes"),u.createElement(zt.a,{value:"hours"},"Hours"),u.createElement(zt.a,{value:"days"},"Days"))))),u.createElement(K.a,{container:!0,spacing:1},u.createElement(K.a,{item:!0,xs:6},u.createElement(dt.a,{id:"timeout-time",label:"Timeout time",type:"number",placeholder:"No timeout",helperText:"Optionally select a timeout",fullWidth:!0,value:this.state.timeoutTime,onChange:e=>{this.setState({timeoutTime:e.target.value})}})),u.createElement(K.a,{item:!0,xs:6},u.createElement(Bt.a,{fullWidth:!0},u.createElement(Ut.a,{htmlFor:"time-unit"},"Time unit"),u.createElement(Lt.a,{value:this.state.timeoutUnit,onChange:e=>{this.setState({timeoutUnit:e.target.value})},inputProps:{name:"time-unit",id:"time-unit"}},u.createElement(zt.a,{value:"minutes"},"Minutes"),u.createElement(zt.a,{value:"hours"},"Hours"),u.createElement(zt.a,{value:"days"},"Days")))))),u.createElement(pt.a,null,u.createElement(L.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),u.createElement(L.a,{color:"primary",onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.selectedGoals=this.state.selectedGoals,this.props.node.timeoutTime=this.state.timeoutTime,this.props.node.timeoutUnit=this.state.timeoutUnit,this.props.node.recheckPeriodTime=this.state.recheckPeriodTime,this.props.node.recheckPeriodUnit=this.state.recheckPeriodUnit,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var on=Object(v.b)((function(e){const{goals:t,dispatch:a}=e;return{goals:t.availableGoals,dispatch:a,statistics:e.statistics.statistics}}))(sn);class rn extends U.AbstractNodeFactory{constructor(){super("goal")}generateReactWidget(e,t){return u.createElement(on,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"goal-node"})}getNewInstance(){return new tn}}class ln extends rt{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top","condition")}}class cn extends U.NodeModel{constructor(e){super("condition",e.id),this.name=e.name,this.conditions=e.conditions,this.addPort(new ln("left")),this.addPort(new ln("bottom")),this.addPort(new ln("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.conditions=e.conditions}serialize(){return nt.merge(super.serialize(),{name:this.name,conditions:this.conditions})}}var dn=a(105),mn=a.n(dn),pn=a(70),hn=a.n(pn),un=a(391);const gn=Object(Zt.a)(e=>({formControl:{marginRight:e.spacing(1),marginBottom:e.spacing(1),minWidth:150},formLabel:{display:"block",marginBottom:e.spacing(1)},amountInput:{marginRight:e.spacing(1),marginBottom:e.spacing(1)}}));function En(e){var t,a,n,i;const s=gn();void 0===e.values.operator&&e.blueprint.operators&&1===e.blueprint.operators.length&&e.dispatch(Xt(e.name,{operator:e.blueprint.operators[0]})),void 0===e.values.unit&&e.blueprint.units&&1===e.blueprint.units.length&&e.dispatch(Qt(e.name,{unit:e.blueprint.units[0]}));return g.a.createElement(g.a.Fragment,null,!e.hideLabel&&g.a.createElement(ta.a,{className:s.formLabel},e.blueprint.label),e.blueprint.operators&&e.blueprint.operators.length&&g.a.createElement(Bt.a,{className:s.formControl,disabled:1===e.blueprint.operators.length},g.a.createElement(Ut.a,null,"Operator"),g.a.createElement(Lt.a,{autoWidth:!0,value:null!==(t=e.values.operator)&&void 0!==t?t:"",onChange:t=>{e.dispatch(Qt(e.name,{operator:t.target.value}))}},e.blueprint.operators.map(e=>g.a.createElement(zt.a,{key:e,value:e},e)))),g.a.createElement(dt.a,{className:s.amountInput,label:e.blueprint.amountLabel,type:"number",onChange:t=>{e.dispatch(Qt(e.name,{selection:t.target.value}))},value:null!==(a=e.values.selection)&&void 0!==a?a:"",inputProps:null!==(n=e.blueprint.amountInputAttributes)&&void 0!==n?n:{}}),e.blueprint.units&&e.blueprint.units.length&&g.a.createElement(Bt.a,{className:s.formControl,disabled:1===e.blueprint.units.length},g.a.createElement(Ut.a,null,e.blueprint.unitsLabel),g.a.createElement(Lt.a,{autoWidth:!0,value:null!==(i=e.values.unit)&&void 0!==i?i:"",onChange:t=>{e.dispatch(Qt(e.name,{unit:t.target.value}))}},e.blueprint.units.map(e=>g.a.createElement(zt.a,{key:e,value:e},e)))))}var vn=a(61),bn=a.n(vn);function yn(){return{id:bn()(),key:"",params:[]}}function fn(e,t){switch(t.type){case"UPDATE_PARAM_VALUES":{let[a,n]=t.payload.name;return{...e,nodes:e.nodes.map(e=>e.id===a?{...e,params:e.params.map(e=>e.key===n?{...e,values:Object.assign(e.values,t.payload.values)}:e)}:e)}}case"SET_PARAM_VALUES":{let[a,n]=t.payload.name;return{...e,nodes:e.nodes.map(e=>e.id===a?{...e,params:e.params.map(e=>e.key===n?{...e,values:t.payload.values}:e)}:e)}}case"SET_EVENT":return{...e,nodes:[yn()],event:t.payload};case"ADD_CRITERION":return{...e,nodes:[...e.nodes,yn()]};case"DELETE_NODE":return{...e,nodes:e.nodes.filter(e=>e.id!==t.payload.nodeId)};case"SET_KEY_FOR_NODE":{let a=e.nodes.map(e=>t.payload.nodeId===e.id?{id:e.id,key:t.payload.key,params:t.payload.params}:e);return{...e,nodes:a}}default:throw new Error("unsupported action type "+t.type)}}const Nn=g.a.createContext(null);function Tn(e){const t=Object(u.useContext)(Nn);let a=e.node.params.filter(t=>t.key===e.blueprint.key)[0],n=[e.node.id,a.key];switch(e.blueprint.type){case"string_labeled_array":return g.a.createElement(da,{name:n,values:a.values,blueprint:e.blueprint,dispatch:t});case"boolean":return g.a.createElement(ea,{name:n,values:a.values,blueprint:e.blueprint,dispatch:t});case"number":return g.a.createElement(na,{name:n,values:a.values,blueprint:e.blueprint,dispatch:t,hideLabel:!0});case"timeframe":return g.a.createElement(En,{name:n,values:a.values,blueprint:e.blueprint,dispatch:t});default:throw new Error("unsupported node type "+e.blueprint.type)}}function Cn(e){return g.a.createElement(g.a.Fragment,null,e.blueprint.map(t=>g.a.createElement(Tn,{key:t.key,node:e.node,blueprint:t})))}const Sn=Object(Zt.a)({cardContent:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",backgroundColor:"#F2F2F2"},formControl:{minWidth:"180px"}});function _n(e){const t=Sn(),a=Object(u.useContext)(Nn);return g.a.createElement(Kt.a,null,g.a.createElement(qt.a,{className:t.cardContent},g.a.createElement(Bt.a,{className:t.formControl},g.a.createElement(Ut.a,{id:"select-criteria-label"},"Criterion"),g.a.createElement(Lt.a,{labelId:"select-criteria-label",id:"select-criteria",placeholder:"Select criteria",value:e.node.key,onChange:t=>{let n=e.criteriaBlueprint.filter(e=>e.key===t.target.value)[0].params.map(e=>({key:e.key,values:{}}));var i;a((i=e.node.id,{type:"SET_KEY_FOR_NODE",payload:{key:t.target.value,nodeId:i,params:n}}))}},e.criteriaBlueprint.map(e=>g.a.createElement(zt.a,{key:e.key,value:e.key},e.label)))),g.a.createElement(un.a,{onClick:()=>a({type:"DELETE_NODE",payload:{nodeId:e.node.id}}),size:"small",className:t.icon,"aria-label":"delete"},g.a.createElement(mn.a,null))),e.node.key&&g.a.createElement(qt.a,null,g.a.createElement(Cn,{node:e.node,blueprint:e.criteriaBlueprint.filter(t=>t.key===e.node.key)[0].params})))}const wn=Object(Zt.a)({andContainer:{display:"flex",justifyContent:"center",flexGrow:0,maxWidth:"100%",flexBasis:"100%"}});function kn(e){const t=wn(),a=Object(u.useContext)(Nn);return g.a.createElement(g.a.Fragment,null,e.nodes.map((a,n)=>g.a.createElement(g.a.Fragment,{key:a.id},n>=1&&g.a.createElement("div",{className:t.andContainer},"AND"),g.a.createElement(K.a,{item:!0,xs:12},g.a.createElement(_n,{node:a,criteriaBlueprint:e.criteriaBlueprint})))),g.a.createElement(K.a,{item:!0,xs:12},g.a.createElement(L.a,{onClick:()=>a({type:"ADD_CRITERION"}),className:t.button,startIcon:g.a.createElement(hn.a,null)},"Add criterion")))}const xn=Object(Zt.a)({selectedButton:{backgroundColor:"#E4E4E4"},deselectedButton:{color:"#A6A6A6"}});var Mn=Object(u.forwardRef)((function(e,t){const a=xn(),n=Object(v.c)(e=>e.criteria.criteria),[i,s]=Object(u.useReducer)(fn,{version:1,event:n[0].event,nodes:[yn()],...e.conditions});return Object(u.useImperativeHandle)(t,()=>({state:i})),g.a.createElement(Nn.Provider,{value:s},g.a.createElement(K.a,{container:!0,item:!0,xs:12,spacing:3},g.a.createElement(K.a,{item:!0,xs:12},g.a.createElement(Ta.a,{"aria-label":"outlined button group"},n.map(e=>g.a.createElement(L.a,{onClick:()=>s({type:"SET_EVENT",payload:e.event}),className:i.event===e.event?a.selectedButton:a.deselectedButton,key:e.event},e.event)))),n.filter(e=>e.event===i.event).map(e=>g.a.createElement(kn,{key:e.event,criteriaBlueprint:e.criteria,nodes:i.nodes}))))}));class Fn extends u.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,anchorElementForTooltip:null}),this.props.dispatch(bt(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(bt(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.builderRef=u.createRef(),this.state={nodeFormName:this.props.node.name,dialogOpened:!1,anchorElementForTooltip:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){let e=!1;return(0===this.props.statistics.length||this.props.statistics[this.props.node.id])&&(e=!0),u.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},u.createElement("div",{className:this.bem("__title")},u.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Condition")),u.createElement("div",{className:"node-container"},u.createElement("div",{className:this.bem("__icon")},u.createElement(le.a,null)),u.createElement("div",{className:this.bem("__ports")},u.createElement("div",{className:this.bem("__left")},u.createElement(vt,{name:"left",node:this.props.node})),u.createElement("div",{className:this.bem("__right")},u.createElement(vt,{name:"right",node:this.props.node}),e?u.createElement(St,{elementId:this.props.node.id,color:"#21ba45",position:"right"}):u.createElement(Pa.a,{style:{position:"absolute",top:"-5px",right:"-30px",color:"#2ECC40"}})),u.createElement("div",{className:this.bem("__bottom")},u.createElement(vt,{name:"bottom",node:this.props.node}),e?u.createElement(St,{elementId:this.props.node.id,color:"#db2828",position:"bottom"}):u.createElement(Ia.a,{style:{position:"absolute",top:"15px",right:"-5px",color:"#FF695E"}})))),u.createElement(kt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),u.createElement(mt.a,{fullWidth:!0,maxWidth:"md",open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},u.createElement(gt.a,{id:"form-dialog-title"},"Event Condition"),u.createElement(ht.a,null,u.createElement(K.a,{container:!0},u.createElement(K.a,{style:{marginBottom:"10px"},item:!0,xs:6},u.createElement(dt.a,{margin:"normal",id:"trigger-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}})),u.createElement(Mn,{conditions:this.props.node.conditions,ref:this.builderRef}))),u.createElement(pt.a,null,u.createElement(L.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),u.createElement(L.a,{color:"primary",onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.conditions=this.builderRef.current.state,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var On=Object(v.b)((function(e){const{dispatch:t}=e;return{dispatch:t,statistics:e.statistics.statistics}}))(Fn);class Pn extends U.AbstractNodeFactory{constructor(){super("condition")}generateReactWidget(e,t){return u.createElement(On,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"condition-node"})}getNewInstance(){return new cn}}class Dn extends ot{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left","push_notification")}}class In extends U.NodeModel{constructor(e){super("push_notification",e.id),this.name=e.name,this.selectedTemplate=e.selectedTemplate,this.selectedApplication=e.selectedApplication,this.addPort(new Dn("left")),this.addPort(new Dn("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.selectedTemplate=e.selectedTemplate,this.selectedApplication=e.selectedApplication}serialize(){return nt.merge(super.serialize(),{name:this.name,selectedTemplate:this.selectedTemplate,selectedApplication:this.selectedApplication})}}class An extends u.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,anchorElementForTooltip:null}),this.props.dispatch(bt(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(bt(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.getTemplatesInSelectableFormat=()=>this.props.templates.map(e=>({value:e.code,label:e.name})),this.getApplicationsInSelectableFormat=()=>this.props.applications.map(e=>({value:e.code,label:e.name})),this.getSelectedTemplateValue=()=>{const e=this.props.templates.find(e=>e.code===this.props.node.selectedTemplate);return e?" - ".concat(e.name):""},this.state={nodeFormName:this.props.node.name,selectedTemplate:this.props.node.selectedTemplate,selectedApplication:this.props.node.selectedApplication,dialogOpened:!1,anchorElementForTooltip:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){return u.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},u.createElement("div",{className:"node-container"},u.createElement("div",{className:this.bem("__icon")},u.createElement(ue.a,null)),u.createElement("div",{className:this.bem("__ports")},u.createElement("div",{className:this.bem("__left")},u.createElement(vt,{name:"left",node:this.props.node})),u.createElement("div",{className:this.bem("__right")},u.createElement(vt,{name:"right",node:this.props.node}),u.createElement(St,{elementId:this.props.node.id,color:"#dc73ff",position:"right"})))),u.createElement("div",{className:this.bem("__title")},u.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Notification ".concat(this.getSelectedTemplateValue()))),u.createElement(kt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),u.createElement(mt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},u.createElement(gt.a,{id:"form-dialog-title"},"Notification node"),u.createElement(ht.a,null,u.createElement(ut.a,null,"Sends a push notification to user."),u.createElement(K.a,{container:!0},u.createElement(K.a,{item:!0,xs:6},u.createElement(dt.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),u.createElement(K.a,{container:!0,alignItems:"center",alignContent:"space-between"},u.createElement(K.a,{item:!0,xs:12},u.createElement(xt.a,{value:this.getTemplatesInSelectableFormat().find(e=>e.value===this.state.selectedTemplate),options:this.getTemplatesInSelectableFormat(),getOptionLabel:e=>e.label,style:{marginBottom:16},onChange:(e,t)=>{null!==t&&this.setState({selectedTemplate:t.value})},renderInput:e=>u.createElement(dt.a,Object.assign({},e,{variant:"standard",label:"Notification template",fullWidth:!0}))}))),u.createElement(K.a,{container:!0,alignItems:"center",alignContent:"space-between"},u.createElement(K.a,{item:!0,xs:12},u.createElement(xt.a,{value:this.getApplicationsInSelectableFormat().find(e=>e.value===this.state.selectedApplication),options:this.getApplicationsInSelectableFormat(),getOptionLabel:e=>e.label,style:{marginBottom:16},onChange:(e,t)=>{null!==t&&this.setState({selectedApplication:t.value})},renderInput:e=>u.createElement(dt.a,Object.assign({},e,{variant:"standard",label:"Application",fullWidth:!0}))})))),u.createElement(pt.a,null,u.createElement(L.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),u.createElement(L.a,{color:"primary",onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.selectedTemplate=this.state.selectedTemplate,this.props.node.selectedApplication=this.state.selectedApplication,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var Bn=Object(v.b)((function(e){return{templates:e.pushNotifications.availableTemplates,applications:e.pushNotifications.availableApplications}}))(An);class Un extends U.AbstractNodeFactory{constructor(){super("push_notification")}generateReactWidget(e,t){return u.createElement(Bn,{diagramEngine:e,node:t,classBaseName:"square-node",className:"push-notification-node"})}getNewInstance(){return new In}}class Ln extends rt{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"right","ab_test")}}class zn extends U.NodeModel{constructor(e){super("ab_test",e.id),this.name=e.name,this.scenarioName=e.scenarioName,e.variants?this.variants=e.variants:this.variants=[{code:bn()().slice(0,6),name:"Variant A",distribution:50},{code:bn()().slice(0,6),name:"Variant B",distribution:50}],this.addPort(new Ln("left")),this.variants.forEach((e,t)=>this.addPort(new Ln("right."+t)))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.variants=e.variants}serialize(){return nt.merge(super.serialize(),{name:this.name,variants:this.variants})}}var Wn=a(385),Rn=a(400),jn=a(170),Gn=a.n(jn),Vn=a(171),Hn=a.n(Vn);function Kn(e,t){let a=!1;switch(t.type){case"ADD_VARIANT":return{...e,variants:[...e.variants,{code:bn()().slice(0,6),name:"Variant "+String.fromCharCode(65+e.variants.length),distribution:0}]};case"DELETE_VARIANT":let n=e.variants.filter((e,a)=>a!==t.payload.index);return 100!==n.reduce((e,t)=>e+parseInt(t.distribution),0)&&(a=!0),{...e,variants:n,isError:a};case"UPDATE_VARIANT_DISTRIBUTION":return a=e.variants.filter((e,a)=>a!==t.payload.index).reduce((e,t)=>e+parseInt(t.distribution),0)+parseInt(t.payload.value)!==100,{...e,variants:e.variants.map((e,a)=>a===t.payload.index?{...e,distribution:t.payload.value}:e),isError:a};case"UPDATE_VARIANT_NAME":return{...e,variants:e.variants.map((e,a)=>a===t.payload.index?{...e,name:t.payload.value}:e)};case"UPDATE_SEGMENT_NAME":return{...e,variants:e.variants.map((e,a)=>a===t.payload.index?{...e,segment:{name:t.payload.name}}:e)};default:throw new Error("unsupported action type "+t.type)}}function qn(e){var t;const a="Scenario variant: "+e.scenarioName+" - "+e.nodeName+" - "+e.variantName+" ("+e.variantCode+")",[n,i]=g.a.useState(!1),[s,o]=g.a.useState(null!==(t=e.segment.name)&&void 0!==t?t:a);return g.a.createElement(Bt.a,null,g.a.createElement(L.a,{size:"small",variant:"outlined",color:"secondary",disableElevation:!0,onClick:()=>{i(!0)},startIcon:e.segment.name?g.a.createElement(Gn.a,null):g.a.createElement(hn.a,null)},e.segment.name?"Edit segment":"Create segment"),g.a.createElement(mt.a,{open:n,fullWidth:!0,maxWidth:"md"},g.a.createElement(gt.a,{id:"form-dialog-title"},e.segment.name?"Edit segment":"Create segment"),g.a.createElement(ht.a,null,g.a.createElement(ut.a,null,"To create associated segment to variant, please enter segment name."),g.a.createElement(dt.a,{autoFocus:!0,margin:"dense",label:"Segment name",type:"string",value:s,onChange:e=>{o(e.target.value)},fullWidth:!0}),e.segment.code?g.a.createElement("div",null,g.a.createElement(dt.a,{fullWidth:!0,margin:"dense",label:"Segment code",type:"string",value:e.segment.code,disabled:!0}),g.a.createElement(L.a,{size:"small",variant:"outlined",color:"secondary",disableElevation:!0,startIcon:g.a.createElement(Hn.a,null),onClick:()=>{window.open(Be+e.segment.id)}},"View segment")):""),g.a.createElement(pt.a,null,g.a.createElement(L.a,{onClick:()=>{var t;o(null!==(t=e.segment.name)&&void 0!==t?t:a),i(!1)},color:"secondary"},"Cancel"),g.a.createElement(L.a,{onClick:()=>{e.dispatch({type:"UPDATE_SEGMENT_NAME",payload:{index:e.index,name:s}}),i(!1)},color:"primary"},e.segment.name?"Save":"Create"))))}var Zn=Object(u.forwardRef)((function(e,t){const[a,n]=Object(u.useReducer)(Kn,{...e});return void 0!==a.isError&&e.onEnableSave(!a.isError),Object(u.useImperativeHandle)(t,()=>({state:a})),g.a.createElement("form",{autoComplete:"off",noValidate:!0},a.variants.flatMap((t,i)=>{var s;return g.a.createElement(K.a,{container:!0,spacing:1,key:"grid-index-"+i},g.a.createElement(K.a,{item:!0,xs:1},g.a.createElement(dt.a,{disabled:!0,label:"ID",value:t.code})),g.a.createElement(K.a,{item:!0,xs:5},g.a.createElement(Bt.a,{fullWidth:!0},g.a.createElement(dt.a,{label:"Variant name",value:t.name,required:!0,onChange:e=>n({type:"UPDATE_VARIANT_NAME",payload:{index:i,value:e.target.value}})}))),g.a.createElement(K.a,{item:!0,xs:2},g.a.createElement(Bt.a,null,g.a.createElement(Ut.a,{error:a.isError},"Distribution"),g.a.createElement(Wn.a,{error:a.isError,required:!0,type:"number",value:t.distribution,onChange:e=>n({type:"UPDATE_VARIANT_DISTRIBUTION",payload:{index:i,value:e.target.value}}),endAdornment:g.a.createElement(Rn.a,{position:"end"},"%")}))),g.a.createElement(K.a,{item:!0,xs:1,style:{display:"flex",alignItems:"center",justifyContent:"space-evenly"}},i>1&&g.a.createElement(un.a,{onClick:()=>{n({type:"DELETE_VARIANT",payload:{index:i}})},size:"small","aria-label":"delete"},g.a.createElement(mn.a,null))),g.a.createElement(K.a,{item:!0,xs:3,style:{display:"flex",alignItems:"center"}},g.a.createElement(qn,{index:i,variantCode:t.code,segment:null!==(s=t.segment)&&void 0!==s?s:{},dispatch:n,variantName:t.name,nodeName:e.node.name,scenarioName:e.node.scenarioName})))}),g.a.createElement(K.a,{container:!0},g.a.createElement(K.a,{item:!0,xs:12},g.a.createElement(L.a,{startIcon:g.a.createElement(hn.a,null),onClick:()=>{n({type:"ADD_VARIANT"})}},"Add variant"))))}));class Yn extends u.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,anchorElementForTooltip:null}),this.props.dispatch(bt(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(bt(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.enableSave=e=>{this.state.enabledSave!==e&&this.setState({enabledSave:e})},this.syncNodeModel=()=>{this.props.node.variants.forEach((e,t)=>{this.props.node.getPort("right."+t)||this.props.node.addPort(new Ln("right."+t))});for(const e in this.props.node.getPorts())if(e.startsWith("right.")){let t=e.split(".")[1];if(!this.props.node.variants[t]){let t=this.props.node.getPort(e);for(const[e]of Object.entries(t.getLinks()))this.props.diagramEngine.diagramModel.removeLink(e);this.props.node.removePort(t)}}},this.builderRef=u.createRef(),this.state={nodeFormName:this.props.node.name,enabledSave:!0,dialogOpened:!1,anchorElementForTooltip:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){return u.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},u.createElement("div",{className:this.bem("__title")},u.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"AB Test")),u.createElement("div",{className:"node-container"},u.createElement("div",{className:this.bem("__icon")},u.createElement(Ee.a,null)),u.createElement("div",{className:this.bem("__ports")},u.createElement("div",{className:this.bem("__left")},u.createElement(vt,{name:"left",node:this.props.node}))),u.createElement("div",{className:this.bem("__ports")},this.props.node.variants.flatMap((e,t)=>u.createElement("div",{className:this.bem("__right"),key:"right-port-"+t,style:{position:"relative"}},u.createElement(vt,{name:"right."+t,node:this.props.node}),u.createElement("div",{className:this.bem("__description")},u.createElement(St,{elementId:this.props.node.id,index:e.code,color:"#767676",position:"right-condensed"}),u.createElement(H.a,{style:{fontSize:"0.8rem",marginLeft:"5px"},noWrap:!0},e.name," (",e.distribution,"%)")))))),u.createElement(kt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip,variants:this.props.node.variants}),u.createElement(mt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,maxWidth:"md","aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},u.createElement(gt.a,{id:"form-dialog-title"},"AB Test"),u.createElement(ht.a,null,u.createElement(ut.a,null,"A/B testing is comparing two versions of either a webpage, email campaign or an aspect in a scenario to evaluate which performs best. With the different variants shown to your customers, you can determine which version is the most effective."),u.createElement(K.a,{container:!0},u.createElement(K.a,{style:{marginBottom:"10px"},item:!0,xs:6},u.createElement(dt.a,{margin:"normal",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),u.createElement(Zn,{variants:this.props.node.variants,node:this.props.node,onEnableSave:this.enableSave,ref:this.builderRef})),u.createElement(pt.a,null,u.createElement(L.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),u.createElement(L.a,{color:"primary",disabled:!this.state.enabledSave,onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.variants=this.builderRef.current.state.variants,this.syncNodeModel(),this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var Jn=Object(v.b)((function(e){const{dispatch:t}=e;return{dispatch:t}}))(Yn);class Xn extends U.AbstractNodeFactory{constructor(){super("ab_test")}generateReactWidget(e,t){return u.createElement(Jn,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"abtest-node"})}getNewInstance(){return new zn}}var Qn=a(404),$n=a(405),ei=a(406),ti=a(407);class ai extends u.Component{constructor(e){super(e),this.saveChanges=()=>{const{dispatch:e}=this.props;if(this.props.app.isCorruptedPayload())return void e(yt({open:!0,variant:"error",text:"Cannot modify corrupted scenario."}));const t=new je(this.props.app.getDiagramEngine().getDiagramModel()),a={name:this.props.scenario.name,...t.exportPayload()},n=this.props.scenario.id;n&&(a.id=n),e(Tt(!0)),N.a.post("".concat(Ce),a).then(t=>{e(ft(t.data.id)),e(Tt(!1)),e(yt({open:!0,variant:"success",text:"Scenario saving succeeded."}))}).catch(t=>{e(Tt(!1));let a="Scenario saving failed.";t.response.data&&t.response.data.message&&(a=t.response.data.message),e(yt({open:!0,variant:"error",text:a})),console.log(t)})},this.startEditingName=()=>{this.setState({editedName:this.props.scenario.name,editingName:!0})},this.cancelEditingName=()=>{this.setState({editedName:"",editingName:!1})},this.submitEditingName=()=>{0!==this.state.editedName.trim().length?(this.props.dispatch(Nt(this.state.editedName)),this.setState({editedName:"",editingName:!1})):this.cancelEditingName()},this.handleCloseAndSaveDuringChangingName=e=>{27===e.keyCode?this.cancelEditingName():13===e.keyCode&&this.submitEditingName()},this.handleNameTyping=e=>{this.setState({editedName:e.target.value})},this.closeNotification=()=>{this.props.dispatch(yt({open:!1}))},this.zoomOut=()=>{let e=this.props.app.diagramEngine.getDiagramModel().getZoomLevel();this.props.app.diagramEngine.getDiagramModel().setZoomLevel(e-5),this.props.app.diagramEngine.repaintCanvas()},this.zoomIn=()=>{let e=this.props.app.diagramEngine.getDiagramModel().getZoomLevel();this.props.app.diagramEngine.getDiagramModel().setZoomLevel(e+5),this.props.app.diagramEngine.repaintCanvas()},this.zoomToFit=()=>{this.props.app.diagramEngine.zoomToFit()},this.state={editingName:!1,editedName:""},this.ctrlDown=!1,this.nodesToCopy=[],this.keydownHandler=this.keydownHandler.bind(this),this.keyupHandler=this.keyupHandler.bind(this),this.copyNode=this.copyNode.bind(this)}copyNode(e){let t=75,a=75,n=this.props.app.getDiagramEngine().getDiagramModel(),i=n.getNodes();if(void 0!==i[e]){let s=i[e].clone({});s.setPosition(s.x+t,s.y+a),s.selected=!1,n.addNode(s),this.forceUpdate()}else console.warn("Unable to copy node with ID "+e)}keydownHandler(e){if(17!==e.keyCode&&91!==e.keyCode||(this.ctrlDown=!0),this.ctrlDown&&67===e.keyCode){let e=this.props.app.getDiagramEngine().getDiagramModel();this.nodesToCopy=[];for(const t of e.getSelectedItems())t.selected&&t instanceof U.NodeModel&&this.nodesToCopy.push(t.id)}if(this.ctrlDown&&86===e.keyCode){for(const e of this.nodesToCopy)this.copyNode(e);this.nodesToCopy=[]}}keyupHandler(e){17!==e.keyCode&&91!==e.keyCode||(this.ctrlDown=!1)}componentDidMount(){document.addEventListener("keydown",this.keydownHandler),document.addEventListener("keyup",this.keyupHandler)}componentWillUnmount(){document.removeEventListener("keydown",this.keydownHandler),document.removeEventListener("keyup",this.keyupHandler)}componentDidUpdate(e){!0===this.props.app.isCorruptedPayload()&&!1===e.app.isCorruptedPayload()&&this.props.dispatch(yt({open:!0,variant:"error",text:"Unable to load corrupted scenario."}))}render(){const{classes:e,canvas:t}=this.props,a={className:"srd-demo-canvas",diagramEngine:this.props.app.getDiagramEngine(),maxNumberPointsPerLink:0,allowLooseLinks:!1,allowCanvasTranslation:t.pannable,allowCanvasZoom:t.zoomable};return u.createElement("div",{className:"body"},u.createElement("div",{className:e.root},u.createElement(R.a,null),u.createElement(W.a,{position:"fixed",className:e.appBar},u.createElement(j.a,null,u.createElement(K.a,{container:!0},u.createElement(K.a,{item:!0,xs:4},u.createElement(H.a,{variant:"h6",color:"inherit",noWrap:!0},this.state.editingName?u.createElement("input",{autoFocus:!0,type:"text",value:this.state.editedName,onChange:this.handleNameTyping,onKeyDown:this.handleCloseAndSaveDuringChangingName,onBlur:this.submitEditingName,className:"changing-name-input"}):u.createElement("span",{onClick:this.startEditingName,className:"scenario-name"},this.props.scenario.name))),u.createElement(K.a,{item:!0,xs:8},u.createElement(K.a,{container:!0,direction:"row",justify:"flex-end"},!!this.props.scenario.loading&&u.createElement(Z.a,{className:"circular-loading",size:19,color:"inherit"}),u.createElement(L.a,{title:"Zoom in",size:"small",variant:"contained",color:"primary",onClick:()=>this.zoomIn()},u.createElement(Qn.a,null)),u.createElement(L.a,{title:"Zoom out",size:"small",variant:"contained",color:"primary",onClick:()=>this.zoomOut()},u.createElement($n.a,{titleAccess:"Test"})),u.createElement(L.a,{title:"Zoom to fit",size:"small",variant:"contained",color:"primary",onClick:()=>this.zoomToFit()},u.createElement(ei.a,null)),u.createElement(ti.a,{orientation:"vertical",variant:"middle",flexItem:!0}),u.createElement(L.a,{size:"small",variant:"contained",color:"secondary",onClick:()=>this.saveChanges()},this.props.scenario.id?"Update":"Save")))))),u.createElement(z.a,{className:e.drawer,variant:"permanent",classes:{paper:e.drawerPaper}},u.createElement("div",{className:e.toolbar}),u.createElement(G.a,{component:"nav",subheader:u.createElement(V.a,{component:"div"},"Triggers")},u.createElement(We,{model:{type:"trigger"},name:"Event",icon:u.createElement(ae.a,null)}),u.createElement(We,{model:{type:"before_trigger"},name:"Before Event",icon:u.createElement(pe.a,null)})),u.createElement(G.a,{component:"nav",subheader:u.createElement(V.a,{component:"div"},"Actions")},u.createElement(We,{model:{type:"email"},name:"Send email",icon:u.createElement(J.a,null)}),u.createElement(We,{model:{type:"generic"},name:"Run generic action",icon:u.createElement(Q.a,null)}),fe&&u.createElement(We,{model:{type:"banner"},name:"Show banner",icon:u.createElement(ee.a,null)}),Ne&&u.createElement(We,{model:{type:"push_notification"},name:"Send notification",icon:u.createElement(ue.a,null)})),u.createElement(G.a,{component:"nav",subheader:u.createElement(V.a,{component:"div"},"Operations")},u.createElement(We,{model:{type:"segment"},name:"Segment",icon:u.createElement(oe.a,null)}),u.createElement(We,{model:{type:"condition"},name:"Condition",icon:u.createElement(le.a,null)}),u.createElement(We,{model:{type:"wait"},name:"Wait",icon:u.createElement(ie.a,null)}),u.createElement(We,{model:{type:"goal"},name:"Goal",icon:u.createElement(de.a,null)}),u.createElement(We,{model:{type:"ab_test"},name:"AB Test",icon:u.createElement(Ee.a,null)}))),u.createElement(tt,{variant:this.props.canvas.notification.variant,text:this.props.canvas.notification.text,open:this.props.canvas.notification.open,handleClose:this.closeNotification}),u.createElement("main",{className:e.content},u.createElement("div",{className:"diagram-layer",onDrop:e=>{const t=e.dataTransfer.getData("storm-diagram-node");if(t){var a=JSON.parse(t),u=null;"email"===a.type?u=new n.NodeModel({}):"generic"===a.type?u=new s.NodeModel({}):"banner"===a.type?u=new i.NodeModel({expiresInUnit:"days",expiresInTime:1}):"push_notification"===a.type?u=new p.NodeModel({}):"segment"===a.type?u=new o.NodeModel({}):"condition"===a.type?u=new m.NodeModel({}):"trigger"===a.type?u=new r.NodeModel({}):"before_trigger"===a.type?u=new l.NodeModel({}):"wait"===a.type?u=new c.NodeModel({}):"goal"===a.type?u=new d.NodeModel({recheckPeriodUnit:"hours",recheckPeriodTime:1}):"ab_test"===a.type&&(u=new h.NodeModel({name:"AB Test",scenarioName:this.props.scenario.name}));var g=this.props.app.getDiagramEngine().getRelativeMousePoint(e);u.x=g.x,u.y=g.y,this.props.app.getDiagramEngine().getDiagramModel().addNode(u),this.forceUpdate()}},onDragOver:e=>{e.preventDefault()}},u.createElement(U.DiagramWidget,a)))))}}var ni=B()(Object(q.a)(e=>({root:{display:"flex"},appBar:{zIndex:e.zIndex.drawer+1},drawer:{width:240,flexShrink:0},drawerPaper:{width:240},content:{flexGrow:1,padding:0},toolbar:e.mixins.toolbar}),{name:"BodyWidget"}),Object(v.b)((function(e){return{canvas:e.canvas,scenario:e.scenario}}),null))(ai),ii=(a(243),a(110)),si=a.n(ii);function oi(e){return 0===e?{unit:"minutes",time:e}:e%1440===0?{unit:"days",time:e/1440}:e%60===0?{unit:"hours",time:e/60}:{unit:"minutes",time:e}}class ri{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.activeModel=e,this.payload=t}renderPayload(e){this.payload=e;const t=this.payload.visual;si()(e.elements,e=>{let a=null;if("segment"===e.type)e.selectedSegment=e.segment.code,a=new o.NodeModel(e);else if("condition"===e.type)a=new m.NodeModel({id:e.id,name:e.name,conditions:e.condition.conditions});else if("email"===e.type)e.selectedMail=e.email.code,a=new n.NodeModel(e);else if("generic"===e.type)e.selectedGeneric=e.generic.code,e.options=e.generic.options,a=new s.NodeModel(e);else if("wait"===e.type){const t=oi(e.wait.minutes);e.waitingUnit=t.unit,e.waitingTime=t.time,a=new c.NodeModel(e)}else if("banner"===e.type){if(!fe)throw Error("BANNER_ENABLED configuration is false, but loaded scenario contains banner element.");const t=oi(e.banner.expiresInMinutes);e.expiresInUnit=t.unit,e.expiresInTime=t.time,e.selectedBanner=e.banner.id,a=new i.NodeModel(e)}else if("goal"===e.type){if(e.goal.hasOwnProperty("timeoutMinutes")){const t=oi(e.goal.timeoutMinutes);e.timeoutUnit=t.unit,e.timeoutTime=t.time}const t=oi(e.goal.recheckPeriodMinutes);e.recheckPeriodUnit=t.unit,e.recheckPeriodTime=t.time,e.selectedGoals=e.goal.codes,a=new d.NodeModel(e)}else"push_notification"===e.type?(e.selectedTemplate=e.push_notification.template,e.selectedApplication=e.push_notification.application,a=new p.NodeModel(e)):"ab_test"===e.type&&(a=new h.NodeModel({id:e.id,name:e.name,variants:e.ab_test.variants,scenarioName:this.payload.name}));this.activeModel.addNode(a),a.setPosition(t[e.id].x,t[e.id].y)}),si()(e.elements,e=>{let t=this.activeModel.getNode(e.id);e[e.type].descendants.forEach(e=>{this.linkNodes(t,this.activeModel.getNode(e.uuid),e.direction,e.position)})}),si()(e.triggers,e=>{let a=null;if("event"===e.type)e.selectedTrigger=e.event.code,a=new r.NodeModel(e);else if("before_event"===e.type){const t=oi(e.options.minutes);e.timeUnit=t.unit,e.time=t.time,e.selectedTrigger=e.event.code,a=new l.NodeModel(e)}this.activeModel.addNode(a),a.setPosition(t[e.id].x,t[e.id].y),e.elements.forEach(e=>{this.linkNodes(a,this.activeModel.getNode(e))})})}linkNodes(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(a){if("positive"===a){let a;return a="ab_test"===e.type?e.getPort("right."+n).link(t.getPort("left")):e.getPort("right").link(t.getPort("left")),void this.activeModel.addLink(a)}if("negative"===a){const a=e.getPort("bottom").link(t.getPort("left"));return void this.activeModel.addLink(a)}}const i=e.getPort("right").link(t.getPort("left"));this.activeModel.addLink(i)}}class li{constructor(e){this.diagramEngine=new U.DiagramEngine,this.diagramEngine.installDefaultFactories(),this.activeModel=new U.DiagramModel,this.renderService=new ri(this.activeModel),this.payload=e,this.corruptedPayload=!1,e?this.renderPayload():this.registerCustomModels()}renderPayload(){this.registerCustomModels();try{this.renderService.renderPayload(this.payload)}catch(e){console.log(e.message),this.corruptedPayload=!0,this.activeModel=new U.DiagramModel}this.diagramEngine.setDiagramModel(this.activeModel),this.diagramEngine.repaintCanvas()}registerCustomModels(){this.diagramEngine.registerLinkFactory(new st),this.diagramEngine.registerPortFactory(new at("email",e=>new n.PortModel)),this.diagramEngine.registerNodeFactory(new n.NodeFactory),this.diagramEngine.registerPortFactory(new at("generic",e=>new s.PortModel)),this.diagramEngine.registerNodeFactory(new s.NodeFactory),this.diagramEngine.registerPortFactory(new at("segment",e=>new o.PortModel)),this.diagramEngine.registerNodeFactory(new o.NodeFactory),this.diagramEngine.registerPortFactory(new at("trigger",e=>new r.PortModel)),this.diagramEngine.registerNodeFactory(new r.NodeFactory),this.diagramEngine.registerPortFactory(new at("before_trigger",e=>new l.PortModel)),this.diagramEngine.registerNodeFactory(new l.NodeFactory),this.diagramEngine.registerPortFactory(new at("wait",e=>new c.PortModel)),this.diagramEngine.registerNodeFactory(new c.NodeFactory),this.diagramEngine.registerPortFactory(new at("goal",e=>new d.PortModel)),this.diagramEngine.registerNodeFactory(new d.NodeFactory),this.diagramEngine.registerPortFactory(new at("banner",e=>new i.PortModel)),this.diagramEngine.registerNodeFactory(new i.NodeFactory),this.diagramEngine.registerPortFactory(new at("condition",e=>new m.PortModel)),this.diagramEngine.registerNodeFactory(new m.NodeFactory),this.diagramEngine.registerPortFactory(new at("push_notification",e=>new p.PortModel)),this.diagramEngine.registerNodeFactory(new p.NodeFactory),this.diagramEngine.registerPortFactory(new at("ab_test",e=>new h.PortModel)),this.diagramEngine.registerNodeFactory(new h.NodeFactory)}getActiveDiagram(){return this.activeModel}getDiagramEngine(){return this.diagramEngine}isCorruptedPayload(){return this.corruptedPayload}}class ci extends u.Component{componentDidMount(){const{dispatch:e}=this.props;var t;e(e=>(e(Tt(!0)),N.a.get("".concat(_e)).then(t=>{e({type:"segments_changed",payload:t.data.result}),e(Tt(!1))}).catch(t=>{console.log(t),e(Tt(!1)),e(yt({open:!0,variant:"error",text:"Segments fetching failed."}))}))),e(e=>(e(Tt(!0)),N.a.get(Se).then(t=>{e({type:"criteria_changed",payload:t.data.blueprint}),e(Tt(!1))}).catch(t=>{console.log(t),e(Tt(!1)),e(yt({open:!0,variant:"error",text:"Criteria fetching failed."}))}))),e(e=>(e(Tt(!0)),N.a.get(Fe).then(t=>{e({type:"goals_changed",payload:t.data.goals}),e(Tt(!1))}).catch(t=>{e(Tt(!1)),console.log(t),e(yt({open:!0,variant:"error",text:"Goals fetching failed."}))}))),e(e=>(e(Tt(!0)),N.a.get("".concat(we)).then(t=>{e({type:"triggers_changed",payload:t.data.events}),e(Tt(!1))}).catch(t=>{e(Tt(!1)),console.log(t),e(yt({open:!0,variant:"error",text:"Triggers fetching failed."}))}))),e(e=>(e(Tt(!0)),N.a.get("".concat(ke)).then(t=>{e({type:"before_triggers_changed",payload:t.data.events}),e(Tt(!1))}).catch(t=>{e(Tt(!1)),console.log(t),e(yt({open:!0,variant:"error",text:"Triggers fetching failed."}))}))),e(e=>(e(Tt(!0)),N.a.get("".concat(xe)).then(t=>{e({type:"mails_changed",payload:t.data.mail_templates}),e(Tt(!1))}).catch(t=>{e(Tt(!1)),console.log(t),e(yt({open:!0,variant:"error",text:"Mails fetching failed."}))}))),e(e=>(e(Tt(!0)),N.a.get("".concat(Me)).then(t=>{e({type:"generics_changed",payload:t.data}),e(Tt(!1))}).catch(t=>{e(Tt(!1)),console.log(t),e(yt({open:!0,variant:"error",text:"Generics fetching failed."}))}))),fe&&e(e=>(e(Tt(!0)),N.a.get(Oe).then(t=>{e({type:"banners_changed",payload:t.data.banners}),e(Tt(!1))}).catch(t=>{e(Tt(!1)),console.log(t),e(yt({open:!0,variant:"error",text:"Banners fetching failed."}))}))),Ne&&e(e=>{e(Tt(!0));let t=N.a.get("".concat(Pe)),a=N.a.get("".concat(De));return N.a.all([t,a]).then(t=>{var a,n;e((a=t[0].data.templates,n=t[1].data.applications,{type:"push_notifications_changed",payload:{templates:a,applications:n}})),e(Tt(!1))}).catch(t=>{e(Tt(!1)),console.log(t),e(yt({open:!0,variant:"error",text:"Notifications fetching failed."}))})}),ye?(e((t=ye,e=>(e(Tt(!0)),N.a.get(Te+t).then(t=>{e({type:"set_scenario_payload",payload:t.data}),e(Nt(t.data.name)),e(ft(t.data.id)),e(Tt(!1))}).catch(t=>{e(Tt(!1)),e(yt({open:!0,variant:"error",text:"Scenario fetching failed."})),console.log(t)})))),e(function(e){return t=>N.a.get(Ie+e).then(e=>{t({type:"statistics_changed",payload:e.data})}).catch(e=>{console.log(e)})}(ye))):e(Nt("Unnamed scenario"))}render(){var e=new li(this.props.scenarioPayload);return g.a.createElement(ni,{app:e})}}var di=Object(v.b)((function(e){return{scenarioPayload:e.scenario.payload}}))(ci);window.__MUI_USE_NEXT_TYPOGRAPHY_VARIANTS__=!0,N.a.defaults.headers.common.Authorization=ve;const mi=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||b.c,pi=Object(b.d)(I,{},mi(Object(b.a)(y.a)));Object(E.render)(g.a.createElement(v.a,{store:pi},g.a.createElement(di,null)),document.getElementById("root"))}},[[194,1,2]]]);