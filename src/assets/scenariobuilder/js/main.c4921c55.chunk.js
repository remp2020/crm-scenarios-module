(this["webpackJsonpremp-scenario-builder"]=this["webpackJsonpremp-scenario-builder"]||[]).push([[0],{208:function(e,t,n){e.exports=n(355)},267:function(e,t,n){},355:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"NodeModel",(function(){return Et})),n.d(a,"NodeFactory",(function(){return Gt})),n.d(a,"PortModel",(function(){return bt}));var i={};n.r(i),n.d(i,"NodeModel",(function(){return Ht})),n.d(i,"NodeFactory",(function(){return Qt})),n.d(i,"PortModel",(function(){return Vt}));var r={};n.r(r),n.d(r,"NodeModel",(function(){return en})),n.d(r,"NodeFactory",(function(){return Mn})),n.d(r,"PortModel",(function(){return $t}));var o={};n.r(o),n.d(o,"NodeModel",(function(){return Pn})),n.d(o,"NodeFactory",(function(){return Jn})),n.d(o,"PortModel",(function(){return Fn}));var l={};n.r(l),n.d(l,"NodeModel",(function(){return Qn})),n.d(l,"NodeFactory",(function(){return ta})),n.d(l,"PortModel",(function(){return Xn}));var s={};n.r(s),n.d(s,"NodeModel",(function(){return aa})),n.d(s,"NodeFactory",(function(){return oa})),n.d(s,"PortModel",(function(){return na}));var c={};n.r(c),n.d(c,"NodeModel",(function(){return sa})),n.d(c,"NodeFactory",(function(){return ma})),n.d(c,"PortModel",(function(){return la}));var d={};n.r(d),n.d(d,"NodeModel",(function(){return pa})),n.d(d,"NodeFactory",(function(){return ba})),n.d(d,"PortModel",(function(){return ua}));var m={};n.r(m),n.d(m,"NodeModel",(function(){return ya})),n.d(m,"NodeFactory",(function(){return Ga})),n.d(m,"PortModel",(function(){return Ea}));var u={};n.r(u),n.d(u,"NodeModel",(function(){return Ha})),n.d(u,"NodeFactory",(function(){return Za})),n.d(u,"PortModel",(function(){return Va}));var p={};n.r(p),n.d(p,"NodeModel",(function(){return Ja})),n.d(p,"NodeFactory",(function(){return si})),n.d(p,"PortModel",(function(){return Ya}));var h=n(0),g=n.n(h),f=n(20),v=n(18),b=n(84),E=n(186),y=n(22),O=n.n(y),N=n(8),j={avalaibleSegments:[]},k={criteria:[]},T={avalaibleTriggers:[]},C={availableBeforeTriggers:[]},S={pannable:!0,zoomable:!0,notification:{open:!1,variant:"success",text:""}},_={id:null,name:"",loading:0,payload:null},w={availableMails:[]},M={generics:[]},F={availableGoals:[]},P={availableBanners:[]},x={availableTemplates:[],availableApplications:[]},D={statistics:[]},I=Object(b.b)({segments:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"segments_changed":return Object(N.a)(Object(N.a)({},e),{},{avalaibleSegments:t.payload});default:return e}},triggers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"triggers_changed":return Object(N.a)(Object(N.a)({},e),{},{avalaibleTriggers:t.payload});default:return e}},beforeTriggers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"before_triggers_changed":return Object(N.a)(Object(N.a)({},e),{},{availableBeforeTriggers:t.payload});default:return e}},canvas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"canvas_pannable":return Object(N.a)(Object(N.a)({},e),{},{pannable:t.payload});case"canvas_zoomable":return Object(N.a)(Object(N.a)({},e),{},{zoomable:t.payload});case"canvas_zoomable_pannable":return Object(N.a)(Object(N.a)({},e),{},{zoomable:t.payload,pannable:t.payload});case"canvas_notification":return Object(N.a)(Object(N.a)({},e),{},{notification:Object(N.a)(Object(N.a)({},e.notification),t.payload)});default:return e}},criteria:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"criteria_changed":return Object(N.a)(Object(N.a)({},e),{},{criteria:t.payload});default:return e}},scenario:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"set_scenario_id":return Object(N.a)(Object(N.a)({},e),{},{id:t.payload});case"set_scenario_name":return Object(N.a)(Object(N.a)({},e),{},{name:t.payload});case"set_scenario_loading":var n=e.loading;return t.payload?++n:--n,Object(N.a)(Object(N.a)({},e),{},{loading:n});case"set_scenario_payload":return Object(N.a)(Object(N.a)({},e),{},{payload:t.payload});default:return e}},mails:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"mails_changed":return Object(N.a)(Object(N.a)({},e),{},{availableMails:t.payload});default:return e}},generics:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"generics_changed":return Object(N.a)(Object(N.a)({},e),{},{generics:t.payload});default:return e}},goals:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"goals_changed":return Object(N.a)(Object(N.a)({},e),{},{availableGoals:t.payload});default:return e}},banners:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"banners_changed":return Object(N.a)(Object(N.a)({},e),{},{availableBanners:t.payload});default:return e}},pushNotifications:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"push_notifications_changed":return Object(N.a)(Object(N.a)({},e),{},{availableTemplates:t.payload.templates,availableApplications:t.payload.applications});default:return e}},statistics:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"statistics_changed":return Object(N.a)(Object(N.a)({},e),{},{statistics:t.payload.statistics});default:return e}}}),A=n(4),B=n(5),U=n(7),L=n(6),z=n(142),W=n(81),R=n(173),G=n.n(R),V=n(12),H=n(358),K=n(436),q=n(426),Z=n(425),Y=n(427),J=n(413),X=n(414),Q=n(63),$=n(408),ee=n(9),te=n(400),ne=n(94),ae=n.n(ne),ie=n(110),re=n.n(ie),oe=n(109),le=n.n(oe),se=n(113),ce=n.n(se),de=n(115),me=n.n(de),ue=n(111),pe=n.n(ue),he=n(118),ge=n.n(he),fe=n(116),ve=n.n(fe),be=n(114),Ee=n.n(be),ye=n(119),Oe=n.n(ye),Ne=n(120),je=n.n(Ne),ke=window.Scenario.config,Te=ke.AUTH_TOKEN,Ce=ke.CRM_HOST,Se=ke.SCENARIO_ID,_e=ke.BANNER_ENABLED,we=ke.PUSH_NOTIFICATION_ENABLED,Me="".concat(Ce,"/api/v1/scenarios/info?id="),Fe="".concat(Ce,"/api/v1/scenarios/create"),Pe="".concat(Ce,"/api/v1/scenarios/criteria"),xe="".concat(Ce,"/api/v1/segments/list"),De="".concat(Ce,"/api/v1/events/list"),Ie="".concat(Ce,"/api/v1/event-generators/list"),Ae="".concat(Ce,"/api/v1/mail-template/list"),Be="".concat(Ce,"/api/v1/scenarios/generics"),Ue="".concat(Ce,"/api/v1/onboarding-goals/list"),Le="".concat(Ce,"/api/v1/remp/list-banners"),ze="".concat(Ce,"/api/v1/onesignal-templates/list"),We="".concat(Ce,"/api/v1/onesignal-applications/list"),Re="".concat(Ce,"/api/v1/scenarios/stats?id="),Ge="".concat(Ce,"/segment/stored-segments/new"),Ve="".concat(Ce,"/segment/stored-segments/show/"),He=n(356),Ke=n(397),qe=n(398),Ze=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,e)).state={},a}return Object(B.a)(n,[{key:"render",value:function(){var e=this;return h.createElement(He.a,{key:this.props.name,draggable:!0,onDragStart:function(t){t.dataTransfer.setData("storm-diagram-node",JSON.stringify(e.props.model))},className:"tray-item"},h.createElement(Ke.a,null,this.props.icon),h.createElement(qe.a,{primary:this.props.name}))}}]),n}(h.Component),Ye=n(45);function Je(e,t){switch(t){case"minutes":return parseInt(e);case"hours":return 60*e;case"days":return 60*e*24;default:return parseInt(e)}}var Xe=function(){function e(t){Object(A.a)(this,e),this.formatDescendant=function(e,t){var n={uuid:e.id};return"segment"===t.type||"goal"===t.type||"condition"===t.type?n.direction="right"===e.portName?"positive":"negative":"ab_test"===t.type&&(n.direction="positive",n.position=e.portName.split(".")[1]),n},this.model=t}return Object(B.a)(e,[{key:"exportPayload",value:function(){var e=this,t={},n=this.model.serializeDiagram(),a=["trigger","before_trigger"];return t.triggers={},t.elements={},t.visual={},n.nodes.filter((function(e){return a.includes(e.type)})).map((function(n){return t.triggers[n.id]=e.formatNode(n)})),Object.entries(this.model.getNodes()).forEach((function(e){t.visual[e[0]]={x:e[1].x,y:e[1].y}})),Object.entries(this.model.getNodes()).forEach((function(n){a.includes(n[1].type)||(t.elements[n[0]]=e.formatNode(n[1].serialize()))})),console.log("payload.elements",t.elements),t}},{key:"getAllChildrenNodes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right",a=e.ports.find((function(e){return e.name===n}));"right.0"===n&&(console.log(e,n),console.log(a.links));var i=a.links.map((function(a){var i=null;return i=t.model.links[a].targetPort.parent.id!==e.id?t.model.links[a].targetPort.parent:t.model.links[a].sourcePort.parent,Object(N.a)(Object(N.a)({},i.serialize()),{},{portName:n})}));return"right.0"===n&&console.log(i),i}},{key:"getPositiveAndNegativeDescendants",value:function(e){var t=this,n=this.getAllChildrenNodes(e,"right").map((function(n){return t.formatDescendant(n,e)})),a=this.getAllChildrenNodes(e,"bottom").map((function(n){return t.formatDescendant(n,e)}));return[].concat(Object(Ye.a)(n),Object(Ye.a)(a))}},{key:"formatNode",value:function(e){var t=this;if("email"===e.type)return{id:e.id,name:e.name?e.name:"",type:"email",email:{code:e.selectedMail,descendants:this.getAllChildrenNodes(e).map((function(n){return t.formatDescendant(n,e)}))}};if("banner"===e.type)return{id:e.id,name:e.name?e.name:"",type:"banner",banner:{id:e.selectedBanner,expiresInMinutes:Je(e.expiresInTime,e.expiresInUnit),descendants:this.getAllChildrenNodes(e).map((function(n){return t.formatDescendant(n,e)}))}};if("generic"===e.type)return{id:e.id,name:e.name?e.name:"",type:"generic",generic:{code:e.selectedGeneric,options:e.options,descendants:this.getAllChildrenNodes(e).map((function(n){return t.formatDescendant(n,e)}))}};if("condition"===e.type)return{id:e.id,name:e.name?e.name:"",type:"condition",condition:{conditions:e.conditions,descendants:this.getPositiveAndNegativeDescendants(e)}};if("segment"===e.type)return{id:e.id,name:e.name?e.name:"",type:"segment",segment:{code:e.selectedSegment?e.selectedSegment:"all_users",descendants:this.getPositiveAndNegativeDescendants(e)}};if("trigger"===e.type)return{id:e.id,name:e.name?e.name:"",type:"event",event:{code:e.selectedTrigger?e.selectedTrigger:"user_created"},elements:this.getAllChildrenNodes(e).map((function(e){return e.id}))};if("before_trigger"===e.type)return{id:e.id,name:e.name?e.name:"",type:"before_event",event:{code:e.selectedTrigger?e.selectedTrigger:"subscription_ends"},elements:this.getAllChildrenNodes(e).map((function(e){return e.id})),options:{minutes:Je(e.time,e.timeUnit)}};if("wait"===e.type)return{id:e.id,name:e.name?e.name:"",type:"wait",wait:{minutes:Je(e.waitingTime,e.waitingUnit),descendants:this.getAllChildrenNodes(e).map((function(n){return t.formatDescendant(n,e)}))}};if("goal"===e.type){var n={codes:e.selectedGoals?e.selectedGoals:[],descendants:this.getPositiveAndNegativeDescendants(e),recheckPeriodMinutes:Je(e.recheckPeriodTime,e.recheckPeriodUnit)};return e.timeoutTime&&e.timeoutUnit&&(n.timeoutMinutes=Je(e.timeoutTime,e.timeoutUnit)),{id:e.id,name:e.name?e.name:"",type:"goal",goal:n}}if("push_notification"===e.type)return{id:e.id,name:e.name?e.name:"",type:"push_notification",push_notification:{template:e.selectedTemplate,application:e.selectedApplication,descendants:this.getAllChildrenNodes(e).map((function(n){return t.formatDescendant(n,e)}))}};if("ab_test"===e.type){var a=e.ports.filter((function(e){return e.name.startsWith("right.")})).flatMap((function(n){return t.getAllChildrenNodes(e,n.name).map((function(n){return t.formatDescendant(n,e)}))}));return console.log(a),{id:e.id,name:e.name?e.name:"",type:"ab_test",ab_test:{variants:e.variants,descendants:a}}}}}]),e}(),Qe=n(440),$e=n(399),et=n(178),tt=n.n(et),nt=n(180),at=n.n(nt),it=n(181),rt=n.n(it),ot=n(179),lt=n.n(ot),st={success:tt.a,warning:lt.a,error:at.a,info:rt.a},ct=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(B.a)(n,[{key:"render",value:function(){var e=st[this.props.variant];return g.a.createElement(Qe.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:this.props.open,autoHideDuration:3e3,onClose:this.props.handleClose},g.a.createElement($e.a,{className:"toast-"+this.props.variant,message:g.a.createElement("span",{id:"client-snackbar",className:"toast__message"},g.a.createElement(e,{className:"toast__icon toast__icon-variant"}),this.props.text)}))}}]),n}(g.a.Component),dt=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e,a){var i;return Object(A.a)(this,n),(i=t.call(this,e)).cb=a,i}return Object(B.a)(n,[{key:"getNewInstance",value:function(e){return this.cb(e)}}]),n}(V.AbstractPortFactory),mt=n(15),ut=n(13),pt=n(21),ht=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){var e;return Object(A.a)(this,n),(e=t.call(this,"custom")).width=2,e.curvyness=50,e.color="rgba(0,0,0,0.3)",e}return Object(B.a)(n)}(V.DefaultLinkModel),gt=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){var e;return Object(A.a)(this,n),(e=t.call(this)).type="custom",e}return Object(B.a)(n,[{key:"getNewInstance",value:function(e){return new ht}},{key:"generateLinkSegment",value:function(e,t,n,a){return h.createElement("path",{className:n?t.bem("--path-selected"):"",strokeWidth:e.width,stroke:e.color,d:a})}}]),n}(V.DefaultLinkFactory),ft=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left",i=arguments.length>1?arguments[1]:void 0;return Object(A.a)(this,n),(e=t.call(this,a,i)).position=a,e.in="left"===e.position,e}return Object(B.a)(n,[{key:"link",value:function(e){var t=this.createLinkModel();return t.setSourcePort(this),t.setTargetPort(e),t}},{key:"canLinkToPort",value:function(e){return this.in!==e.in}},{key:"serialize",value:function(){return pt.merge(Object(mt.a)(Object(ut.a)(n.prototype),"serialize",this).call(this),{position:this.position})}},{key:"deSerialize",value:function(e,t){Object(mt.a)(Object(ut.a)(n.prototype),"deSerialize",this).call(this,e,t),this.position=e.position}},{key:"createLinkModel",value:function(){return new ht}}]),n}(V.PortModel),vt=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left",i=arguments.length>1?arguments[1]:void 0;return Object(A.a)(this,n),(e=t.call(this,a,i)).position=a,e.in="left"===e.position,e}return Object(B.a)(n,[{key:"link",value:function(e){var t=this.createLinkModel();return t.setSourcePort(this),t.setTargetPort(e),t}},{key:"serialize",value:function(){return pt.merge(Object(mt.a)(Object(ut.a)(n.prototype),"serialize",this).call(this),{position:this.position})}},{key:"canLinkToPort",value:function(e){return this.in!==e.in}},{key:"deSerialize",value:function(e,t){Object(mt.a)(Object(ut.a)(n.prototype),"deSerialize",this).call(this,e,t),this.position=e.position}},{key:"createLinkModel",value:function(){return new ht}}]),n}(V.PortModel),bt=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(A.a)(this,n),t.call(this,e,"email")}return Object(B.a)(n)}(ft),Et=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,"email",e.id)).name=e.name,a.selectedMail=e.selectedMail,a.addPort(new bt("left")),a.addPort(new bt("right")),a}return Object(B.a)(n,[{key:"deSerialize",value:function(e,t){Object(mt.a)(Object(ut.a)(n.prototype),"deSerialize",this).call(this,e,t),this.name=e.name,this.selectedMail=e.selectedMail}},{key:"serialize",value:function(){return pt.merge(Object(mt.a)(Object(ut.a)(n.prototype),"serialize",this).call(this),{name:this.name,selectedMail:this.selectedMail})}}]),n}(V.NodeModel),yt=n(437),Ot=n(404),Nt=n(416),jt=n(406),kt=n(407),Tt=n(405),Ct=n(434),St=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,e)).state={selected:!1},a}return Object(B.a)(n,[{key:"getClassName",value:function(){return"port "+Object(mt.a)(Object(ut.a)(n.prototype),"getClassName",this).call(this)+(this.state.selected?this.bem("--selected"):"")}},{key:"render",value:function(){var e=this;return h.createElement("div",Object.assign({},this.getProps(),{onMouseEnter:function(){e.setState({selected:!0})},onMouseLeave:function(){e.setState({selected:!1})},"data-name":this.props.name,"data-nodeid":this.props.node.getID()}),this.props.children)}}]),n}(V.PortWidget);function _t(e){return{type:"canvas_zoomable_pannable",payload:e}}function wt(e){return{type:"canvas_notification",payload:e}}function Mt(e){return{type:"set_scenario_id",payload:e}}function Ft(e){return{type:"set_scenario_name",payload:e}}function Pt(e){return{type:"set_scenario_loading",payload:e}}var xt=n(438);var Dt=function(e){var t,n,a=Object(v.c)((function(e){return e.statistics.statistics})),i=null!==(t=a[e.elementId])&&void 0!==t?t:null,r=null;if(0===a.length)r=g.a.createElement("div",{sx:{color:"white"}},g.a.createElement(te.a,{size:8,color:"inherit"}));else{if(i&&(i.hasOwnProperty("finished")&&(r=i.finished["24h"]),"right"===e.position&&i.hasOwnProperty("matched")&&(r=i.matched["24h"]),"right"===e.position&&i.hasOwnProperty("completed")&&(r=i.completed["24h"]),"bottom"===e.position&&i.hasOwnProperty("notMatched")&&(r=i.notMatched["24h"]),"bottom"===e.position&&i.hasOwnProperty("timeout")&&(r=i.timeout["24h"]),e.hasOwnProperty("index")&&(r=i[e.index]?i[e.index]["24h"]:0)),null===r)return null;r=(n=r)<1e3?n:n<1e6?Number(n/1e3).toFixed(n>1e5?0:1)+"K":Number(n/1e6).toFixed(1)+"M"}return g.a.createElement("div",{className:"statistic-badge-container-"+e.position},g.a.createElement(xt.a,{label:r,color:"primary",size:"small",style:{backgroundColor:e.color,height:"16px",borderRadius:"4px",fontSize:"0.7rem"},className:"statistic-badge statistic-badge-"+e.position}))},It=n(401),At=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(B.a)(n,[{key:"render",value:function(){var e,t,n=this.props.anchorElement,a=null!==(e=this.props.statistics[this.props.id])&&void 0!==e?e:null,i=null!==(t=this.props.variants)&&void 0!==t?t:[];return null===a?null:g.a.createElement(It.a,{open:Boolean(n),anchorEl:n,style:{pointerEvents:"none"},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},g.a.createElement("div",{className:"node-tooltip-wrapper"},a?g.a.createElement("div",{className:"scenario-tooltip",style:{padding:"10px"}},g.a.createElement("strong",{style:{color:"red"}},"Statistics"),g.a.createElement("hr",null),a.hasOwnProperty("waiting")?g.a.createElement("div",{style:{marginBottom:"10px"}},"Waiting: ",a.waiting):null,a.hasOwnProperty("recheck")?g.a.createElement("div",{style:{marginBottom:"10px"}},"Waiting to re-check: ",a.recheck):null,g.a.createElement("strong",null,"Last 24 hours"),g.a.createElement("br",null),g.a.createElement("table",null,g.a.createElement("tbody",null,a.hasOwnProperty("finished")?g.a.createElement("tr",null,g.a.createElement("td",null,"Finished:"),g.a.createElement("td",null,a.finished["24h"])):null,a.hasOwnProperty("matched")?g.a.createElement("tr",null,g.a.createElement("td",null,"Matched:"),g.a.createElement("td",null,a.matched["24h"])):null,a.hasOwnProperty("notMatched")?g.a.createElement("tr",null,g.a.createElement("td",null,"Not matched:"),g.a.createElement("td",null,a.notMatched["24h"])):null,a.hasOwnProperty("completed")?g.a.createElement("tr",null,g.a.createElement("td",null,"Completed:"),g.a.createElement("td",null,a.completed["24h"])):null,a.hasOwnProperty("timeout")?g.a.createElement("tr",null,g.a.createElement("td",null,"Timed out:"),g.a.createElement("td",null,a.timeout["24h"])):null,i.flatMap((function(e){return g.a.createElement("tr",{key:e.code},g.a.createElement("td",null,e.name,":"),g.a.createElement("td",null,a[e.code]?a[e.code]["24h"]:0))})))),g.a.createElement("strong",null,"Last 30 days"),g.a.createElement("br",null),g.a.createElement("table",null,g.a.createElement("tbody",null,a.hasOwnProperty("finished")?g.a.createElement("tr",null,g.a.createElement("td",null,"Finished:"),g.a.createElement("td",null,a.finished["30d"])):null,a.hasOwnProperty("matched")?g.a.createElement("tr",null,g.a.createElement("td",null,"Matched:"),g.a.createElement("td",null,a.matched["30d"])):null,a.hasOwnProperty("notMatched")?g.a.createElement("tr",null,g.a.createElement("td",null,"Not matched:"),g.a.createElement("td",null,a.notMatched["30d"])):null,a.hasOwnProperty("completed")?g.a.createElement("tr",null,g.a.createElement("td",null,"Completed:"),g.a.createElement("td",null,a.completed["30d"])):null,a.hasOwnProperty("timeout")?g.a.createElement("tr",null,g.a.createElement("td",null,"Timed out:"),g.a.createElement("td",null,a.timeout["30d"])):null,i.flatMap((function(e){return g.a.createElement("tr",{key:e.code},g.a.createElement("td",null,e.name,":"),g.a.createElement("td",null,a[e.code]?a[e.code]["30d"]:0))}))))):""))}}]),n}(g.a.Component);var Bt=Object(v.b)((function(e){return{statistics:e.statistics.statistics}}))(At),Ut=n(433),Lt=n(403),zt=Object(Ct.a)(H.a)({marginRight:"auto"}),Wt=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,e)).openDialog=function(){a.setState({dialogOpened:!0,nodeFormName:a.props.node.name,selectedMail:a.props.node.selectedMail,anchorElementForTooltip:null}),a.props.dispatch(_t(!1))},a.closeDialog=function(){a.setState({dialogOpened:!1}),a.props.dispatch(_t(!0))},a.handleNodeMouseEnter=function(e){a.state.dialogOpened||a.setState({anchorElementForTooltip:e.currentTarget})},a.handleNodeMouseLeave=function(){a.setState({anchorElementForTooltip:null})},a.getSelectedMail=function(){var e=a.props.mails.find((function(e){return e.code===a.state.selectedMail}));return e||null},a.getSelectedMailValue=function(){var e=a.props.mails.find((function(e){return e.code===a.props.node.selectedMail}));return e?" - ".concat(e.name):""},a.filterOptions=function(){return Object(Lt.a)({matchFrom:"any",trim:!0,ignoreAccents:!0,ignoreCase:!0,stringify:function(e){return e.name+" "+e.code}})},a.state={nodeFormName:a.props.node.name,selectedMail:a.props.node.selectedMail,dialogOpened:!1,anchorElementForTooltip:null},a}return Object(B.a)(n,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this,t=this.props.classes;return h.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(ae.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__left")},h.createElement(St,{name:"left",node:this.props.node})),h.createElement("div",{className:this.bem("__right")},h.createElement(St,{name:"right",node:this.props.node}),h.createElement(Dt,{elementId:this.props.node.id,color:"#a291fb",position:"right"})))),h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Mail ".concat(this.getSelectedMailValue()))),h.createElement(Bt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),h.createElement(Ot.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},h.createElement(Tt.a,{id:"form-dialog-title"},"Email node"),h.createElement(jt.a,null,h.createElement(kt.a,null,"Sends an email to user."),h.createElement($.a,{container:!0},h.createElement($.a,{item:!0,xs:6},h.createElement(yt.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),h.createElement($.a,{container:!0,alignItems:"center",alignContent:"space-between"},h.createElement($.a,{item:!0,xs:12},h.createElement(Ut.a,{value:this.getSelectedMail(),options:this.props.mails,getOptionLabel:function(e){return e.name},disableClearable:!0,filterOptions:this.filterOptions(),groupBy:function(e){return e.mail_type.code},onChange:function(t,n){null!==n&&e.setState({selectedMail:n.code})},renderInput:function(e){return h.createElement(yt.a,Object.assign({},e,{variant:"standard",label:"Selected Mail",fullWidth:!0}))},renderOption:function(e,n){n.selected;return h.createElement("div",null,h.createElement("span",{className:t.title},e.name),h.createElement("small",{className:t.subtitle},"(",e.code,")"))}})))),h.createElement(Nt.a,null,this.props.mails.filter((function(t){return t.link&&t.code===e.state.selectedMail})).map((function(e){return h.createElement(zt,{color:"primary",href:e.link,target:"_blank"},h.createElement(ae.a,{style:{marginRight:"5px"}}),"Preview")})),h.createElement(H.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),h.createElement(H.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedMail=e.state.selectedMail,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),n}(h.Component);var Rt=Object(v.b)((function(e){return{mails:e.mails.availableMails}}))(Object(ee.a)((function(e){return{autocomplete:{margin:e.spacing(1)},subtitle:{paddingLeft:"6px",color:e.palette.grey[600]}}}))(Wt)),Gt=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){return Object(A.a)(this,n),t.call(this,"email")}return Object(B.a)(n,[{key:"generateReactWidget",value:function(e,t){return h.createElement(Rt,{diagramEngine:e,node:t,classBaseName:"square-node",className:"email-node"})}},{key:"getNewInstance",value:function(){return new Et}}]),n}(V.AbstractNodeFactory),Vt=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(A.a)(this,n),t.call(this,e,"banner")}return Object(B.a)(n)}(ft),Ht=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,"banner",e.id)).name=e.name,a.selectedBanner=e.selectedBanner,a.expiresInTime=e.expiresInTime,a.expiresInUnit=e.expiresInUnit,a.addPort(new Vt("left")),a.addPort(new Vt("right")),a}return Object(B.a)(n,[{key:"deSerialize",value:function(e,t){Object(mt.a)(Object(ut.a)(n.prototype),"deSerialize",this).call(this,e,t),this.name=e.name,this.selectedBanner=e.selectedBanner,this.expiresInTime=e.expiresInTime||"1",this.expiresInUnit=e.expiresInUnit||"days"}},{key:"serialize",value:function(){return pt.merge(Object(mt.a)(Object(ut.a)(n.prototype),"serialize",this).call(this),{name:this.name,selectedBanner:this.selectedBanner,expiresInTime:this.expiresInTime,expiresInUnit:this.expiresInUnit})}}]),n}(V.NodeModel),Kt=n(411),qt=n(412),Zt=n(432),Yt=n(417),Jt=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,e)).openDialog=function(){a.setState({dialogOpened:!0,nodeFormName:a.props.node.name,anchorElementForTooltip:null}),a.props.dispatch(_t(!1))},a.closeDialog=function(){a.setState({dialogOpened:!1}),a.props.dispatch(_t(!0))},a.handleNodeMouseEnter=function(e){a.state.dialogOpened||a.setState({anchorElementForTooltip:e.currentTarget})},a.handleNodeMouseLeave=function(){a.setState({anchorElementForTooltip:null})},a.getSelectedBanner=function(){var e=a.props.banners.find((function(e){return e.id===a.state.selectedBanner}));return e||null},a.getSelectedBannerValue=function(){var e=a.props.banners.find((function(e){return e.id===a.props.node.selectedBanner}));return e?" - ".concat(e.name):""},a.state={nodeFormName:a.props.node.name,selectedBanner:a.props.node.selectedBanner,dialogOpened:!1,anchorElementForTooltip:null,expiresInTime:a.props.node.expiresInTime,expiresInUnit:a.props.node.expiresInUnit},a}return Object(B.a)(n,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return h.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(le.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__left")},h.createElement(St,{name:"left",node:this.props.node})),h.createElement("div",{className:this.bem("__right")},h.createElement(St,{name:"right",node:this.props.node}),h.createElement(Dt,{elementId:this.props.node.id,color:"#6435c9",position:"right"})))),h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Banner ".concat(this.getSelectedBannerValue()))),h.createElement(Bt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),h.createElement(Ot.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},h.createElement(Tt.a,{id:"form-dialog-title"},"Banner node"),h.createElement(jt.a,null,h.createElement(kt.a,null,"Shows a one-time banner to user."),h.createElement($.a,{container:!0},h.createElement($.a,{item:!0,xs:6},h.createElement(yt.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),h.createElement($.a,{container:!0,style:{marginBottom:"10px"}},h.createElement($.a,{item:!0,xs:12},h.createElement(Ut.a,{value:this.getSelectedBanner(),options:this.props.banners,getOptionLabel:function(e){return e.name},disableClearable:!0,onChange:function(t,n){null!==n&&e.setState({selectedBanner:n.id})},renderInput:function(e){return h.createElement(yt.a,Object.assign({},e,{variant:"standard",label:"Selected Banner",fullWidth:!0}))}}))),h.createElement($.a,{container:!0,spacing:1},h.createElement($.a,{item:!0,xs:6},h.createElement(yt.a,{id:"expires-in-time",label:"Expires in",type:"number",helperText:"Banner is not shown after given period",fullWidth:!0,value:this.state.expiresInTime,onChange:function(t){e.setState({expiresInTime:t.target.value})}})),h.createElement($.a,{item:!0,xs:6},h.createElement(Kt.a,{fullWidth:!0},h.createElement(qt.a,{htmlFor:"time-unit"},"Time unit"),h.createElement(Zt.a,{value:this.state.expiresInUnit,onChange:function(t){e.setState({expiresInUnit:t.target.value})},inputProps:{name:"expires-in-unit",id:"expires-in-unit"}},h.createElement(Yt.a,{value:"minutes"},"Minutes"),h.createElement(Yt.a,{value:"hours"},"Hours"),h.createElement(Yt.a,{value:"days"},"Days")))))),h.createElement(Nt.a,null,h.createElement(H.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),h.createElement(H.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedBanner=e.state.selectedBanner,e.props.node.expiresInTime=e.state.expiresInTime,e.props.node.expiresInUnit=e.state.expiresInUnit,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),n}(h.Component);var Xt=Object(v.b)((function(e){return{banners:e.banners.availableBanners}}))(Jt),Qt=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){return Object(A.a)(this,n),t.call(this,"banner")}return Object(B.a)(n,[{key:"generateReactWidget",value:function(e,t){return h.createElement(Xt,{diagramEngine:e,node:t,classBaseName:"square-node",className:"banner-node"})}},{key:"getNewInstance",value:function(){return new Ht}}]),n}(V.AbstractNodeFactory),$t=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(A.a)(this,n),t.call(this,e,"generic")}return Object(B.a)(n)}(ft),en=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,"generic",e.id)).name=e.name,a.selectedGeneric=e.selectedGeneric,a.options=e.options,a.addPort(new $t("left")),a.addPort(new $t("right")),a}return Object(B.a)(n,[{key:"deSerialize",value:function(e,t){Object(mt.a)(Object(ut.a)(n.prototype),"deSerialize",this).call(this,e,t),this.name=e.name,this.selectedGeneric=e.selectedGeneric,this.options=e.options}},{key:"serialize",value:function(){return pt.merge(Object(mt.a)(Object(ut.a)(n.prototype),"serialize",this).call(this),{name:this.name,selectedGeneric:this.selectedGeneric,options:this.options})}}]),n}(V.NodeModel),tn=n(38);function nn(e,t){switch(t.type){case"CREATE_OPTION":return Object(N.a)(Object(N.a)({},e),{},{options:[].concat(Object(Ye.a)(e.options),[{key:t.payload.optionKey,values:{selection:t.payload.values}}])});case"DELETE_OPTION":return Object(N.a)(Object(N.a)({},e),{},{options:e.options.filter((function(e){return e.key!==t.payload.optionKey}))});case"SET_PARAM_VALUES":return Object(N.a)(Object(N.a)({},e),{},{options:e.options.map((function(e){return e.key===t.payload.name?Object(N.a)(Object(N.a)({},e),{},{values:t.payload.values}):e}))});case"UPDATE_PARAM_VALUES":return Object(N.a)(Object(N.a)({},e),{},{options:e.options.map((function(e){return e.key===t.payload.name?Object(N.a)(Object(N.a)({},e),{},{values:Object.assign(e.values,t.payload.values)}):e}))});default:throw new Error("unsupported action type "+t.type)}}var an=n(420),rn=n(421),on=n(418),ln=n(439),sn=n(419);function cn(e,t){return{type:"SET_PARAM_VALUES",payload:{name:e,values:t}}}function dn(e,t){return{type:"UPDATE_PARAM_VALUES",payload:{name:e,values:t}}}var mn=Object(on.a)((function(e){return{formControl:{marginBottom:e.spacing(1)}}}));function un(e){var t=mn();void 0===e.values.selection&&e.dispatch(cn(e.name,{selection:!0}));return g.a.createElement(sn.a,{onChange:function(t){e.dispatch(cn(e.name,{selection:t.target.checked}))},control:g.a.createElement(ln.a,null),checked:void 0!==e.values.selection&&e.values.selection,label:e.blueprint.label,className:t.formControl})}var pn=n(360),hn=Object(on.a)((function(e){return{formControl:{marginRight:e.spacing(1),marginBottom:e.spacing(1),minWidth:100},formLabel:{display:"block",marginBottom:e.spacing(1)},numberInput:{marginRight:e.spacing(1),marginBottom:e.spacing(1)}}}));function gn(e){var t,n,a,i=hn();void 0===e.values.operator&&e.blueprint.operators&&1===e.blueprint.operators.length&&e.dispatch(cn(e.name,{operator:e.blueprint.operators[0]}));return g.a.createElement(g.a.Fragment,null,!e.hideLabel&&g.a.createElement(pn.a,{className:i.formLabel},e.blueprint.label),e.blueprint.operators&&e.blueprint.operators.length&&g.a.createElement(Kt.a,{className:i.formControl,disabled:1===e.blueprint.operators.length},g.a.createElement(qt.a,null,"Operator"),g.a.createElement(Zt.a,{autoWidth:!0,value:null!==(t=e.values.operator)&&void 0!==t?t:"",onChange:function(t){e.dispatch(dn(e.name,{operator:t.target.value}))}},e.blueprint.operators.map((function(e){return g.a.createElement(Yt.a,{key:e,value:e},e)})))),g.a.createElement(yt.a,{className:i.numberInput,label:e.blueprint.unit,type:"number",onChange:function(t){e.dispatch(dn(e.name,{selection:t.target.value}))},value:null!==(n=e.values.selection)&&void 0!==n?n:"",inputProps:null!==(a=e.blueprint.numberInputAttributes)&&void 0!==a?a:{}}))}var fn=Object(on.a)((function(e){return{chipRoot:function(e){return{"&:not(:first-child)":{"&::before":{content:"'"+e.operator+"'",textTransform:"uppercase",position:"absolute",left:"-20px"},marginLeft:"20px"},position:"relative"}},subtitle:{paddingLeft:"6px",color:e.palette.grey[600]},autocomplete:{marginBottom:e.spacing(1)}}}));function vn(e,t){var n=new Set(e);return t.filter((function(e){var t=n.has(e.value);return t&&n.delete(e.value),t})).concat(Object(Ye.a)(n))}function bn(e){return"string"===typeof e?e:e.label}function En(e){return"string"===typeof e?"":void 0!==e.subtitle?e.subtitle:""}function yn(e){return"string"===typeof e?"":e.hasOwnProperty("group")?e.group:""}var On=Object(Lt.a)({matchFrom:"any",trim:!0,ignoreAccents:!0,ignoreCase:!0,stringify:function(e){return bn(e)+" "+En(e)}});function Nn(e){var t=fn({operator:e.blueprint.operator});return g.a.createElement(Ut.a,{multiple:!0,disableCloseOnSelect:!0,ChipProps:{classes:{root:t.chipRoot}},options:e.blueprint.options,getOptionLabel:bn,onChange:function(t,n){e.dispatch(cn(e.name,{operator:e.blueprint.operator,selection:n.map((function(e){return"string"===typeof e?e:e.value}))}))},value:vn(e.values.selection,e.blueprint.options),freeSolo:e.blueprint.freeSolo,groupBy:yn,filterOptions:On,renderInput:function(n){return g.a.createElement(yt.a,Object.assign({},n,{variant:"standard",label:e.blueprint.label,placeholder:"",className:t.autocomplete,fullWidth:!0}))},renderOption:function(e,n){n.selected;return g.a.createElement(g.a.Fragment,null,bn(e),g.a.createElement("small",{className:t.subtitle},En(e)))}})}var jn=g.a.createContext(null);function kn(e){var t=Object(h.useContext)(jn);switch(e.blueprint.type){case"boolean":return g.a.createElement(un,{name:e.blueprint.key,values:e.option.values,blueprint:e.blueprint,dispatch:t});case"number":return g.a.createElement(gn,{name:e.blueprint.key,values:e.option.values,blueprint:e.blueprint,dispatch:t});case"string_labeled_array":return g.a.createElement(Nn,{name:e.blueprint.key,values:e.option.values,blueprint:e.blueprint,dispatch:t});default:throw new Error("unsupported option type "+e.blueprint.type)}}var Tn=Object(on.a)((function(e){return{option:{flex:"0 0 100%",borderBottom:"1px solid #dfdfdf",marginBottom:e.spacing(2),paddingBottom:e.spacing(1),"&:last-child":{borderBottom:"none",marginBottom:0,paddingBottom:0}}}}));var Cn=Object(h.forwardRef)((function(e,t){var n,a=Tn(),i=Object(h.useReducer)(nn,{version:1,options:null!==(n=e.options)&&void 0!==n?n:[]}),r=Object(tn.a)(i,2),o=r[0],l=r[1];return Object(h.useImperativeHandle)(t,(function(){return{state:o}})),o.options.forEach((function(t){void 0===e.blueprints.find((function(e){return e.key===t.key}))&&l({type:"DELETE_OPTION",payload:{optionKey:t.key}})})),e.blueprints.forEach((function(e){var t,n;void 0===o.options.find((function(t){return e.key===t.key}))&&l((t=e.key,{type:"CREATE_OPTION",payload:{values:n,optionKey:t}}))})),g.a.createElement(jn.Provider,{value:l},g.a.createElement(an.a,null,g.a.createElement(rn.a,{className:a.cardContent},e.blueprints.map((function(e){var t,n=null!==(t=o.options.find((function(t){return t.key===e.key})))&&void 0!==t?t:{key:e.key,values:{selection:null}};return g.a.createElement("div",{className:a.option},g.a.createElement(kn,{key:e.key,option:n,blueprint:e.blueprint}))})))))})),Sn=Object(Lt.a)({matchFrom:"any",trim:!0,ignoreAccents:!0,ignoreCase:!0,stringify:function(e){return e.label+" "+e.value}}),_n=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,e)).openDialog=function(){a.setState({dialogOpened:!0,nodeFormName:a.props.node.name,anchorElementForTooltip:null}),a.props.dispatch(_t(!1))},a.closeDialog=function(){a.setState({dialogOpened:!1}),a.props.dispatch(_t(!0))},a.handleNodeMouseEnter=function(e){a.state.dialogOpened||a.setState({anchorElementForTooltip:e.currentTarget})},a.handleNodeMouseLeave=function(){a.setState({anchorElementForTooltip:null})},a.getSelectedGeneric=function(){var e=a.props.generics.find((function(e){return e.code===a.state.selectedGeneric}));return e||null},a.getSelectedGenericOptionBlueprints=function(){var e=a.getSelectedGeneric(),t=[];return null!==e&&null!==e.options&&pt.forOwn(e.options,(function(e,n){t.push({key:n,blueprint:e})})),t},a.transformOptionsForSelect=function(){var e=[];return Object.keys(a.props.generics).forEach((function(t){e.push({value:a.props.generics[t].code,label:a.props.generics[t].label})})),e},a.getSelectedGenericDefaultLabel=function(){var e=a.getSelectedGeneric();return e?" - ".concat(e.label):""},a.optionsFormRef=h.createRef(),a.state={nodeFormName:a.props.node.name,selectedGeneric:a.props.node.selectedGeneric,dialogOpened:!1,anchorElementForTooltip:null},a}return Object(B.a)(n,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this,t=this.props.classes;return h.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(re.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__left")},h.createElement(St,{name:"left",node:this.props.node})),h.createElement("div",{className:this.bem("__right")},h.createElement(St,{name:"right",node:this.props.node}),h.createElement(Dt,{elementId:this.props.node.id,color:"#a291fb",position:"right"})))),h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Generic ".concat(this.getSelectedGenericDefaultLabel()))),h.createElement(Bt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),h.createElement(Ot.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},h.createElement(Tt.a,{id:"form-dialog-title"},"Generic action node"),h.createElement(jt.a,null,h.createElement(kt.a,null,"Runs defined generic action."),h.createElement($.a,{container:!0},h.createElement($.a,{item:!0,xs:6},h.createElement(yt.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),h.createElement($.a,{container:!0,alignItems:"center",alignContent:"space-between"},h.createElement($.a,{item:!0,xs:12},h.createElement(Ut.a,{value:this.getSelectedGeneric(),options:this.transformOptionsForSelect(),getOptionLabel:function(e){return e.label},getOptionSelected:function(e,t){return e.key===t.key},disableClearable:!0,filterOptions:Sn,onChange:function(t,n){null!==n&&e.setState({selectedGeneric:n.value})},renderInput:function(e){return h.createElement(yt.a,Object.assign({},e,{variant:"standard",label:"Action",fullWidth:!0}))},renderOption:function(e,n){n.selected;return h.createElement("div",null,h.createElement("span",{className:t.title},e.label),h.createElement("small",{className:t.subtitle},"(",e.value,")"))}}))),this.state.selectedGeneric&&this.getSelectedGenericOptionBlueprints().length>0&&h.createElement($.a,{container:!0,alignItems:"center",alignContent:"space-between"},h.createElement($.a,{item:!0,xs:12},h.createElement("p",null,"Options"),h.createElement(Cn,{options:this.props.node.options,blueprints:this.getSelectedGenericOptionBlueprints(),ref:this.optionsFormRef})))),h.createElement(Nt.a,null,h.createElement(H.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),h.createElement(H.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedGeneric=e.state.selectedGeneric,e.props.node.options=e.optionsFormRef.current.state.options,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),n}(h.Component);var wn=Object(v.b)((function(e){return{generics:e.generics.generics}}))(Object(ee.a)((function(e){return{autocomplete:{margin:e.spacing(1)},subtitle:{paddingLeft:"6px",color:e.palette.grey[600]}}}))(_n)),Mn=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){return Object(A.a)(this,n),t.call(this,"generic")}return Object(B.a)(n,[{key:"generateReactWidget",value:function(e,t){return h.createElement(wn,{diagramEngine:e,node:t,classBaseName:"square-node",className:"generic-node"})}},{key:"getNewInstance",value:function(){return new en}}]),n}(V.AbstractNodeFactory),Fn=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top";return Object(A.a)(this,n),t.call(this,e,"segment")}return Object(B.a)(n)}(vt),Pn=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,"segment",e.id)).name=e.name,a.selectedSegment=e.selectedSegment,a.addPort(new Fn("left")),a.addPort(new Fn("bottom")),a.addPort(new Fn("right")),a}return Object(B.a)(n,[{key:"deSerialize",value:function(e,t){Object(mt.a)(Object(ut.a)(n.prototype),"deSerialize",this).call(this,e,t),this.name=e.name,this.selectedSegment=e.selectedSegment}},{key:"serialize",value:function(){return pt.merge(Object(mt.a)(Object(ut.a)(n.prototype),"serialize",this).call(this),{name:this.name,selectedSegment:this.selectedSegment})}}]),n}(V.NodeModel),xn=n(423),Dn=n(422),In=Object(on.a)((function(e){return{autocomplete:{margin:e.spacing(1)},subtitle:{paddingLeft:"6px",color:e.palette.grey[600]}}}));function An(e){return"string"===typeof e?e:e.name}function Bn(e,t){return!(!t||!t.hasOwnProperty("code"))&&e.code===t.code}function Un(e,t){var n=t.filter((function(t){return t.code===e}))[0];return n||null}var Ln=Object(Lt.a)({matchFrom:"any",trim:!0,ignoreAccents:!0,ignoreCase:!0,stringify:function(e){return e.name+" "+e.code}});function zn(e){var t=In(),n=Object(v.c)((function(t){return t.segments.avalaibleSegments.filter((function(t){return t.table===e.selectedSegmentSourceTable}))}))[0].segments.sort((function(e,t){return e.group.sorting-t.group.sorting===0?e.group.id-t.group.id:e.group.sorting-t.group.sorting}));return g.a.createElement(Ut.a,{fullWidth:!0,className:t.autocomplete,value:Un(e.selectedSegment,n),options:n,getOptionSelected:Bn,getOptionLabel:An,groupBy:function(e){return e.group.name},filterOptions:Ln,onChange:function(t,n){e.onSegmentSelectedChange(n)},renderInput:function(e){return g.a.createElement(yt.a,Object.assign({},e,{variant:"standard",label:"Segment",fullWidth:!0}))},renderOption:function(e,n){n.selected;return g.a.createElement("div",null,g.a.createElement("span",{className:t.title},An(e)),g.a.createElement("small",{className:t.subtitle},"(",e.code,")"))}})}var Wn=Object(on.a)({selectedButton:{backgroundColor:"#E4E4E4"},deselectedButton:{color:"#A6A6A6"}});function Rn(e){var t=Wn(),n=Object(v.c)((function(e){return e.segments.avalaibleSegments})),a=function(e,t,n){if(e)return e;if(t){var a=n.filter((function(e){return e.segments.filter((function(e){return e.code===t})).length>0}));return a[0]&&a[0].hasOwnProperty("table")?a[0].table:"users"}return"users"}(e.selectedSegmentSourceTable,e.selectedSegment,n);return g.a.createElement($.a,{container:!0,item:!0,xs:12,spacing:2},g.a.createElement($.a,{item:!0,xs:12},g.a.createElement(Dn.a,{"aria-label":"outlined button group"},n.map((function(n){return g.a.createElement(H.a,{onClick:function(){return e.onSegmentTypeButtonClick(n.table)},className:a===n.table?t.selectedButton:t.deselectedButton,key:n.table},n.table)})))),g.a.createElement(zn,{selectedSegment:e.selectedSegment,selectedSegmentSourceTable:a,onSegmentSelectedChange:e.onSegmentSelectedChange}))}var Gn=n(79),Vn=n.n(Gn),Hn=n(112),Kn=n.n(Hn),qn=Object(Ct.a)(H.a)({marginRight:"auto"}),Zn=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,e)).openDialog=function(){a.setState({dialogOpened:!0,nodeFormName:a.props.node.name,selectedSegment:a.props.node.selectedSegment,anchorElementForTooltip:null}),a.props.dispatch(_t(!1))},a.closeDialog=function(){a.setState({dialogOpened:!1}),a.props.dispatch(_t(!0))},a.handleNodeMouseEnter=function(e){a.state.dialogOpened||a.setState({anchorElementForTooltip:e.currentTarget})},a.handleNodeMouseLeave=function(){a.setState({anchorElementForTooltip:null})},a.actionSetTable=function(e){a.state.selectedSegmentSourceTable!==e&&(a.setState({selectedSegment:null}),a.setState({selectedSegmentSourceTable:e}))},a.segmentSelectedChange=function(e){var t=null;e&&e.hasOwnProperty("code")&&(t=e.code),a.setState({selectedSegment:t})},a.getSelectedSegmentValue=function(){var e=a.props.segments.flatMap((function(e){return e.segments})).find((function(e){return e.code===a.props.node.selectedSegment}));return e?" - ".concat(e.name):""},a.handleNewSegmentClick=function(){window.open(Ge)},a.state={nodeFormName:a.props.node.name,selectedSegment:a.props.node.selectedSegment,dialogOpened:!1,anchorElementForTooltip:null,creatingNewSegment:!1,selectedSegmentSourceTable:null},a}return Object(B.a)(n,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this,t=!1;return(0===this.props.statistics.length||this.props.statistics[this.props.node.id])&&(t=!0),h.createElement("div",{className:this.getClassName(),onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Segment ".concat(this.getSelectedSegmentValue()))),h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(pe.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__left")},h.createElement(St,{name:"left",node:this.props.node})),h.createElement("div",{className:this.bem("__right")},h.createElement(St,{name:"right",node:this.props.node}),t?h.createElement(Dt,{elementId:this.props.node.id,color:"#21ba45",position:"right"}):h.createElement(Vn.a,{style:{position:"absolute",top:"-5px",right:"-30px",color:"#2ECC40"}})),h.createElement("div",{className:this.bem("__bottom")},h.createElement(St,{name:"bottom",node:this.props.node}),t?h.createElement(Dt,{elementId:this.props.node.id,color:"#db2828",position:"bottom"}):h.createElement(Kn.a,{style:{position:"absolute",top:"15px",right:"-5px",color:"#FF695E"}})))),h.createElement(Bt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),h.createElement(Ot.a,{fullWidth:!0,maxWidth:"md",open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},h.createElement(Tt.a,{id:"form-dialog-title"},"Segment node"),h.createElement(jt.a,null,h.createElement(kt.a,null,"Segments evaluate user's presence in a group of users defined by system-provided conditions. Execution flow can be directed based on presence/absence of user within the selected segment. You can either pick one of the existing segments or create a new one."),h.createElement($.a,{container:!0,spacing:3},h.createElement($.a,{item:!0,xs:6},h.createElement(yt.a,{margin:"normal",id:"segment-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),h.createElement($.a,{container:!0,spacing:3,alignItems:"flex-end"},h.createElement($.a,{item:!0,xs:12},h.createElement(Rn,{selectedSegment:this.state.selectedSegment,selectedSegmentSourceTable:this.state.selectedSegmentSourceTable,onSegmentTypeButtonClick:this.actionSetTable,onSegmentSelectedChange:this.segmentSelectedChange})))),h.createElement(Nt.a,null,h.createElement(qn,{color:"primary",onClick:this.handleNewSegmentClick},h.createElement(xn.a,{style:{marginRight:"5px"}},"add_circle"),"New segment"),h.createElement(H.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),h.createElement(H.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedSegment=e.state.selectedSegment,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),n}(h.Component);var Yn=Object(v.b)((function(e){var t=e.segments,n=e.dispatch;return{segments:t.avalaibleSegments,statistics:e.statistics.statistics,dispatch:n}}))(Zn),Jn=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){return Object(A.a)(this,n),t.call(this,"segment")}return Object(B.a)(n,[{key:"generateReactWidget",value:function(e,t){return h.createElement(Yn,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"segment-node"})}},{key:"getNewInstance",value:function(){return new Pn}}]),n}(V.AbstractNodeFactory),Xn=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(A.a)(this,n),t.call(this,e,"trigger")}return Object(B.a)(n)}(ft),Qn=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,"trigger",e.id)).name=e.name,a.selectedTrigger=e.selectedTrigger,a.addPort(new Xn("right")),a}return Object(B.a)(n,[{key:"deSerialize",value:function(e,t){Object(mt.a)(Object(ut.a)(n.prototype),"deSerialize",this).call(this,e,t),this.name=e.name,this.selectedTrigger=e.selectedTrigger}},{key:"serialize",value:function(){return pt.merge(Object(mt.a)(Object(ut.a)(n.prototype),"serialize",this).call(this),{name:this.name,selectedTrigger:this.selectedTrigger})}}]),n}(V.NodeModel),$n=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,e)).openDialog=function(){a.setState({dialogOpened:!0,nodeFormName:a.props.node.name,anchorElementForTooltip:null}),a.props.dispatch(_t(!1))},a.closeDialog=function(){a.setState({dialogOpened:!1}),a.props.dispatch(_t(!0))},a.handleNodeMouseEnter=function(e){a.state.dialogOpened||a.setState({anchorElementForTooltip:e.currentTarget})},a.handleNodeMouseLeave=function(){a.setState({anchorElementForTooltip:null})},a.getTriggersInSelectableFormat=function(){return a.props.triggers.map((function(e){return{value:e.code,label:e.name}}))},a.getSelectedTriggerValue=function(){var e=a.getTriggersInSelectableFormat().find((function(e){return e.value===a.props.node.selectedTrigger}));return e?" - ".concat(e.label):""},a.state={nodeFormName:a.props.node.name,selectedTrigger:a.props.node.selectedTrigger,dialogOpened:!1,anchorElementForTooltip:null},a}return Object(B.a)(n,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return h.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color}},h.createElement("div",{className:"node-container",onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:this.bem("__icon")},h.createElement(ce.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__right")},h.createElement(St,{name:"right",node:this.props.node}),h.createElement(Dt,{elementId:this.props.node.id,color:"#21ba45",position:"right"})))),h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Event ".concat(this.getSelectedTriggerValue()))),h.createElement(Bt,{id:this.props.node.id,isTrigger:!0,anchorElement:this.state.anchorElementForTooltip}),h.createElement(Ot.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},h.createElement(Tt.a,{id:"form-dialog-title"},"Event node"),h.createElement(jt.a,null,h.createElement(kt.a,null,'Events are emitted on any change related to user. We recommend to combine "before" events with "Wait" operations to achieve execution at any desired time.'),h.createElement($.a,{container:!0},h.createElement($.a,{item:!0,xs:6},h.createElement(yt.a,{margin:"normal",id:"trigger-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),h.createElement($.a,{container:!0},h.createElement($.a,{item:!0,xs:12},h.createElement(Ut.a,{value:this.getTriggersInSelectableFormat().find((function(t){return t.value===e.state.selectedTrigger})),options:this.getTriggersInSelectableFormat(),getOptionLabel:function(e){return e.label},style:{marginTop:16},onChange:function(t,n){null!==n&&e.setState({selectedTrigger:n.value})},renderInput:function(e){return h.createElement(yt.a,Object.assign({},e,{variant:"standard",label:"Trigger",fullWidth:!0}))}})))),h.createElement(Nt.a,null,h.createElement(H.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),h.createElement(H.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedTrigger=e.state.selectedTrigger,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),n}(h.Component);var ea=Object(v.b)((function(e){return{triggers:e.triggers.avalaibleTriggers}}))($n),ta=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){return Object(A.a)(this,n),t.call(this,"trigger")}return Object(B.a)(n,[{key:"generateReactWidget",value:function(e,t){return h.createElement(ea,{diagramEngine:e,node:t,classBaseName:"square-node",className:"trigger-node"})}},{key:"getNewInstance",value:function(){return new Qn}}]),n}(V.AbstractNodeFactory),na=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(A.a)(this,n),t.call(this,e,"trigger_before")}return Object(B.a)(n)}(ft),aa=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,"before_trigger",e.id)).name=e.name,a.selectedTrigger=e.selectedTrigger,a.time=void 0!==e.time?e.time:10,a.timeUnit=void 0!==e.timeUnit?e.timeUnit:"hours",a.addPort(new na("right")),a}return Object(B.a)(n,[{key:"deSerialize",value:function(e,t){Object(mt.a)(Object(ut.a)(n.prototype),"deSerialize",this).call(this,e,t),this.name=e.name,this.selectedTrigger=e.selectedTrigger,this.time=e.time,this.timeUnit=e.timeUnit}},{key:"serialize",value:function(){return pt.merge(Object(mt.a)(Object(ut.a)(n.prototype),"serialize",this).call(this),{name:this.name,selectedTrigger:this.selectedTrigger,time:this.time,timeUnit:this.timeUnit})}}]),n}(V.NodeModel),ia=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,e)).openDialog=function(){a.setState({dialogOpened:!0,nodeFormName:a.props.node.name,nodeFormBeforeTime:a.props.node.time,timeUnit:a.props.node.timeUnit,anchorElementForTooltip:null}),a.props.dispatch(_t(!1))},a.closeDialog=function(){a.setState({dialogOpened:!1}),a.props.dispatch(_t(!0))},a.handleNodeMouseEnter=function(e){a.state.dialogOpened||a.setState({anchorElementForTooltip:e.currentTarget})},a.handleNodeMouseLeave=function(){a.setState({anchorElementForTooltip:null})},a.getTriggersInSelectableFormat=function(){return a.props.beforeTriggers.map((function(e){return{value:e.code,label:e.name}}))},a.getSelectedTriggerValue=function(){var e=a.getTriggersInSelectableFormat().find((function(e){return e.value===a.props.node.selectedTrigger}));return e?"".concat(a.props.node.time," ").concat(a.props.node.timeUnit," before - ").concat(e.label," event"):"Before Event"},a.state={nodeFormName:a.props.node.name,selectedTrigger:a.props.node.selectedTrigger,nodeFormBeforeTime:a.props.node.time,timeUnit:a.props.node.timeUnit,dialogOpened:!1,anchorElementForTooltip:null},a}return Object(B.a)(n,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return h.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(Ee.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__right")},h.createElement(St,{name:"right",node:this.props.node}),h.createElement(Dt,{elementId:this.props.node.id,color:"#00b5ad",position:"right"})))),h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:this.getSelectedTriggerValue())),h.createElement(Bt,{id:this.props.node.id,isTrigger:!0,anchorElement:this.state.anchorElementForTooltip}),h.createElement(Ot.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},h.createElement(Tt.a,{id:"form-dialog-title"},"Before event node"),h.createElement(jt.a,null,h.createElement(kt.a,null,"Events are emitted in advanced of trigger according to selected time period."),h.createElement($.a,{container:!0},h.createElement($.a,{item:!0,xs:6},h.createElement(yt.a,{margin:"normal",id:"trigger-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),h.createElement($.a,{container:!0},h.createElement($.a,{item:!0,xs:12},h.createElement(Ut.a,{value:this.getTriggersInSelectableFormat().find((function(t){return t.value===e.state.selectedTrigger})),options:this.getTriggersInSelectableFormat(),getOptionLabel:function(e){return e.label},style:{marginBottom:16},onChange:function(t,n){null!==n&&e.setState({selectedTrigger:n.value})},renderInput:function(e){return h.createElement(yt.a,Object.assign({},e,{variant:"standard",label:"Trigger",fullWidth:!0}))}}))),h.createElement($.a,{container:!0},h.createElement($.a,{item:!0,xs:6},h.createElement(yt.a,{id:"waiting-time",label:"Before time",type:"number",fullWidth:!0,value:this.state.nodeFormBeforeTime,onChange:function(t){e.setState({nodeFormBeforeTime:t.target.value})}})),h.createElement($.a,{item:!0,xs:6},h.createElement(Kt.a,{fullWidth:!0},h.createElement(qt.a,{htmlFor:"time-unit"},"Time unit"),h.createElement(Zt.a,{value:this.state.timeUnit,onChange:function(t){e.setState({timeUnit:t.target.value})},inputProps:{name:"time-unit",id:"time-unit"}},h.createElement(Yt.a,{value:"minutes"},"Minutes"),h.createElement(Yt.a,{value:"hours"},"Hours"),h.createElement(Yt.a,{value:"days"},"Days")))))),h.createElement(Nt.a,null,h.createElement(H.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),h.createElement(H.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedTrigger=e.state.selectedTrigger,e.props.node.time=e.state.nodeFormBeforeTime,e.props.node.timeUnit=e.state.timeUnit,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),n}(h.Component);var ra=Object(v.b)((function(e){return{beforeTriggers:e.beforeTriggers.availableBeforeTriggers}}))(ia),oa=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){return Object(A.a)(this,n),t.call(this,"before_trigger")}return Object(B.a)(n,[{key:"generateReactWidget",value:function(e,t){return h.createElement(ra,{diagramEngine:e,node:t,classBaseName:"square-node",className:"before-trigger-node"})}},{key:"getNewInstance",value:function(){return new aa}}]),n}(V.AbstractNodeFactory),la=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(A.a)(this,n),t.call(this,e,"wait")}return Object(B.a)(n)}(ft),sa=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,"wait",e.id)).name=e.name,a.waitingTime=void 0!==e.waitingTime?e.waitingTime:10,a.waitingUnit=void 0!==e.waitingUnit?e.waitingUnit:"minutes",a.addPort(new la("left")),a.addPort(new la("right")),a}return Object(B.a)(n,[{key:"deSerialize",value:function(e,t){Object(mt.a)(Object(ut.a)(n.prototype),"deSerialize",this).call(this,e,t),this.name=e.name,this.waitingTime=e.waitingTime,this.waitingUnit=e.waitingUnit}},{key:"serialize",value:function(){return pt.merge(Object(mt.a)(Object(ut.a)(n.prototype),"serialize",this).call(this),{name:this.name,waitingTime:this.waitingTime,waitingUnit:this.waitingUnit})}}]),n}(V.NodeModel),ca=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,e)).openDialog=function(){a.setState({dialogOpened:!0,nodeFormWaitingTime:a.props.node.waitingTime,nodeFormName:a.props.node.name,timeUnit:a.props.node.waitingUnit,anchorElementForTooltip:null}),a.props.dispatch(_t(!1))},a.closeDialog=function(){a.setState({dialogOpened:!1}),a.props.dispatch(_t(!0))},a.handleNodeMouseEnter=function(e){a.state.dialogOpened||a.setState({anchorElementForTooltip:e.currentTarget})},a.handleNodeMouseLeave=function(){a.setState({anchorElementForTooltip:null})},a.state={nodeFormWaitingTime:a.props.node.waitingTime,nodeFormName:a.props.node.name,timeUnit:a.props.node.waitingUnit,dialogOpened:!1,anchorElementForTooltip:null},a}return Object(B.a)(n,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return h.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(me.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__left")},h.createElement(St,{name:"left",node:this.props.node})),h.createElement("div",{className:this.bem("__right")},h.createElement(St,{name:"right",node:this.props.node}),h.createElement(Dt,{elementId:this.props.node.id,color:"#ff851b",position:"right"})))),h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Wait - ".concat(this.props.node.waitingTime," ").concat(this.props.node.waitingUnit))),h.createElement(Bt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),h.createElement(Ot.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},h.createElement(Tt.a,{id:"form-dialog-title"},"Wait node"),h.createElement(jt.a,null,h.createElement(kt.a,null,"Postpones the execution of next node in flow by selected amount of time."),h.createElement($.a,{container:!0},h.createElement($.a,{item:!0,xs:6},h.createElement(yt.a,{margin:"normal",id:"waiting-time",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),h.createElement($.a,{container:!0},h.createElement($.a,{item:!0,xs:6},h.createElement(yt.a,{id:"waiting-time",label:"Waiting time",type:"number",fullWidth:!0,value:this.state.nodeFormWaitingTime,onChange:function(t){e.setState({nodeFormWaitingTime:t.target.value})}})),h.createElement($.a,{item:!0,xs:6},h.createElement(Kt.a,{fullWidth:!0},h.createElement(qt.a,{htmlFor:"time-unit"},"Time unit"),h.createElement(Zt.a,{value:this.state.timeUnit,onChange:function(t){e.setState({timeUnit:t.target.value})},inputProps:{name:"time-unit",id:"time-unit"}},h.createElement(Yt.a,{value:"minutes"},"Minutes"),h.createElement(Yt.a,{value:"hours"},"Hours"),h.createElement(Yt.a,{value:"days"},"Days")))))),h.createElement(Nt.a,null,h.createElement(H.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),h.createElement(H.a,{color:"primary",onClick:function(){e.props.node.waitingTime=e.state.nodeFormWaitingTime,e.props.node.name=e.state.nodeFormName,e.props.node.waitingUnit=e.state.timeUnit,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),n}(h.Component);var da=Object(v.b)((function(e){return{segments:e.segments.avalaibleSegments}}))(ca),ma=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){return Object(A.a)(this,n),t.call(this,"wait")}return Object(B.a)(n,[{key:"generateReactWidget",value:function(e,t){return h.createElement(da,{diagramEngine:e,node:t,classBaseName:"round-node",className:"wait-node"})}},{key:"getNewInstance",value:function(){return new sa}}]),n}(V.AbstractNodeFactory),ua=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top";return Object(A.a)(this,n),t.call(this,e,"goal")}return Object(B.a)(n)}(vt),pa=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,"goal",e.id)).name=e.name,a.selectedGoals=e.selectedGoals,a.timeoutTime=e.timeoutTime,a.timeoutUnit=e.timeoutUnit,a.recheckPeriodTime=e.recheckPeriodTime,a.recheckPeriodUnit=e.recheckPeriodUnit,a.addPort(new ua("left")),a.addPort(new ua("bottom")),a.addPort(new ua("right")),a}return Object(B.a)(n,[{key:"deSerialize",value:function(e,t){Object(mt.a)(Object(ut.a)(n.prototype),"deSerialize",this).call(this,e,t),this.name=e.name,this.selectedGoals=e.selectedGoals,this.timeoutTime=null!==e.timeoutTime&&void 0!==e.timeoutTime?e.timeoutTime:"",this.timeoutUnit=null!==e.timeoutUnit&&void 0!==e.timeoutUnit?e.timeoutUnit:"days",this.recheckPeriodTime=null!==e.recheckPeriodTime&&void 0!==e.recheckPeriodTime?e.recheckPeriodTime:"1",this.recheckPeriodUnit=null!==e.recheckPeriodUnit&&void 0!==e.recheckPeriodUnit?e.recheckPeriodUnit:"hours"}},{key:"serialize",value:function(){return pt.merge(Object(mt.a)(Object(ut.a)(n.prototype),"serialize",this).call(this),{name:this.name,selectedGoals:this.selectedGoals,timeoutTime:this.timeoutTime,timeoutUnit:this.timeoutUnit,recheckPeriodTime:this.recheckPeriodTime,recheckPeriodUnit:this.recheckPeriodUnit})}}]),n}(V.NodeModel),ha=n(183),ga=n.n(ha),fa=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,e)).openDialog=function(){a.setState({dialogOpened:!0,nodeFormName:a.props.node.name,selectedGoals:a.props.node.selectedGoals,timeoutTime:a.props.node.timeoutTime,timeoutUnit:a.props.node.timeoutUnit,recheckPeriodTime:a.props.node.recheckPeriodTime,recheckPeriodUnit:a.props.node.recheckPeriodUnit,anchorElementForTooltip:null}),a.props.dispatch(_t(!1))},a.closeDialog=function(){a.setState({dialogOpened:!1}),a.props.dispatch(_t(!0))},a.transformOptionsForSelect=function(){return a.props.goals.map((function(e){return{value:e.code,label:e.name}}))},a.handleNodeMouseEnter=function(e){a.state.dialogOpened||a.setState({anchorElementForTooltip:e.currentTarget})},a.handleNodeMouseLeave=function(){a.setState({anchorElementForTooltip:null})},a.getSelectedGoals=function(){return void 0===a.state.selectedGoals?[]:a.props.goals.filter((function(e){return a.state.selectedGoals.includes(e.code)}),a.state.selectedGoals)},a.state={nodeFormName:a.props.node.name,selectedGoals:a.props.node.selectedGoals,timeoutTime:a.props.node.timeoutTime,timeoutUnit:a.props.node.timeoutUnit,recheckPeriodTime:a.props.node.recheckPeriodTime,recheckPeriodUnit:a.props.node.recheckPeriodUnit,dialogOpened:!1,anchorElementForTooltip:null},a}return Object(B.a)(n,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return h.createElement("div",{className:this.getClassName(),onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Goal")),h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(ve.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__left")},h.createElement(St,{name:"left",node:this.props.node})),h.createElement("div",{className:this.bem("__right")},h.createElement(St,{name:"right",node:this.props.node}),this.props.statistics[this.props.node.id]?h.createElement(Dt,{elementId:this.props.node.id,color:"#21ba45",position:"right"}):h.createElement(Vn.a,{style:{position:"absolute",top:"-5px",right:"-30px",color:"#2ECC40"}})),h.createElement("div",{className:this.bem("__bottom")},h.createElement(St,{name:"bottom",node:this.props.node}),this.props.statistics[this.props.node.id]?h.createElement(Dt,{elementId:this.props.node.id,color:"#db2828",position:"bottom"}):h.createElement(ga.a,{style:{position:"absolute",top:"15px",right:"-5px",color:"#FF695E"}})))),h.createElement(Bt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),h.createElement(Ot.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},h.createElement(Tt.a,{id:"form-dialog-title"},"Goal node"),h.createElement(jt.a,null,h.createElement(kt.a,null,"Goal node evaluates whether user has completed selected onboarding goals. Timeout value can be optionally specified, defining a point in time when evalution of completed goals is stopped. Execution flow can be directed two ways from the node - a positive direction, when all goals are completed, or a negative one, when timeout threshold is reached."),h.createElement($.a,{container:!0},h.createElement($.a,{item:!0,xs:6},h.createElement(yt.a,{margin:"normal",id:"goal-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),h.createElement($.a,{container:!0,style:{marginBottom:"10px"}},h.createElement($.a,{item:!0,xs:12},h.createElement(Ut.a,{multiple:!0,value:this.getSelectedGoals(),options:this.props.goals,getOptionLabel:function(e){return e.name},disableClearable:!0,onChange:function(t,n){null!==n&&e.setState({selectedGoals:n.map((function(e){return e.code}))})},renderInput:function(e){return h.createElement(yt.a,Object.assign({},e,{variant:"standard",label:"Selected Goal(s)",fullWidth:!0}))}}))),h.createElement($.a,{container:!0,spacing:1},h.createElement($.a,{item:!0,xs:6},h.createElement(yt.a,{id:"recheck-period-time",label:"Recheck period time",type:"number",helperText:"How often goals completition should be checked",fullWidth:!0,value:this.state.recheckPeriodTime,onChange:function(t){e.setState({recheckPeriodTime:t.target.value})}})),h.createElement($.a,{item:!0,xs:6},h.createElement(Kt.a,{fullWidth:!0},h.createElement(qt.a,{htmlFor:"time-unit"},"Time unit"),h.createElement(Zt.a,{value:this.state.recheckPeriodUnit,onChange:function(t){e.setState({recheckPeriodUnit:t.target.value})},inputProps:{name:"recheck-period-unit",id:"recheck-period-unit"}},h.createElement(Yt.a,{value:"minutes"},"Minutes"),h.createElement(Yt.a,{value:"hours"},"Hours"),h.createElement(Yt.a,{value:"days"},"Days"))))),h.createElement($.a,{container:!0,spacing:1},h.createElement($.a,{item:!0,xs:6},h.createElement(yt.a,{id:"timeout-time",label:"Timeout time",type:"number",placeholder:"No timeout",helperText:"Optionally select a timeout",fullWidth:!0,value:this.state.timeoutTime,onChange:function(t){e.setState({timeoutTime:t.target.value})}})),h.createElement($.a,{item:!0,xs:6},h.createElement(Kt.a,{fullWidth:!0},h.createElement(qt.a,{htmlFor:"time-unit"},"Time unit"),h.createElement(Zt.a,{value:this.state.timeoutUnit,onChange:function(t){e.setState({timeoutUnit:t.target.value})},inputProps:{name:"time-unit",id:"time-unit"}},h.createElement(Yt.a,{value:"minutes"},"Minutes"),h.createElement(Yt.a,{value:"hours"},"Hours"),h.createElement(Yt.a,{value:"days"},"Days")))))),h.createElement(Nt.a,null,h.createElement(H.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),h.createElement(H.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedGoals=e.state.selectedGoals,e.props.node.timeoutTime=e.state.timeoutTime,e.props.node.timeoutUnit=e.state.timeoutUnit,e.props.node.recheckPeriodTime=e.state.recheckPeriodTime,e.props.node.recheckPeriodUnit=e.state.recheckPeriodUnit,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),n}(h.Component);var va=Object(v.b)((function(e){var t=e.goals,n=e.dispatch;return{goals:t.availableGoals,dispatch:n,statistics:e.statistics.statistics}}))(fa),ba=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){return Object(A.a)(this,n),t.call(this,"goal")}return Object(B.a)(n,[{key:"generateReactWidget",value:function(e,t){return h.createElement(va,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"goal-node"})}},{key:"getNewInstance",value:function(){return new pa}}]),n}(V.AbstractNodeFactory),Ea=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top";return Object(A.a)(this,n),t.call(this,e,"condition")}return Object(B.a)(n)}(vt),ya=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,"condition",e.id)).name=e.name,a.conditions=e.conditions,a.addPort(new Ea("left")),a.addPort(new Ea("bottom")),a.addPort(new Ea("right")),a}return Object(B.a)(n,[{key:"deSerialize",value:function(e,t){Object(mt.a)(Object(ut.a)(n.prototype),"deSerialize",this).call(this,e,t),this.name=e.name,this.conditions=e.conditions}},{key:"serialize",value:function(){return pt.merge(Object(mt.a)(Object(ut.a)(n.prototype),"serialize",this).call(this),{name:this.name,conditions:this.conditions})}}]),n}(V.NodeModel),Oa=n(117),Na=n.n(Oa),ja=n(80),ka=n.n(ja),Ta=n(415),Ca=Object(on.a)((function(e){return{formControl:{marginRight:e.spacing(1),marginBottom:e.spacing(1),minWidth:150},formLabel:{display:"block",marginBottom:e.spacing(1)},amountInput:{marginRight:e.spacing(1),marginBottom:e.spacing(1)}}}));function Sa(e){var t,n,a,i,r=Ca();void 0===e.values.operator&&e.blueprint.operators&&1===e.blueprint.operators.length&&e.dispatch(cn(e.name,{operator:e.blueprint.operators[0]})),void 0===e.values.unit&&e.blueprint.units&&1===e.blueprint.units.length&&e.dispatch(dn(e.name,{unit:e.blueprint.units[0]}));return g.a.createElement(g.a.Fragment,null,!e.hideLabel&&g.a.createElement(pn.a,{className:r.formLabel},e.blueprint.label),e.blueprint.operators&&e.blueprint.operators.length&&g.a.createElement(Kt.a,{className:r.formControl,disabled:1===e.blueprint.operators.length},g.a.createElement(qt.a,null,"Operator"),g.a.createElement(Zt.a,{autoWidth:!0,value:null!==(t=e.values.operator)&&void 0!==t?t:"",onChange:function(t){e.dispatch(dn(e.name,{operator:t.target.value}))}},e.blueprint.operators.map((function(e){return g.a.createElement(Yt.a,{key:e,value:e},e)})))),g.a.createElement(yt.a,{className:r.amountInput,label:e.blueprint.amountLabel,type:"number",onChange:function(t){e.dispatch(dn(e.name,{selection:t.target.value}))},value:null!==(n=e.values.selection)&&void 0!==n?n:"",inputProps:null!==(a=e.blueprint.amountInputAttributes)&&void 0!==a?a:{}}),e.blueprint.units&&e.blueprint.units.length&&g.a.createElement(Kt.a,{className:r.formControl,disabled:1===e.blueprint.units.length},g.a.createElement(qt.a,null,e.blueprint.unitsLabel),g.a.createElement(Zt.a,{autoWidth:!0,value:null!==(i=e.values.unit)&&void 0!==i?i:"",onChange:function(t){e.dispatch(dn(e.name,{unit:t.target.value}))}},e.blueprint.units.map((function(e){return g.a.createElement(Yt.a,{key:e,value:e},e)})))))}var _a=n(70),wa=n.n(_a);function Ma(){return{id:wa()(),key:"",params:[]}}function Fa(e,t){switch(t.type){case"UPDATE_PARAM_VALUES":var n=Object(tn.a)(t.payload.name,2),a=n[0],i=n[1];return Object(N.a)(Object(N.a)({},e),{},{nodes:e.nodes.map((function(e){return e.id===a?Object(N.a)(Object(N.a)({},e),{},{params:e.params.map((function(e){return e.key===i?Object(N.a)(Object(N.a)({},e),{},{values:Object.assign(e.values,t.payload.values)}):e}))}):e}))});case"SET_PARAM_VALUES":var r=Object(tn.a)(t.payload.name,2),o=r[0],l=r[1];return Object(N.a)(Object(N.a)({},e),{},{nodes:e.nodes.map((function(e){return e.id===o?Object(N.a)(Object(N.a)({},e),{},{params:e.params.map((function(e){return e.key===l?Object(N.a)(Object(N.a)({},e),{},{values:t.payload.values}):e}))}):e}))});case"SET_EVENT":return Object(N.a)(Object(N.a)({},e),{},{nodes:[Ma()],event:t.payload});case"ADD_CRITERION":return Object(N.a)(Object(N.a)({},e),{},{nodes:[].concat(Object(Ye.a)(e.nodes),[Ma()])});case"DELETE_NODE":return Object(N.a)(Object(N.a)({},e),{},{nodes:e.nodes.filter((function(e){return e.id!==t.payload.nodeId}))});case"SET_KEY_FOR_NODE":var s=e.nodes.map((function(e){return t.payload.nodeId===e.id?{id:e.id,key:t.payload.key,params:t.payload.params}:e}));return Object(N.a)(Object(N.a)({},e),{},{nodes:s});default:throw new Error("unsupported action type "+t.type)}}var Pa=g.a.createContext(null);function xa(e){var t=Object(h.useContext)(Pa),n=e.node.params.filter((function(t){return t.key===e.blueprint.key}))[0],a=[e.node.id,n.key];switch(e.blueprint.type){case"string_labeled_array":return g.a.createElement(Nn,{name:a,values:n.values,blueprint:e.blueprint,dispatch:t});case"boolean":return g.a.createElement(un,{name:a,values:n.values,blueprint:e.blueprint,dispatch:t});case"number":return g.a.createElement(gn,{name:a,values:n.values,blueprint:e.blueprint,dispatch:t,hideLabel:!0});case"timeframe":return g.a.createElement(Sa,{name:a,values:n.values,blueprint:e.blueprint,dispatch:t});default:throw new Error("unsupported node type "+e.blueprint.type)}}function Da(e){return g.a.createElement(g.a.Fragment,null,e.blueprint.map((function(t){return g.a.createElement(xa,{key:t.key,node:e.node,blueprint:t})})))}var Ia=Object(on.a)({cardContent:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",backgroundColor:"#F2F2F2"},formControl:{minWidth:"180px"}});function Aa(e){var t=Ia(),n=Object(h.useContext)(Pa);return g.a.createElement(an.a,null,g.a.createElement(rn.a,{className:t.cardContent},g.a.createElement(Kt.a,{className:t.formControl},g.a.createElement(qt.a,{id:"select-criteria-label"},"Criterion"),g.a.createElement(Zt.a,{labelId:"select-criteria-label",id:"select-criteria",placeholder:"Select criteria",value:e.node.key,onChange:function(t){var a,i=e.criteriaBlueprint.filter((function(e){return e.key===t.target.value}))[0].params.map((function(e){return{key:e.key,values:{}}}));n((a=e.node.id,{type:"SET_KEY_FOR_NODE",payload:{key:t.target.value,nodeId:a,params:i}}))}},e.criteriaBlueprint.map((function(e){return g.a.createElement(Yt.a,{key:e.key,value:e.key},e.label)})))),g.a.createElement(Ta.a,{onClick:function(){return n({type:"DELETE_NODE",payload:{nodeId:e.node.id}})},size:"small",className:t.icon,"aria-label":"delete"},g.a.createElement(Na.a,null))),e.node.key&&g.a.createElement(rn.a,null,g.a.createElement(Da,{node:e.node,blueprint:e.criteriaBlueprint.filter((function(t){return t.key===e.node.key}))[0].params})))}var Ba=Object(on.a)({andContainer:{display:"flex",justifyContent:"center",flexGrow:0,maxWidth:"100%",flexBasis:"100%"}});function Ua(e){var t=Ba(),n=Object(h.useContext)(Pa);return g.a.createElement(g.a.Fragment,null,e.nodes.map((function(n,a){return g.a.createElement(g.a.Fragment,{key:n.id},a>=1&&g.a.createElement("div",{className:t.andContainer},"AND"),g.a.createElement($.a,{item:!0,xs:12},g.a.createElement(Aa,{node:n,criteriaBlueprint:e.criteriaBlueprint})))})),g.a.createElement($.a,{item:!0,xs:12},g.a.createElement(H.a,{onClick:function(){return n({type:"ADD_CRITERION"})},className:t.button,startIcon:g.a.createElement(ka.a,null)},"Add criterion")))}var La=Object(on.a)({selectedButton:{backgroundColor:"#E4E4E4"},deselectedButton:{color:"#A6A6A6"}});var za=Object(h.forwardRef)((function(e,t){var n=La(),a=Object(v.c)((function(e){return e.criteria.criteria})),i=Object(h.useReducer)(Fa,Object(N.a)({version:1,event:a[0].event,nodes:[Ma()]},e.conditions)),r=Object(tn.a)(i,2),o=r[0],l=r[1];return Object(h.useImperativeHandle)(t,(function(){return{state:o}})),g.a.createElement(Pa.Provider,{value:l},g.a.createElement($.a,{container:!0,item:!0,xs:12,spacing:3},g.a.createElement($.a,{item:!0,xs:12},g.a.createElement(Dn.a,{"aria-label":"outlined button group"},a.map((function(e){return g.a.createElement(H.a,{onClick:function(){return l({type:"SET_EVENT",payload:e.event})},className:o.event===e.event?n.selectedButton:n.deselectedButton,key:e.event},e.event)})))),a.filter((function(e){return e.event===o.event})).map((function(e){return g.a.createElement(Ua,{key:e.event,criteriaBlueprint:e.criteria,nodes:o.nodes})}))))})),Wa=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,e)).openDialog=function(){a.setState({dialogOpened:!0,nodeFormName:a.props.node.name,anchorElementForTooltip:null}),a.props.dispatch(_t(!1))},a.closeDialog=function(){a.setState({dialogOpened:!1}),a.props.dispatch(_t(!0))},a.handleNodeMouseEnter=function(e){a.state.dialogOpened||a.setState({anchorElementForTooltip:e.currentTarget})},a.handleNodeMouseLeave=function(){a.setState({anchorElementForTooltip:null})},a.builderRef=h.createRef(),a.state={nodeFormName:a.props.node.name,dialogOpened:!1,anchorElementForTooltip:null},a}return Object(B.a)(n,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this,t=!1;return(0===this.props.statistics.length||this.props.statistics[this.props.node.id])&&(t=!0),h.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Condition")),h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(ge.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__left")},h.createElement(St,{name:"left",node:this.props.node})),h.createElement("div",{className:this.bem("__right")},h.createElement(St,{name:"right",node:this.props.node}),t?h.createElement(Dt,{elementId:this.props.node.id,color:"#21ba45",position:"right"}):h.createElement(Vn.a,{style:{position:"absolute",top:"-5px",right:"-30px",color:"#2ECC40"}})),h.createElement("div",{className:this.bem("__bottom")},h.createElement(St,{name:"bottom",node:this.props.node}),t?h.createElement(Dt,{elementId:this.props.node.id,color:"#db2828",position:"bottom"}):h.createElement(Kn.a,{style:{position:"absolute",top:"15px",right:"-5px",color:"#FF695E"}})))),h.createElement(Bt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),h.createElement(Ot.a,{fullWidth:!0,maxWidth:"md",open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},h.createElement(Tt.a,{id:"form-dialog-title"},"Event Condition"),h.createElement(jt.a,null,h.createElement($.a,{container:!0},h.createElement($.a,{style:{marginBottom:"10px"},item:!0,xs:6},h.createElement(yt.a,{margin:"normal",id:"trigger-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}})),h.createElement(za,{conditions:this.props.node.conditions,ref:this.builderRef}))),h.createElement(Nt.a,null,h.createElement(H.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),h.createElement(H.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.conditions=e.builderRef.current.state,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),n}(h.Component);var Ra=Object(v.b)((function(e){return{dispatch:e.dispatch,statistics:e.statistics.statistics}}))(Wa),Ga=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){return Object(A.a)(this,n),t.call(this,"condition")}return Object(B.a)(n,[{key:"generateReactWidget",value:function(e,t){return h.createElement(Ra,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"condition-node"})}},{key:"getNewInstance",value:function(){return new ya}}]),n}(V.AbstractNodeFactory),Va=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(A.a)(this,n),t.call(this,e,"push_notification")}return Object(B.a)(n)}(ft),Ha=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,"push_notification",e.id)).name=e.name,a.selectedTemplate=e.selectedTemplate,a.selectedApplication=e.selectedApplication,a.addPort(new Va("left")),a.addPort(new Va("right")),a}return Object(B.a)(n,[{key:"deSerialize",value:function(e,t){Object(mt.a)(Object(ut.a)(n.prototype),"deSerialize",this).call(this,e,t),this.name=e.name,this.selectedTemplate=e.selectedTemplate,this.selectedApplication=e.selectedApplication}},{key:"serialize",value:function(){return pt.merge(Object(mt.a)(Object(ut.a)(n.prototype),"serialize",this).call(this),{name:this.name,selectedTemplate:this.selectedTemplate,selectedApplication:this.selectedApplication})}}]),n}(V.NodeModel),Ka=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,e)).openDialog=function(){a.setState({dialogOpened:!0,nodeFormName:a.props.node.name,anchorElementForTooltip:null}),a.props.dispatch(_t(!1))},a.closeDialog=function(){a.setState({dialogOpened:!1}),a.props.dispatch(_t(!0))},a.handleNodeMouseEnter=function(e){a.state.dialogOpened||a.setState({anchorElementForTooltip:e.currentTarget})},a.handleNodeMouseLeave=function(){a.setState({anchorElementForTooltip:null})},a.getTemplatesInSelectableFormat=function(){return a.props.templates.map((function(e){return{value:e.code,label:e.name}}))},a.getApplicationsInSelectableFormat=function(){return a.props.applications.map((function(e){return{value:e.code,label:e.name}}))},a.getSelectedTemplateValue=function(){var e=a.props.templates.find((function(e){return e.code===a.props.node.selectedTemplate}));return e?" - ".concat(e.name):""},a.state={nodeFormName:a.props.node.name,selectedTemplate:a.props.node.selectedTemplate,selectedApplication:a.props.node.selectedApplication,dialogOpened:!1,anchorElementForTooltip:null},a}return Object(B.a)(n,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return h.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(Oe.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__left")},h.createElement(St,{name:"left",node:this.props.node})),h.createElement("div",{className:this.bem("__right")},h.createElement(St,{name:"right",node:this.props.node}),h.createElement(Dt,{elementId:this.props.node.id,color:"#dc73ff",position:"right"})))),h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Notification ".concat(this.getSelectedTemplateValue()))),h.createElement(Bt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),h.createElement(Ot.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},h.createElement(Tt.a,{id:"form-dialog-title"},"Notification node"),h.createElement(jt.a,null,h.createElement(kt.a,null,"Sends a push notification to user."),h.createElement($.a,{container:!0},h.createElement($.a,{item:!0,xs:6},h.createElement(yt.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),h.createElement($.a,{container:!0,alignItems:"center",alignContent:"space-between"},h.createElement($.a,{item:!0,xs:12},h.createElement(Ut.a,{value:this.getTemplatesInSelectableFormat().find((function(t){return t.value===e.state.selectedTemplate})),options:this.getTemplatesInSelectableFormat(),getOptionLabel:function(e){return e.label},style:{marginBottom:16},onChange:function(t,n){null!==n&&e.setState({selectedTemplate:n.value})},renderInput:function(e){return h.createElement(yt.a,Object.assign({},e,{variant:"standard",label:"Notification template",fullWidth:!0}))}}))),h.createElement($.a,{container:!0,alignItems:"center",alignContent:"space-between"},h.createElement($.a,{item:!0,xs:12},h.createElement(Ut.a,{value:this.getApplicationsInSelectableFormat().find((function(t){return t.value===e.state.selectedApplication})),options:this.getApplicationsInSelectableFormat(),getOptionLabel:function(e){return e.label},style:{marginBottom:16},onChange:function(t,n){null!==n&&e.setState({selectedApplication:n.value})},renderInput:function(e){return h.createElement(yt.a,Object.assign({},e,{variant:"standard",label:"Application",fullWidth:!0}))}})))),h.createElement(Nt.a,null,h.createElement(H.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),h.createElement(H.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedTemplate=e.state.selectedTemplate,e.props.node.selectedApplication=e.state.selectedApplication,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),n}(h.Component);var qa=Object(v.b)((function(e){return{templates:e.pushNotifications.availableTemplates,applications:e.pushNotifications.availableApplications}}))(Ka),Za=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){return Object(A.a)(this,n),t.call(this,"push_notification")}return Object(B.a)(n,[{key:"generateReactWidget",value:function(e,t){return h.createElement(qa,{diagramEngine:e,node:t,classBaseName:"square-node",className:"push-notification-node"})}},{key:"getNewInstance",value:function(){return new Ha}}]),n}(V.AbstractNodeFactory),Ya=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"right";return Object(A.a)(this,n),t.call(this,e,"ab_test")}return Object(B.a)(n)}(vt),Ja=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,"ab_test",e.id)).name=e.name,a.scenarioName=e.scenarioName,e.variants?a.variants=e.variants:a.variants=[{code:wa()().slice(0,6),name:"Variant A",distribution:50},{code:wa()().slice(0,6),name:"Variant B",distribution:50}],a.addPort(new Ya("left")),a.variants.forEach((function(e,t){return a.addPort(new Ya("right."+t))})),a}return Object(B.a)(n,[{key:"deSerialize",value:function(e,t){Object(mt.a)(Object(ut.a)(n.prototype),"deSerialize",this).call(this,e,t),this.name=e.name,this.variants=e.variants}},{key:"serialize",value:function(){return pt.merge(Object(mt.a)(Object(ut.a)(n.prototype),"serialize",this).call(this),{name:this.name,variants:this.variants})}}]),n}(V.NodeModel),Xa=n(409),Qa=n(424),$a=n(184),ei=n.n($a),ti=n(185),ni=n.n(ti);function ai(e,t){var n=!1;switch(t.type){case"ADD_VARIANT":return Object(N.a)(Object(N.a)({},e),{},{variants:[].concat(Object(Ye.a)(e.variants),[{code:wa()().slice(0,6),name:"Variant "+String.fromCharCode(65+e.variants.length),distribution:0}])});case"DELETE_VARIANT":var a=e.variants.filter((function(e,n){return n!==t.payload.index}));return 100!==a.reduce((function(e,t){return e+parseInt(t.distribution)}),0)&&(n=!0),Object(N.a)(Object(N.a)({},e),{},{variants:a,isError:n});case"UPDATE_VARIANT_DISTRIBUTION":return n=e.variants.filter((function(e,n){return n!==t.payload.index})).reduce((function(e,t){return e+parseInt(t.distribution)}),0)+parseInt(t.payload.value)!==100,Object(N.a)(Object(N.a)({},e),{},{variants:e.variants.map((function(e,n){return n===t.payload.index?Object(N.a)(Object(N.a)({},e),{},{distribution:t.payload.value}):e})),isError:n});case"UPDATE_VARIANT_NAME":return Object(N.a)(Object(N.a)({},e),{},{variants:e.variants.map((function(e,n){return n===t.payload.index?Object(N.a)(Object(N.a)({},e),{},{name:t.payload.value}):e}))});case"UPDATE_SEGMENT_NAME":return Object(N.a)(Object(N.a)({},e),{},{variants:e.variants.map((function(e,n){return n===t.payload.index?Object(N.a)(Object(N.a)({},e),{},{segment:{name:t.payload.name}}):e}))});default:throw new Error("unsupported action type "+t.type)}}function ii(e){var t,n="Scenario variant: "+e.scenarioName+" - "+e.nodeName+" - "+e.variantName+" ("+e.variantCode+")",a=g.a.useState(!1),i=Object(tn.a)(a,2),r=i[0],o=i[1],l=g.a.useState(null!==(t=e.segment.name)&&void 0!==t?t:n),s=Object(tn.a)(l,2),c=s[0],d=s[1];return g.a.createElement(Kt.a,null,g.a.createElement(H.a,{size:"small",variant:"outlined",color:"secondary",disableElevation:!0,onClick:function(){o(!0)},startIcon:e.segment.name?g.a.createElement(ei.a,null):g.a.createElement(ka.a,null)},e.segment.name?"Edit segment":"Create segment"),g.a.createElement(Ot.a,{open:r,fullWidth:!0,maxWidth:"md"},g.a.createElement(Tt.a,{id:"form-dialog-title"},e.segment.name?"Edit segment":"Create segment"),g.a.createElement(jt.a,null,g.a.createElement(kt.a,null,"To create associated segment to variant, please enter segment name."),g.a.createElement(yt.a,{autoFocus:!0,margin:"dense",label:"Segment name",type:"string",value:c,onChange:function(e){d(e.target.value)},fullWidth:!0}),e.segment.code?g.a.createElement("div",null,g.a.createElement(yt.a,{fullWidth:!0,margin:"dense",label:"Segment code",type:"string",value:e.segment.code,disabled:!0}),g.a.createElement(H.a,{size:"small",variant:"outlined",color:"secondary",disableElevation:!0,startIcon:g.a.createElement(ni.a,null),onClick:function(){window.open(Ve+e.segment.id)}},"View segment")):""),g.a.createElement(Nt.a,null,g.a.createElement(H.a,{onClick:function(){var t;d(null!==(t=e.segment.name)&&void 0!==t?t:n),o(!1)},color:"secondary"},"Cancel"),g.a.createElement(H.a,{onClick:function(){e.dispatch({type:"UPDATE_SEGMENT_NAME",payload:{index:e.index,name:c}}),o(!1)},color:"primary"},e.segment.name?"Save":"Create"))))}var ri=Object(h.forwardRef)((function(e,t){var n=Object(h.useReducer)(ai,Object(N.a)({},e)),a=Object(tn.a)(n,2),i=a[0],r=a[1];return void 0!==i.isError&&e.onEnableSave(!i.isError),Object(h.useImperativeHandle)(t,(function(){return{state:i}})),g.a.createElement("form",{autoComplete:"off",noValidate:!0},i.variants.flatMap((function(t,n){var a;return g.a.createElement($.a,{container:!0,spacing:1,key:"grid-index-"+n},g.a.createElement($.a,{item:!0,xs:1},g.a.createElement(yt.a,{disabled:!0,label:"ID",value:t.code})),g.a.createElement($.a,{item:!0,xs:5},g.a.createElement(Kt.a,{fullWidth:!0},g.a.createElement(yt.a,{label:"Variant name",value:t.name,required:!0,onChange:function(e){return r({type:"UPDATE_VARIANT_NAME",payload:{index:n,value:e.target.value}})}}))),g.a.createElement($.a,{item:!0,xs:2},g.a.createElement(Kt.a,null,g.a.createElement(qt.a,{error:i.isError},"Distribution"),g.a.createElement(Xa.a,{error:i.isError,required:!0,type:"number",value:t.distribution,onChange:function(e){return r({type:"UPDATE_VARIANT_DISTRIBUTION",payload:{index:n,value:e.target.value}})},endAdornment:g.a.createElement(Qa.a,{position:"end"},"%")}))),g.a.createElement($.a,{item:!0,xs:1,style:{display:"flex",alignItems:"center",justifyContent:"space-evenly"}},n>1&&g.a.createElement(Ta.a,{onClick:function(){r({type:"DELETE_VARIANT",payload:{index:n}})},size:"small","aria-label":"delete"},g.a.createElement(Na.a,null))),g.a.createElement($.a,{item:!0,xs:3,style:{display:"flex",alignItems:"center"}},g.a.createElement(ii,{index:n,variantCode:t.code,segment:null!==(a=t.segment)&&void 0!==a?a:{},dispatch:r,variantName:t.name,nodeName:e.node.name,scenarioName:e.node.scenarioName})))})),g.a.createElement($.a,{container:!0},g.a.createElement($.a,{item:!0,xs:12},g.a.createElement(H.a,{startIcon:g.a.createElement(ka.a,null),onClick:function(){r({type:"ADD_VARIANT"})}},"Add variant"))))})),oi=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,e)).openDialog=function(){a.setState({dialogOpened:!0,nodeFormName:a.props.node.name,anchorElementForTooltip:null}),a.props.dispatch(_t(!1))},a.closeDialog=function(){a.setState({dialogOpened:!1}),a.props.dispatch(_t(!0))},a.handleNodeMouseEnter=function(e){a.state.dialogOpened||a.setState({anchorElementForTooltip:e.currentTarget})},a.handleNodeMouseLeave=function(){a.setState({anchorElementForTooltip:null})},a.enableSave=function(e){a.state.enabledSave!==e&&a.setState({enabledSave:e})},a.syncNodeModel=function(){for(var e in a.props.node.variants.forEach((function(e,t){a.props.node.getPort("right."+t)||a.props.node.addPort(new Ya("right."+t))})),a.props.node.getPorts())if(e.startsWith("right.")){var t=e.split(".")[1];if(!a.props.node.variants[t]){for(var n=a.props.node.getPort(e),i=0,r=Object.entries(n.getLinks());i<r.length;i++){var o=Object(tn.a)(r[i],1)[0];a.props.diagramEngine.diagramModel.removeLink(o)}a.props.node.removePort(n)}}},a.builderRef=h.createRef(),a.state={nodeFormName:a.props.node.name,enabledSave:!0,dialogOpened:!1,anchorElementForTooltip:null},a}return Object(B.a)(n,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return h.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"AB Test")),h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(je.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__left")},h.createElement(St,{name:"left",node:this.props.node}))),h.createElement("div",{className:this.bem("__ports")},this.props.node.variants.flatMap((function(t,n){return h.createElement("div",{className:e.bem("__right"),key:"right-port-"+n,style:{position:"relative"}},h.createElement(St,{name:"right."+n,node:e.props.node}),h.createElement("div",{className:e.bem("__description")},h.createElement(Dt,{elementId:e.props.node.id,index:t.code,color:"#767676",position:"right-condensed"}),h.createElement(Q.a,{style:{fontSize:"0.8rem",marginLeft:"5px"},noWrap:!0},t.name," (",t.distribution,"%)")))})))),h.createElement(Bt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip,variants:this.props.node.variants}),h.createElement(Ot.a,{open:this.state.dialogOpened,onClose:this.closeDialog,maxWidth:"md","aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},h.createElement(Tt.a,{id:"form-dialog-title"},"AB Test"),h.createElement(jt.a,null,h.createElement(kt.a,null,"A/B testing is comparing two versions of either a webpage, email campaign or an aspect in a scenario to evaluate which performs best. With the different variants shown to your customers, you can determine which version is the most effective."),h.createElement($.a,{container:!0},h.createElement($.a,{style:{marginBottom:"10px"},item:!0,xs:6},h.createElement(yt.a,{margin:"normal",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),h.createElement(ri,{variants:this.props.node.variants,node:this.props.node,onEnableSave:this.enableSave,ref:this.builderRef})),h.createElement(Nt.a,null,h.createElement(H.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),h.createElement(H.a,{color:"primary",disabled:!this.state.enabledSave,onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.variants=e.builderRef.current.state.variants,e.syncNodeModel(),e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),n}(h.Component);var li=Object(v.b)((function(e){return{dispatch:e.dispatch}}))(oi),si=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){return Object(A.a)(this,n),t.call(this,"ab_test")}return Object(B.a)(n,[{key:"generateReactWidget",value:function(e,t){return h.createElement(li,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"abtest-node"})}},{key:"getNewInstance",value:function(){return new Ja}}]),n}(V.AbstractNodeFactory),ci=n(428),di=n(429),mi=n(430),ui=n(431),pi=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(e){var a;return Object(A.a)(this,n),(a=t.call(this,e)).saveChanges=function(){var e=a.props.dispatch;if(a.props.app.isCorruptedPayload())e(wt({open:!0,variant:"error",text:"Cannot modify corrupted scenario."}));else{var t=new Xe(a.props.app.getDiagramEngine().getDiagramModel()),n=Object(N.a)({name:a.props.scenario.name},t.exportPayload()),i=a.props.scenario.id;i&&(n.id=i),e(Pt(!0)),O.a.post("".concat(Fe),n).then((function(t){e(Mt(t.data.id)),e(Pt(!1)),e(wt({open:!0,variant:"success",text:"Scenario saving succeeded."}))})).catch((function(t){e(Pt(!1));var n="Scenario saving failed.";t.response.data&&t.response.data.message&&(n=t.response.data.message),e(wt({open:!0,variant:"error",text:n})),console.log(t)}))}},a.startEditingName=function(){a.setState({editedName:a.props.scenario.name,editingName:!0})},a.cancelEditingName=function(){a.setState({editedName:"",editingName:!1})},a.submitEditingName=function(){0!==a.state.editedName.length?(a.props.dispatch(Ft(a.state.editedName)),a.setState({editedName:"",editingName:!1})):a.cancelEditingName()},a.handleCloseAndSaveDuringChangingName=function(e){27===e.keyCode?a.cancelEditingName():13===e.keyCode&&a.submitEditingName()},a.handleNameTyping=function(e){a.setState({editedName:e.target.value})},a.closeNotification=function(){a.props.dispatch(wt({open:!1}))},a.zoomOut=function(){var e=a.props.app.diagramEngine.getDiagramModel().getZoomLevel();a.props.app.diagramEngine.getDiagramModel().setZoomLevel(e-5),a.props.app.diagramEngine.repaintCanvas()},a.zoomIn=function(){var e=a.props.app.diagramEngine.getDiagramModel().getZoomLevel();a.props.app.diagramEngine.getDiagramModel().setZoomLevel(e+5),a.props.app.diagramEngine.repaintCanvas()},a.zoomToFit=function(){a.props.app.diagramEngine.zoomToFit()},a.state={editingName:!1,editedName:""},a.ctrlDown=!1,a.nodesToCopy=[],a.keydownHandler=a.keydownHandler.bind(Object(W.a)(a)),a.keyupHandler=a.keyupHandler.bind(Object(W.a)(a)),a.copyNode=a.copyNode.bind(Object(W.a)(a)),a}return Object(B.a)(n,[{key:"copyNode",value:function(e){var t=75,n=75,a=this.props.app.getDiagramEngine().getDiagramModel(),i=a.getNodes();if(void 0!==i[e]){var r=i[e].clone({});r.setPosition(r.x+t,r.y+n),r.selected=!1,a.addNode(r),this.forceUpdate()}else console.warn("Unable to copy node with ID "+e)}},{key:"keydownHandler",value:function(e){if(17!==e.keyCode&&91!==e.keyCode||(this.ctrlDown=!0),this.ctrlDown&&67===e.keyCode){var t=this.props.app.getDiagramEngine().getDiagramModel();this.nodesToCopy=[];var n,a=Object(z.a)(t.getSelectedItems());try{for(a.s();!(n=a.n()).done;){var i=n.value;i.selected&&i instanceof V.NodeModel&&this.nodesToCopy.push(i.id)}}catch(s){a.e(s)}finally{a.f()}}if(this.ctrlDown&&86===e.keyCode){var r,o=Object(z.a)(this.nodesToCopy);try{for(o.s();!(r=o.n()).done;){var l=r.value;this.copyNode(l)}}catch(s){o.e(s)}finally{o.f()}this.nodesToCopy=[]}}},{key:"keyupHandler",value:function(e){17!==e.keyCode&&91!==e.keyCode||(this.ctrlDown=!1)}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.keydownHandler),document.addEventListener("keyup",this.keyupHandler)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.keydownHandler),document.removeEventListener("keyup",this.keyupHandler)}},{key:"componentDidUpdate",value:function(e){!0===this.props.app.isCorruptedPayload()&&!1===e.app.isCorruptedPayload()&&this.props.dispatch(wt({open:!0,variant:"error",text:"Unable to load corrupted scenario."}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.classes,g=t.canvas,f={className:"srd-demo-canvas",diagramEngine:this.props.app.getDiagramEngine(),maxNumberPointsPerLink:0,allowLooseLinks:!1,allowCanvasTranslation:g.pannable,allowCanvasZoom:g.zoomable};return h.createElement("div",{className:"body"},h.createElement("div",{className:n.root},h.createElement(Z.a,null),h.createElement(q.a,{position:"fixed",className:n.appBar},h.createElement(Y.a,null,h.createElement($.a,{container:!0},h.createElement($.a,{item:!0,xs:4},h.createElement(Q.a,{variant:"h6",color:"inherit",noWrap:!0},this.state.editingName?h.createElement("input",{autoFocus:!0,type:"text",value:this.state.editedName,onChange:this.handleNameTyping,onKeyDown:this.handleCloseAndSaveDuringChangingName,onBlur:this.submitEditingName,className:"changing-name-input"}):h.createElement("span",{onClick:this.startEditingName,className:"scenario-name"},this.props.scenario.name))),h.createElement($.a,{item:!0,xs:8},h.createElement($.a,{container:!0,direction:"row",justify:"flex-end"},!!this.props.scenario.loading&&h.createElement(te.a,{className:"circular-loading",size:19,color:"inherit"}),h.createElement(H.a,{title:"Zoom in",size:"small",variant:"contained",color:"primary",onClick:function(){return e.zoomIn()}},h.createElement(ci.a,null)),h.createElement(H.a,{title:"Zoom out",size:"small",variant:"contained",color:"primary",onClick:function(){return e.zoomOut()}},h.createElement(di.a,{titleAccess:"Test"})),h.createElement(H.a,{title:"Zoom to fit",size:"small",variant:"contained",color:"primary",onClick:function(){return e.zoomToFit()}},h.createElement(mi.a,null)),h.createElement(ui.a,{orientation:"vertical",variant:"middle",flexItem:!0}),h.createElement(H.a,{size:"small",variant:"contained",color:"secondary",onClick:function(){return e.saveChanges()}},this.props.scenario.id?"Update":"Save")))))),h.createElement(K.a,{className:n.drawer,variant:"permanent",classes:{paper:n.drawerPaper}},h.createElement("div",{className:n.toolbar}),h.createElement(J.a,{component:"nav",subheader:h.createElement(X.a,{component:"div"},"Triggers")},h.createElement(Ze,{model:{type:"trigger"},name:"Event",icon:h.createElement(ce.a,null)}),h.createElement(Ze,{model:{type:"before_trigger"},name:"Before Event",icon:h.createElement(Ee.a,null)})),h.createElement(J.a,{component:"nav",subheader:h.createElement(X.a,{component:"div"},"Actions")},h.createElement(Ze,{model:{type:"email"},name:"Send email",icon:h.createElement(ae.a,null)}),h.createElement(Ze,{model:{type:"generic"},name:"Run generic action",icon:h.createElement(re.a,null)}),_e&&h.createElement(Ze,{model:{type:"banner"},name:"Show banner",icon:h.createElement(le.a,null)}),we&&h.createElement(Ze,{model:{type:"push_notification"},name:"Send notification",icon:h.createElement(Oe.a,null)})),h.createElement(J.a,{component:"nav",subheader:h.createElement(X.a,{component:"div"},"Operations")},h.createElement(Ze,{model:{type:"segment"},name:"Segment",icon:h.createElement(pe.a,null)}),h.createElement(Ze,{model:{type:"condition"},name:"Condition",icon:h.createElement(ge.a,null)}),h.createElement(Ze,{model:{type:"wait"},name:"Wait",icon:h.createElement(me.a,null)}),h.createElement(Ze,{model:{type:"goal"},name:"Goal",icon:h.createElement(ve.a,null)}),h.createElement(Ze,{model:{type:"ab_test"},name:"AB Test",icon:h.createElement(je.a,null)}))),h.createElement(ct,{variant:this.props.canvas.notification.variant,text:this.props.canvas.notification.text,open:this.props.canvas.notification.open,handleClose:this.closeNotification}),h.createElement("main",{className:n.content},h.createElement("div",{className:"diagram-layer",onDrop:function(t){var n=t.dataTransfer.getData("storm-diagram-node");if(n){var h=JSON.parse(n),g=null;"email"===h.type?g=new a.NodeModel({}):"generic"===h.type?g=new r.NodeModel({}):"banner"===h.type?g=new i.NodeModel({expiresInUnit:"days",expiresInTime:1}):"push_notification"===h.type?g=new u.NodeModel({}):"segment"===h.type?g=new o.NodeModel({}):"condition"===h.type?g=new m.NodeModel({}):"trigger"===h.type?g=new l.NodeModel({}):"before_trigger"===h.type?g=new s.NodeModel({}):"wait"===h.type?g=new c.NodeModel({}):"goal"===h.type?g=new d.NodeModel({recheckPeriodUnit:"hours",recheckPeriodTime:1}):"ab_test"===h.type&&(g=new p.NodeModel({name:"AB Test",scenarioName:e.props.scenario.name}));var f=e.props.app.getDiagramEngine().getRelativeMousePoint(t);g.x=f.x,g.y=f.y,e.props.app.getDiagramEngine().getDiagramModel().addNode(g),e.forceUpdate()}},onDragOver:function(e){e.preventDefault()}},h.createElement(V.DiagramWidget,f)))))}}]),n}(h.Component);var hi=G()(Object(ee.a)((function(e){return{root:{display:"flex"},appBar:{zIndex:e.zIndex.drawer+1},drawer:{width:240,flexShrink:0},drawerPaper:{width:240},content:{flexGrow:1,padding:0},toolbar:e.mixins.toolbar}}),{name:"BodyWidget"}),Object(v.b)((function(e){return{canvas:e.canvas,scenario:e.scenario}}),null))(pi),gi=(n(267),n(121)),fi=n.n(gi);function vi(e){return 0===e?{unit:"minutes",time:e}:e%1440===0?{unit:"days",time:e/1440}:e%60===0?{unit:"hours",time:e/60}:{unit:"minutes",time:e}}var bi=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(A.a)(this,e),this.activeModel=t,this.payload=n}return Object(B.a)(e,[{key:"renderPayload",value:function(e){var t=this;this.payload=e;var n=this.payload.visual;fi()(e.elements,(function(e){var l=null;if("segment"===e.type)e.selectedSegment=e.segment.code,l=new o.NodeModel(e);else if("condition"===e.type)l=new m.NodeModel({id:e.id,name:e.name,conditions:e.condition.conditions});else if("email"===e.type)e.selectedMail=e.email.code,l=new a.NodeModel(e);else if("generic"===e.type)e.selectedGeneric=e.generic.code,e.options=e.generic.options,l=new r.NodeModel(e);else if("wait"===e.type){var s=vi(e.wait.minutes);e.waitingUnit=s.unit,e.waitingTime=s.time,l=new c.NodeModel(e)}else if("banner"===e.type){if(!_e)throw Error("BANNER_ENABLED configuration is false, but loaded scenario contains banner element.");var h=vi(e.banner.expiresInMinutes);e.expiresInUnit=h.unit,e.expiresInTime=h.time,e.selectedBanner=e.banner.id,l=new i.NodeModel(e)}else if("goal"===e.type){if(e.goal.hasOwnProperty("timeoutMinutes")){var g=vi(e.goal.timeoutMinutes);e.timeoutUnit=g.unit,e.timeoutTime=g.time}var f=vi(e.goal.recheckPeriodMinutes);e.recheckPeriodUnit=f.unit,e.recheckPeriodTime=f.time,e.selectedGoals=e.goal.codes,l=new d.NodeModel(e)}else"push_notification"===e.type?(e.selectedTemplate=e.push_notification.template,e.selectedApplication=e.push_notification.application,l=new u.NodeModel(e)):"ab_test"===e.type&&(l=new p.NodeModel({id:e.id,name:e.name,variants:e.ab_test.variants,scenarioName:t.payload.name}));t.activeModel.addNode(l),l.setPosition(n[e.id].x,n[e.id].y)})),fi()(e.elements,(function(e){var n=t.activeModel.getNode(e.id);e[e.type].descendants.forEach((function(e){t.linkNodes(n,t.activeModel.getNode(e.uuid),e.direction,e.position)}))})),fi()(e.triggers,(function(e){var a=null;if("event"===e.type)e.selectedTrigger=e.event.code,a=new l.NodeModel(e);else if("before_event"===e.type){var i=vi(e.options.minutes);e.timeUnit=i.unit,e.time=i.time,e.selectedTrigger=e.event.code,a=new s.NodeModel(e)}t.activeModel.addNode(a),a.setPosition(n[e.id].x,n[e.id].y),e.elements.forEach((function(e){t.linkNodes(a,t.activeModel.getNode(e))}))}))}},{key:"linkNodes",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(n){var i;if("positive"===n)return i="ab_test"===e.type?e.getPort("right."+a).link(t.getPort("left")):e.getPort("right").link(t.getPort("left")),void this.activeModel.addLink(i);if("negative"===n){var r=e.getPort("bottom").link(t.getPort("left"));return void this.activeModel.addLink(r)}}var o=e.getPort("right").link(t.getPort("left"));this.activeModel.addLink(o)}}]),e}(),Ei=function(){function e(t){Object(A.a)(this,e),this.diagramEngine=new V.DiagramEngine,this.diagramEngine.installDefaultFactories(),this.activeModel=new V.DiagramModel,this.renderService=new bi(this.activeModel),this.payload=t,this.corruptedPayload=!1,t?this.renderPayload():this.registerCustomModels()}return Object(B.a)(e,[{key:"renderPayload",value:function(){this.registerCustomModels();try{this.renderService.renderPayload(this.payload)}catch(e){console.log(e.message),this.corruptedPayload=!0,this.activeModel=new V.DiagramModel}this.diagramEngine.setDiagramModel(this.activeModel),this.diagramEngine.repaintCanvas()}},{key:"registerCustomModels",value:function(){this.diagramEngine.registerLinkFactory(new gt),this.diagramEngine.registerPortFactory(new dt("email",(function(e){return new a.PortModel}))),this.diagramEngine.registerNodeFactory(new a.NodeFactory),this.diagramEngine.registerPortFactory(new dt("generic",(function(e){return new r.PortModel}))),this.diagramEngine.registerNodeFactory(new r.NodeFactory),this.diagramEngine.registerPortFactory(new dt("segment",(function(e){return new o.PortModel}))),this.diagramEngine.registerNodeFactory(new o.NodeFactory),this.diagramEngine.registerPortFactory(new dt("trigger",(function(e){return new l.PortModel}))),this.diagramEngine.registerNodeFactory(new l.NodeFactory),this.diagramEngine.registerPortFactory(new dt("before_trigger",(function(e){return new s.PortModel}))),this.diagramEngine.registerNodeFactory(new s.NodeFactory),this.diagramEngine.registerPortFactory(new dt("wait",(function(e){return new c.PortModel}))),this.diagramEngine.registerNodeFactory(new c.NodeFactory),this.diagramEngine.registerPortFactory(new dt("goal",(function(e){return new d.PortModel}))),this.diagramEngine.registerNodeFactory(new d.NodeFactory),this.diagramEngine.registerPortFactory(new dt("banner",(function(e){return new i.PortModel}))),this.diagramEngine.registerNodeFactory(new i.NodeFactory),this.diagramEngine.registerPortFactory(new dt("condition",(function(e){return new m.PortModel}))),this.diagramEngine.registerNodeFactory(new m.NodeFactory),this.diagramEngine.registerPortFactory(new dt("push_notification",(function(e){return new u.PortModel}))),this.diagramEngine.registerNodeFactory(new u.NodeFactory),this.diagramEngine.registerPortFactory(new dt("ab_test",(function(e){return new p.PortModel}))),this.diagramEngine.registerNodeFactory(new p.NodeFactory)}},{key:"getActiveDiagram",value:function(){return this.activeModel}},{key:"getDiagramEngine",value:function(){return this.diagramEngine}},{key:"isCorruptedPayload",value:function(){return this.corruptedPayload}}]),e}(),yi=function(e){Object(U.a)(n,e);var t=Object(L.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(B.a)(n,[{key:"componentDidMount",value:function(){var e,t=this.props.dispatch;t((function(e){return e(Pt(!0)),O.a.get("".concat(xe)).then((function(t){e({type:"segments_changed",payload:t.data.result}),e(Pt(!1))})).catch((function(t){console.log(t),e(Pt(!1)),e(wt({open:!0,variant:"error",text:"Segments fetching failed."}))}))})),t((function(e){return e(Pt(!0)),O.a.get(Pe).then((function(t){e({type:"criteria_changed",payload:t.data.blueprint}),e(Pt(!1))})).catch((function(t){console.log(t),e(Pt(!1)),e(wt({open:!0,variant:"error",text:"Criteria fetching failed."}))}))})),t((function(e){return e(Pt(!0)),O.a.get(Ue).then((function(t){e({type:"goals_changed",payload:t.data.goals}),e(Pt(!1))})).catch((function(t){e(Pt(!1)),console.log(t),e(wt({open:!0,variant:"error",text:"Goals fetching failed."}))}))})),t((function(e){return e(Pt(!0)),O.a.get("".concat(De)).then((function(t){e({type:"triggers_changed",payload:t.data.events}),e(Pt(!1))})).catch((function(t){e(Pt(!1)),console.log(t),e(wt({open:!0,variant:"error",text:"Triggers fetching failed."}))}))})),t((function(e){return e(Pt(!0)),O.a.get("".concat(Ie)).then((function(t){e({type:"before_triggers_changed",payload:t.data.events}),e(Pt(!1))})).catch((function(t){e(Pt(!1)),console.log(t),e(wt({open:!0,variant:"error",text:"Triggers fetching failed."}))}))})),t((function(e){return e(Pt(!0)),O.a.get("".concat(Ae)).then((function(t){e({type:"mails_changed",payload:t.data.mail_templates}),e(Pt(!1))})).catch((function(t){e(Pt(!1)),console.log(t),e(wt({open:!0,variant:"error",text:"Mails fetching failed."}))}))})),t((function(e){return e(Pt(!0)),O.a.get("".concat(Be)).then((function(t){e({type:"generics_changed",payload:t.data}),e(Pt(!1))})).catch((function(t){e(Pt(!1)),console.log(t),e(wt({open:!0,variant:"error",text:"Generics fetching failed."}))}))})),_e&&t((function(e){return e(Pt(!0)),O.a.get(Le).then((function(t){e({type:"banners_changed",payload:t.data.banners}),e(Pt(!1))})).catch((function(t){e(Pt(!1)),console.log(t),e(wt({open:!0,variant:"error",text:"Banners fetching failed."}))}))})),we&&t((function(e){e(Pt(!0));var t=O.a.get("".concat(ze)),n=O.a.get("".concat(We));return O.a.all([t,n]).then((function(t){var n,a;e((n=t[0].data.templates,a=t[1].data.applications,{type:"push_notifications_changed",payload:{templates:n,applications:a}})),e(Pt(!1))})).catch((function(t){e(Pt(!1)),console.log(t),e(wt({open:!0,variant:"error",text:"Notifications fetching failed."}))}))})),Se?(t((e=Se,function(t){return t(Pt(!0)),O.a.get(Me+e).then((function(e){t({type:"set_scenario_payload",payload:e.data}),t(Ft(e.data.name)),t(Mt(e.data.id)),t(Pt(!1))})).catch((function(e){t(Pt(!1)),t(wt({open:!0,variant:"error",text:"Scenario fetching failed."})),console.log(e)}))})),t(function(e){return function(t){return O.a.get(Re+e).then((function(e){t({type:"statistics_changed",payload:e.data})})).catch((function(e){console.log(e)}))}}(Se))):t(Ft("Unnamed scenario"))}},{key:"render",value:function(){var e=new Ei(this.props.scenarioPayload);return g.a.createElement(hi,{app:e})}}]),n}(h.Component);var Oi=Object(v.b)((function(e){return{scenarioPayload:e.scenario.payload}}))(yi);window.__MUI_USE_NEXT_TYPOGRAPHY_VARIANTS__=!0,O.a.defaults.headers.common.Authorization=Te;var Ni=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||b.c,ji=Object(b.d)(I,{},Ni(Object(b.a)(E.a)));Object(f.render)(g.a.createElement(v.a,{store:ji},g.a.createElement(Oi,null)),document.getElementById("root"))}},[[208,1,2]]]);